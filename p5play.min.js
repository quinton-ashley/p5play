/**
 * p5play
 * @version 3.11
 * @author quinton-ashley
 * @license gpl-v3-only
 */
p5.prototype.registerMethod("init",(function(){if(void 0===window.planck)throw"planck.js must be loaded before p5play";const t=this,e=console.log;this.log=console.log;const i=planck,s=60;if(this.p5play??={},this.p5play.os??={},this.p5play.context??="web",this.p5play.standardizeKeyboard??=!1,this.p5play.sprites={},this.p5play.groups={},this.p5play.groupsCreated=0,this.p5play.spritesCreated=0,this.p5play.spritesDrawn=0,this.p5play._renderStats={},void 0===window._p5play_gtagged){let t=document.createElement("script");t.src="https://www.googletagmanager.com/gtag/js?id=G-EHXNCTSYLK",t.async=!0,document.head.append(t),window._p5play_gtagged=!0,t.onload=()=>{window.dataLayer??=[],window.gtag=function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-EHXNCTSYLK"),gtag("event","p5play_v3_11")}}this.angleMode("degrees");const r=(t,e,r)=>new i.Vec2(t*r/s,e*r/s),o=(t,e,r)=>new i.Vec2(t/r*s,e/r*s),h=t=>Math.abs(t)<=i.Settings.linearSlop,n=t=>Math.abs(t-Math.round(t))<=i.Settings.linearSlop?Math.round(t):t,a={_collisions:["_collides","_colliding","_collided"],_overlappers:["_overlaps","_overlapping","_overlapped"]};this.Sprite=class{constructor(e,r,o,h,a){this.p=t,this.idNum,this.watch,this.mod=[];let u,c,_=[...arguments];if(void 0!==_[0]&&_[0]instanceof this.p.Group&&(u=_[0],_=_.slice(1)),_.length||(this._noArgs=!0),void 0!==_[0]&&isNaN(_[0])&&("string"==typeof _[0]||_[0]instanceof this.p.SpriteAnimation||_[0]instanceof p5.Image)&&(c=_[0],_=_.slice(1)),1==_.length&&"number"==typeof _[0])throw new v("Sprite",0,[_[0]]);if(e=_[0],r=_[1],o=_[2],h=_[3],a=_[4],this._originMode="center",Array.isArray(e)&&(e=void 0,r=void 0,o=_[0],h=_[1],a=_[2]),Array.isArray(o)||"string"==typeof h){if(isNaN(o)||(o=Number(o)),"number"!=typeof o&&Array.isArray(o[0])&&(this._originMode="start"),void 0!==h){if(Array.isArray(h))throw new v("Sprite",1,[`[[${o}], [${h}]]`]);!function(t){let e=t.slice(0,2);return"d"==t||"s"==t||"k"==t||"n"==t||"dy"==e||"st"==e||"ki"==e||"no"==e}(h)?o=d(o,h):a=h,h=void 0}}else isNaN(o)&&(a=o,o=void 0);this.idNum=this.p.p5play.spritesCreated,this._uid=1e3+this.idNum,this.p.p5play.sprites[this._uid]=this,this.p.p5play.spritesCreated++,this.groups=[],this.animations=new this.p.SpriteAnimations,this.joints=[],this.joints.removeAll=()=>{for(let t of this.joints)t.remove()},this._removed=!1,this._life=2147483647,this._visible=!0,this._pixelPerfect=!1,this._aniChangeCount=0,this._collides={},this._colliding={},this._collided={},this._hasOverlap={},this._overlaps={},this._overlapping={},this._overlapped={},this._collisions={},this._overlappers={},u??=this.p.allSprites,u.dynamic&&(a??="dynamic"),u.kinematic&&(a??="kinematic"),u.static&&(a??="static"),a??=u.collider,this._shape=u.shape,this.tileSize=u.tileSize||1;let f=this;if(this._position={x:0,y:0},this._pos=t.createVector.call(t),Object.defineProperty(this._pos,"x",{get(){if(!f.body)return f._position.x;let t=f.body.getPosition().x/f.tileSize*s;return n(t)},set(t){if(f.body){let e=new i.Vec2(t*f.tileSize/s,f.body.getPosition().y);f.body.setPosition(e)}f._position.x=t}}),Object.defineProperty(this._pos,"y",{get(){if(!f.body)return f._position.y;let t=f.body.getPosition().y/f.tileSize*s;return n(t)},set(t){if(f.body){let e=new i.Vec2(f.body.getPosition().x,t*f.tileSize/s);f.body.setPosition(e)}f._position.y=t}}),this._velocity={x:0,y:0},this._vel=t.createVector.call(t),Object.defineProperties(this._vel,{x:{get(){let t;return t=f.body?f.body.getLinearVelocity().x:f._velocity.x,n(t/f.tileSize)},set(t){t*=f.tileSize,f.body?f.body.setLinearVelocity(new i.Vec2(t,f.body.getLinearVelocity().y)):f._velocity.x=t}},y:{get(){let t;return t=f.body?f.body.getLinearVelocity().y:f._velocity.y,n(t/f.tileSize)},set(t){t*=f.tileSize,f.body?f.body.setLinearVelocity(new i.Vec2(f.body.getLinearVelocity().x,t)):f._velocity.y=t}}}),this._mirror={_x:1,_y:1,get x(){return this._x<0},set x(t){f.watch&&(f.mod[22]=!0),this._x=t?-1:1},get y(){return this._y<0},set y(t){f.watch&&(f.mod[22]=!0),this._y=t?-1:1}},this._heading="right",this._layer=u._layer,this._layer??=this.p.allSprites._getTopLayer()+1,a??=u.collider,a&&"string"==typeof a||(a="dynamic"),this.collider=a,e??=u.x,void 0===e&&(e=this.p.width/this.p.allSprites.tileSize/2,this._vertexMode=!0),r??=u.y,void 0===r&&(r=this.p.height/this.p.allSprites.tileSize/2),o??=u.w||u.width||u.d||u.diameter,h??=u.h||u.height,"function"==typeof e&&(e=e(u.length)),"function"==typeof r&&(r=r(u.length)),"function"==typeof o&&(o=o(u.length)),"function"==typeof h&&(h=h(u.length)),this.x=e,this.y=r,!u._isAllSpritesGroup&&!c)for(let t in u.animations){c=t;break}for(let t=u;t;t=this.p.p5play.groups[t.parent])this.groups.push(t);if(this.groups.reverse(),c){c instanceof p5.Image?this.addAni(c):"string"==typeof c?this._changeAni(c):this._ani=c.clone();let t=this.tileSize;o||1==this._ani.w&&1==this._ani.h||(o=this._ani.w/t,"circle"!=this.shape&&(h=this._ani.h/t))}if(this.groups=[],this.mouse=new this.p._SpriteMouse,"none"!=this.collider)this._vertexMode?this.addCollider(o,h):this.addCollider(0,0,o,h);else{if(this.w=o||(this.tileSize>1?1:50),this.h=h||this.w,Array.isArray(o))throw new Error('Cannot set the collider type of a sprite with a polygon or chain shape to "none". Try having the sprite overlap with other sprites instead.');this._shape=void 0!==o&&void 0===h?"circle":"box"}u._isAllSpritesGroup||this.p.allSprites.push(this),u.push(this),this._scale=new l,Object.defineProperty(this._scale,"x",{get(){return this._x},set(t){if(t==this._x)return;f.watch&&(f.mod[28]=!0);let e=t/this._x;f._w*=e,f._hw*=e,f._resizeColliders({x:e,y:1}),this._x=t,this._avg=.5*(this._x+this._y)}}),Object.defineProperty(this._scale,"y",{get(){return this._y},set(t){if(t==this._y)return;f.watch&&(f.mod[28]=!0);let e=t/this._y;f._h&&(this._h*=e,this._hh*=e),f._resizeColliders({x:1,y:e}),this._y=t,this._avg=.5*(this._x+this._y)}}),this._offset={_x:0,_y:0,get x(){return this._x},set x(t){t!=this._x&&(f.watch&&(f.mod[23]=!0),f._offsetCenterBy(t-this._x,0))},get y(){return this._y},set y(t){t!=this._y&&(f.watch&&(f.mod[23]=!0),f._offsetCenterBy(0,t-this._y))}},this._angle=0,this._rotationSpeed=0,this._bearing=0,this.prevPos={x:e,y:r},this.prevRotation=0,this._dest={x:e,y:r},this._destIdx=0,this.drag=0,this.debug=!1,this._shift={};let g=u.vel.x||0,y=u.vel.y||0;"function"==typeof g&&(g=g(u.length-1)),"function"==typeof y&&(y=y(u.length-1)),this.vel.x=g,this.vel.y=y;let m=["ani","collider","vel","x","y"];for(let t of this.p.Sprite.propsAll){if(m.includes(t))continue;let e=u[t];void 0!==e&&("function"==typeof e&&p(e)&&(e=e(u.length-1)),this[t]="object"==typeof e?Object.assign({},e):e)}m=["add","animation","animations","autoCull","contains","GroupSprite","Group","idNum","length","mod","mouse","p","parent","Sprite","Subgroup","subgroups","velocity"];for(let t=0;t<this.groups.length;t++){let e=this.groups[t],i=Object.keys(e);for(let t of i){if(!isNaN(t)||"_"==t[0]||m.includes(t)||this.p.Sprite.propsAll.includes(t))continue;let i=e[t];void 0!==i&&("function"==typeof i&&p(i)&&(i=i(e.length-1)),this[t]="object"==typeof i?Object.assign({},i):i)}}this._validateShape(this._shape),this.color??=this.p.color(Math.round(this.p.random(30,245)),Math.round(this.p.random(30,245)),Math.round(this.p.random(30,245))),this.textColor??=this.p.color(0),this.textSize??=1==this.tileSize?this.p.canvas?this.p.textSize():12:.8,this._massUndef=!0,void 0===o&&(this._dimensionsUndef=!0,this._widthUndef=!0,void 0===h&&(this._heightUndef=!0))}addCollider(t,e,i,s){if("none"==this.collider)throw new Error("Cannot add a collider to a sprite that has none.");let o={};o.shape=this._parseShape(...arguments),"chain"==o.shape.m_type&&(o.density=0,o.restitution=0),o.density??=this.density||5,o.friction??=this.friction||.5,o.restitution??=this.bounciness||.2,this.body||(this.body=this.p.world.createBody({position:r(this.x,this.y,this.tileSize),type:this.collider}),this.body.sprite=this),this.body.createFixture(o),this.resetMass()}addSensor(t,e,i,s){let o=this._parseShape(...arguments);this.body||(this.body=this.p.world.createBody({position:r(this.x,this.y,this.tileSize),type:"dynamic"}),this.body.sprite=this),this.body.createFixture({shape:o,isSensor:!0}),this._sortFixtures(),this._hasSensors=!0}_parseShape(t,e,s,o){let n,a,l,p,u=[...arguments];if(u.length<3&&(t=0,e=0,s=u[0],o=u[1],this._vertexMode=!0),t??=0,e??=0,s??=this._w,!this.body&&this.shape&&"circle"!=this.shape&&(o??=this._h),Array.isArray(s)||"string"==typeof o?(isNaN(s)||(s=Number(s)),"number"!=typeof s&&Array.isArray(s[0])&&(this._originMode="start"),"string"==typeof o?(n=d(s,o),o=void 0):n=s):(void 0!==s&&void 0===o&&(a??="circle"),a??="box"),"box"!=a&&"circle"!=a||(s??=this.tileSize>1?1:50,o??=s),"box"!=a&&"circle"!=a||(l=r(s-.08,o-.08,this.tileSize)),"box"==a)p=i.Box(l.x/2,l.y/2,r(t,e,this.tileSize),0);else if("circle"==a)p=i.Circle(r(t,e,this.tileSize),l.x/2);else if(n){let c,_,f=[{x:0,y:0}],g={x:0,y:0},y={x:0,y:0},m={x:0,y:0},w=Array.isArray(n[0]);function x(){g.x<y.x&&(y.x=g.x),g.y<y.y&&(y.y=g.y),g.x>m.x&&(m.x=g.x),g.y>m.y&&(m.y=g.y)}if(w){this._vertexMode&&(c=n[0][0],_=n[0][1],this.body?(c=this.x-this._relativeOrigin.x,_=this.y-this._relativeOrigin.y,f.pop()):(this.x=c,this.y=_));for(let b=0;b<n.length;b++){if(this._vertexMode){if(0==b&&!this.body)continue;g.x=n[b][0]-c,g.y=n[b][1]-_}else g.x+=n[b][0],g.y+=n[b][1];f.push({x:g.x,y:g.y}),x()}}else{let S=1;n.length%2&&(S=n[n.length-1]);let A=S>0?1:-1;S=Math.abs(S);let C=0;for(let k=0;k<S;k++){for(let z=0;z<n.length-1;z+=2){let M=n[z];C+=n[z+1],g.x+=M*this.p.cos(C),g.y+=M*this.p.sin(C),f.push({x:g.x,y:g.y}),x()}C*=A}}h(Math.abs(f[0].x)-Math.abs(f[f.length-1].x))&&h(Math.abs(f[0].y)-Math.abs(f[f.length-1].y))?(a="polygon",this._originMode="center"):a="chain",s=m.x-y.x,this._hw=.5*s,o=m.y-y.y,this._hh=.5*o;let v=!1;if("polygon"==a&&this._isConvexPoly(f.slice(0,-1))&&(v=!0),"start"==this._originMode)for(let j=0;j<f.length;j++)f[j]=r(f[j].x,f[j].y,this.tileSize);else{let T=0,L=0,D=0,F=0,O=f.length;("polygon"==a||v)&&O--;for(let P=0;P<O;P++)D+=f[P].x,F+=f[P].y;T=D/O,L=F/O,this.body||(this._relativeOrigin={x:T,y:L}),this._vertexMode&&w&&(this.body?(T=this._relativeOrigin.x,L=this._relativeOrigin.y):(this.x+=T,this.y+=L));for(let I=0;I<f.length;I++){let B=f[I];f[I]=r(B.x+t-T,B.y+e-L,this.tileSize)}}(!v||f.length-1>i.Settings.maxPolygonVertices||"chain"==this._shape)&&(a="chain"),"polygon"==a?p=i.Polygon(f):"chain"==a&&(p=i.Chain(f,!1))}return this._shape||(this._shape=a),this._w=s,this._hw=.5*s,"circle"==this._shape?this._diameter=s:(this._h=o,this._hh=.5*o),p}removeColliders(){this._collides={},this._colliding={},this._collided={},this._removeFixtures(!1)}removeSensors(){this._hasOverlap={},this._overlaps={},this._overlapping={},this._overlapped={},this._removeFixtures(!0)}_removeFixtures(t){let e;for(let i=this.fixtureList;i;i=i.getNext())if(void 0===t||i.m_isSensor==t){let t=i.m_next;i.destroyProxies(this.p.world.m_broadPhase),e?e.m_next=t:this.body.m_fixtureList=t}else e=i}_offsetCenterBy(t,e){if(!t&&!e)return;if(this._offset._x+=t,this._offset._y+=e,!this.body)return;let i=r(t,e,this.tileSize);for(let t=this.body.m_fixtureList;t;t=t.m_next){let e=t.m_shape;if("circle"!=e.m_type){let t=e.m_vertices;for(let e of t)e.x+=i.x,e.y+=i.y}else e.m_p.x+=i.x,e.m_p.y+=i.y}}_cloneBodyProps(){let t={},e=["bounciness","density","drag","friction","heading","isSuperFast","rotation","rotationDrag","rotationLock","rotationSpeed","scale","vel","x","y"];this._massUndef&&this._dimensionsUndef||e.push("mass");for(let i of e)"object"==typeof this[i]?t[i]=Object.assign({},this[i]):t[i]=this[i];return t}get animation(){return this._ani}set animation(t){this.changeAni(t)}get ani(){return this._ani}set ani(t){this.changeAni(t)}get anis(){return this.animations}get autoDraw(){return this._autoDraw}set autoDraw(t){this.watch&&(this.mod[6]=!0),this._autoDraw=t}get allowSleeping(){return this.body?.isSleepingAllowed()}set allowSleeping(t){this.watch&&(this.mod[7]=!0),this.body&&this.body.setSleepingAllowed(t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this.watch&&(this.mod[8]=!0),this._autoUpdate=t}get bounciness(){if(this.fixture)return this.fixture.getRestitution()}set bounciness(t){this.watch&&(this.mod[9]=!0);for(let e=this.fixtureList;e;e=e.getNext())e.setRestitution(t)}get centerOfMass(){let t=this.body.getWorldCenter(),e=o(t.x,t.y,this.tileSize);return this.p.createVector(e.x,e.y)}get collider(){return this._collider}set collider(t){let e=(t=t.toLowerCase())[0];if("d"==e&&(t="dynamic"),"s"==e&&(t="static"),"k"==e&&(t="kinematic"),"n"==e&&(t="none"),t==this._collider)return;if(this.__collider=["d","s","k","n"].indexOf(e),void 0===this._collider)return void(this._collider=t);if("none"==t&&("chain"==this._shape||"polygon"==this._shape))throw new Error('Cannot set the collider type of a polygon or chain collider to "none". Try having the sprite overlap with other sprites instead.');this.joints.length&&(this.joints.removeAll(),console.warn("Changing the collider type of a sprite that has joints will remove all its joints.")),this.watch&&(this.mod[10]=!0);let i=this._collider;this._collider=t,void 0!==i&&this._reset()}_reset(){let t,e=this._cloneBodyProps();"chain"!=this._shape&&"polygon"!=this._shape||(t=this._getVertices(!0),this._vertexMode=!0),this.body&&(this.p.world.destroyBody(this.body),this.body=void 0),"none"!=this._collider&&(t?this.addCollider(0,0,t):this.addCollider(),this._hasSensors&&this.addDefaultSensors());for(let t in e)void 0!==e[t]&&(this[t]=e[t]);let i=this._offset._x,s=this._offset._y;this._offset._x=0,this._offset._y=0,this._offsetCenterBy(i,s)}_parseColor(t){if(t instanceof p5.Color)return t;if("object"!=typeof t)return"string"==typeof t&&1==t.length?this.p.colorPal(t):this.p.color(t);if(t.levels)return this.p.color(...t.levels);if(void 0!==t._r)return this.p.color(t._r,t._g,t._b,255*t._a);if(void 0!==t._h)return this.p.color(t._h,t._s,t._v,255*t._a);throw new Error("Invalid color")}get color(){return this._color}set color(t){this.watch&&(this.mod[11]=!0),this._color=this._parseColor(t)}get colour(){return this._color}set colour(t){this.color=t}get fill(){return this._color}set fill(t){this.color=t}get fillColor(){return this._color}set fillColor(t){this.color=t}get stroke(){return this._stroke}set stroke(t){this.watch&&(this.mod[31]=!0),this._stroke=this._parseColor(t)}get strokeColor(){return this._stroke}set strokeColor(t){this.stroke=t}get strokeWeight(){return this._strokeWeight}set strokeWeight(t){this.watch&&(this.mod[32]=!0),this._strokeWeight=t}get textColor(){return this._textColor}set textColor(t){this.watch&&(this.mod[34]=!0),this._textColor=this._parseColor(t)}get bearing(){return this._bearing}set bearing(t){this.watch&&(this.mod[39]=!0),this._bearing=t}get debug(){return this._debug}set debug(t){this.watch&&(this.mod[12]=!0),this._debug=t}get density(){if(this.fixture)return this.fixture.getDensity()}set density(t){this.watch&&(this.mod[13]=!0);for(let e=this.fixtureList;e;e=e.getNext())e.setDensity(t)}_getDirectionAngle(t){t=t.toLowerCase().replaceAll(/[ _-]/g,"");let e={up:-90,down:90,left:180,right:0,upright:-45,rightup:-45,upleft:-135,leftup:-135,downright:45,rightdown:45,downleft:135,leftdown:135,forward:this.rotation,backward:this.rotation+180}[t];return"radians"==this.p._angleMode&&(e=this.p.radians(e)),e}get direction(){return 0!==this.vel.x||0!==this.vel.y?this.p.atan2(this.vel.y,this.vel.x):void 0===this._direction?this.rotation:this._direction}set direction(t){this.watch&&(this.mod[14]=!0),"string"==typeof t&&(this._heading=t,t=this._getDirectionAngle(t)),this._direction=t;let e=this.speed;this.vel.x=this.p.cos(t)*e,this.vel.y=this.p.sin(t)*e}get drag(){return this.body?.getLinearDamping()}set drag(t){this.watch&&(this.mod[15]=!0),this.body&&this.body.setLinearDamping(t)}get draw(){return this._display}set draw(t){this._draw=t}get dynamic(){return this.body?.isDynamic()}set dynamic(t){this.collider=t?"dynamic":"kinematic"}get fixture(){return this.fixtureList}get fixtureList(){return this.body?this.body.m_fixtureList:null}get friction(){if(this.fixture)return this.fixture.getFriction()}set friction(t){this.watch&&(this.mod[16]=!0);for(let e=this.fixtureList;e;e=e.getNext())e.setFriction(t)}get heading(){return this._heading}set heading(t){this.direction=t}get img(){return this._ani?.frameImage}set img(t){this.changeAni(t)}get image(){return this._ani?.frameImage}set image(t){this.changeAni(t)}get isMoving(){return 0!=this.vel.x||0!=this.vel.y}get isSuperFast(){return this.body?.isBullet()}set isSuperFast(t){this.watch&&(this.mod[18]=!0),this.body&&this.body.setBullet(t)}get kinematic(){return this.body?.isKinematic()}set kinematic(t){this.collider=t?"kinematic":"dynamic"}get layer(){return this._layer}set layer(t){this.watch&&(this.mod[19]=!0),this._layer=t}get life(){return this._life}set life(t){this.watch&&(this.mod[20]=!0),this._life=t}get mass(){return this.body?.getMass()}set mass(t){if(!this.body)return;this.watch&&(this.mod[21]=!0);let e=this.massData;e.mass=t>0?t:1e-8,this.body.setMassData(e),delete this._massUndef}get massData(){const t={I:0,center:new i.Vec2(0,0),mass:0};return this.body.getMassData(t),t.center=o(t.center.x,t.center.y,this.tileSize),t}resetMass(){this.body&&(this.watch&&(this.mod[21]=!0),this.body.resetMassData(),delete this._massUndef)}get mirror(){return this._mirror}set mirror(t){this.watch&&(this.mod[22]=!0),void 0!==t.x&&(this._mirror.x=t.x),void 0!==t.y&&(this._mirror.y=t.y)}get offset(){return this._offset}set offset(t){t.x??=this._offset._x,t.y??=this._offset._y,t.x==this._offset._x&&t.y==this._offset._y||(this.watch&&(this.mod[23]=!0),this._offsetCenterBy(t.x-this._offset._x,t.y-this._offset._y))}get previousPosition(){return this.prevPos}set previousPosition(t){this.prevPos=t}get previousRotation(){return this.prevRotation}set previousRotation(t){this.prevRotation=t}get pixelPerfect(){return this._pixelPerfect}set pixelPerfect(t){this.watch&&(this.mod[24]=!0),this._pixelPerfect=t}get rotation(){if(!this.body)return this._angle||0;let t=this.body.getAngle();return"degrees"===this.p._angleMode?this.p.degrees(t):t}set rotation(t){this.body?("degrees"===this.p._angleMode&&(t=this.p.radians(t)),this.body.setAngle(t)):this._angle=t}get rotationDrag(){return this.body?.getAngularDamping()}set rotationDrag(t){this.body&&(this.watch&&(this.mod[26]=!0),this.body.setAngularDamping(t))}get rotationLock(){return this.body?.isFixedRotation()}set rotationLock(t){this.body&&(this.watch&&(this.mod[27]=!0),this.body.setFixedRotation(t))}get rotationSpeed(){return this.body?this.body.getAngularVelocity():this._rotationSpeed}set rotationSpeed(t){this.body?this.body.setAngularVelocity(t):this._rotationSpeed=t}get scale(){return this._scale}set scale(t){if(t<=0&&(t=.01),"number"==typeof t?t={x:t,y:t}:(t.x??=this._scale._x,t.y??=this._scale._y),t.x==this._scale._x&&t.y==this._scale._y)return;this.watch&&(this.mod[28]=!0);let e={x:t.x/this._scale._x,y:t.y/this._scale._y};this._w*=e.x,this._hw*=e.x,this._h&&(this._h*=e.y,this._hh*=e.y),this._resizeColliders(e),this._scale._x=t.x,this._scale._y=t.y,this._scale._avg=t.x}get sleeping(){if(this.body)return!this.body.isAwake()}set sleeping(t){this.body&&(this.watch&&(this.mod[30]=!0),this.body.setAwake(!t))}get speed(){return this.p.createVector(this.vel.x,this.vel.y).mag()}set speed(t){let e=this.direction;this.vel.x=this.p.cos(e)*t,this.vel.y=this.p.sin(e)*t}get static(){return this.body?.isStatic()}set static(t){this.collider=t?"static":"dynamic"}get removed(){return this._removed}set removed(t){t&&!this._removed&&(this.watch&&(this.mod[25]=!0),this._removed=!0,this._remove())}get vertices(){return this._getVertices()}_getVertices(t){let e=this.fixture;for(;e.m_next&&!e.m_isSensor;)e=e.m_next;let i=e.getShape(),r=[...i.m_vertices];"polygon"==i.m_type&&r.unshift(r.at(-1));let o=this.x,h=this.y;for(let e=0;e<r.length;e++){let i=[n(r[e].x/this.tileSize*s+o),n(r[e].y/this.tileSize*s+h)];r[e]=t?i:this.p.createVector(i[0],i[1])}return r}get visible(){return this._visible}set visible(t){this.watch&&(this.mod[37]=!0),this._visible=t}get x(){return this._pos.x}set x(t){this._pos.x=t}get y(){return this._pos.y}set y(t){this._pos.y=t}get pos(){return this._pos}set pos(t){if(this.body){let e=new i.Vec2(t.x*this.tileSize/s,t.y*this.tileSize/s);this.body.setPosition(e)}this._position.x=t.x,this._position.y=t.y}get position(){return this._pos}set position(t){this.pos=t}get w(){return this._w}set w(t){if(t<0&&(t=.01),t==this._w)return;this.watch&&(this.mod[38]=!0);let e=t/this._w;this._w=t,this._hw=.5*t,this._resizeColliders({x:e,y:1}),delete this._widthUndef,delete this._dimensionsUndef}get hw(){return this._hw}set hw(t){throw new v("Sprite.hw")}get width(){return this._w}set width(t){this.w=t}get halfWidth(){return this.hw}set halfWidth(t){throw new v("Sprite.hw")}get h(){return"circle"==this.shape?this._w:this._h}set h(t){if(t<0&&(t=.01),"circle"==this.shape)return void(this.w=t);if(t==this._h)return;this.watch&&(this.mod[17]=!0);let e=t/this._h;this._h=t,this._hh=.5*t,this._resizeColliders({x:1,y:e}),delete this._heightUndef,delete this._dimensionsUndef}get hh(){return this._hh||this._hw}set hh(t){throw new v("Sprite.hh")}get height(){return this.h}set height(t){this.h=t}get halfHeight(){return this.hh}set halfHeight(t){throw new v("Sprite.hh")}get d(){return this._diameter??=this.w,this._diameter}set d(t){if(t<0)return void this.remove();let e="circle"!=this.shape;if(e){let e;if(this.watch&&(this.mod[29]=!0,this.mod[38]=!0),"none"!=this._collider&&(e=this._cloneBodyProps()),this._removeFixtures(),this._h=void 0,this._shape=void 0,"none"!=this._collider){this.addCollider(0,0,t);for(let t in e)void 0!==e[t]&&(this[t]=e[t])}this._shape="circle"}else{if(this._diameter==t)return;this.watch&&(this.mod[38]=!0),this._diameter=t}let i=t/this._w;this._w=t,this._hw=.5*t,this._h=t,this._hh=this._hw,e||this._resizeColliders({x:i,y:i})}get diameter(){return this.d}set diameter(t){this.d=t}get r(){return this._hw}set r(t){this.d=2*t}get radius(){return this._hw}set radius(t){this.d=2*t}_resizeColliders(t){if(this.body){for(let e=this.fixtureList;e;e=e.getNext()){if(e.m_isSensor)continue;let i=e.m_shape;if("circle"==i.m_type)1!=t.x?i.m_radius*=t.x:i.m_radius*=t.y;else for(let e of i.m_vertices)e.x*=t.x,e.y*=t.y}(this._widthUndef||this._heightUndef)&&this.resetMass(),"static"==this.collider&&this.body.synchronizeFixtures()}}_isConvexPoly(t){t:for(let e=0;e<2;e++){1==e&&(t=t.reverse());for(let s=0;s<t.length;++s){const r=s,o=s<t.length-1?r+1:0,h=t[r],n=i.Vec2.sub(t[o],h);for(let s=0;s<t.length;++s){if(s==r||s==o)continue;const a=i.Vec2.sub(t[s],h);if(i.Vec2.cross(n,a)<0){if(0==e)continue t;return!1}}}break}return!0}get shape(){return this._shape}set shape(t){t!=this._shape&&(this._validateShape(t),this.watch&&(this.mod[29]=!0),"circle"==t?this.d=this.w:(this._shape=t,this._reset()))}_validateShape(t){let e=this.p.Sprite.shapeTypes.indexOf(t);if(-1==e)throw new Error('Invalid shape type: "'+t+'"\nThe valid shape types are: "'+this.p.Sprite.shapeTypes.join('", "')+'"');this.__shape=e}get update(){return this._update}set update(t){this._customUpdate=t}get vel(){return this._vel}set vel(t){this.vel.x=t.x,this.vel.y=t.y}set velocity(t){this.vel=t}get velocity(){return this._vel}_update(){this._ani?.update&&this._ani.update();for(let t in this.mouse)-1==this.mouse[t]&&(this.mouse[t]=0);this._customUpdate&&this._customUpdate(),this.autoUpdate&&(this.autoUpdate=null)}_step(){if(this.body||this.removed||(this.rotation+=this._rotationSpeed,this.x+=this.vel.x,this.y+=this.vel.y),this.watch&&(this.x!=this.prevX&&(this.mod[0]=this.mod[2]=!0),this.y!=this.prevY&&(this.mod[1]=this.mod[2]=!0),this.rotation!=this.prevRotation&&(this.mod[3]=this.mod[4]=!0)),!this.body&&!this.removed)return;let t,e=[],i=this;for(let s in a)for(let r in this[s]){t=r>=1e3?this.p.p5play.sprites[r]:this.p.p5play.groups[r];let o=i[s][r]+1;if(this[s][r]=o,t instanceof this.p.Group&&(t[s][i._uid]=o),t&&0!=o){if(!(t instanceof this.p.Group)){e=[],1!=o&&-2!=o||e.push(a[s][0]),-1!=o&&e.push(a[s][1]),-1!=o&&-2!=o||e.push(a[s][2]);for(let s of e){let e=this.p.world._findContact(s,i,t,!0);e&&e(i,t,o)}}}else delete i[s][r],t instanceof this.p.Group&&delete t[s][i._uid]}this.removed&&0==Object.keys(this._collisions).length&&0==Object.keys(this._overlappers).length&&delete this.p.p5play.sprites[this._uid]}_draw(){if(void 0!==this.strokeWeight&&this.p.strokeWeight(this.strokeWeight),this._ani?.draw&&"colliders"!=this.debug&&this._ani.draw(this._offset._x,this._offset._y,0,this._scale._x,this._scale._y),!this._ani||this.debug||this.p.p5play.disableImages)if(this.debug&&"colliders"!=this.debug&&(this.p.noFill(),this.p.stroke(0,255,0),this.p.line(0,-2,0,2),this.p.line(-2,0,2,0)),3!=this.__collider){"chain"==this._shape?this.p.stroke(this.stroke||this.color):this._stroke&&this.p.stroke(this._stroke);for(let t=this.fixtureList;t;t=t.getNext())t.m_isSensor&&!this.debug||this._drawFixture(t)}else this.p.stroke(this._stroke||120),"box"==this._shape?this.p.rect(this._offset._x,this._offset._y,this.w*this.tileSize,this.h*this.tileSize):"circle"==this._shape&&this.p.circle(this._offset._x,this._offset._y,this.d*this.tileSize);void 0!==this.text&&(this.p.textAlign(this.p.CENTER,this.p.CENTER),this.p.fill(this.textColor),this.p.textSize(this.textSize*this.tileSize),this.p.text(this.text,0,0))}_display(){let t=.5*this.p.width-this.p.world.origin.x+this.x*this.tileSize,e=.5*this.p.height-this.p.world.origin.y+this.y*this.tileSize,i=Math.max(this._w,this._h);if("chain"!=this.shape&&this.p.camera.active&&(t+i<this.p.camera.bound.min.x||t-i>this.p.camera.bound.max.x||e+i<this.p.camera.bound.min.y||e-i>this.p.camera.bound.max.y))this._visible=null;else{this._visible=!0,this.p.p5play.spritesDrawn++,this._pixelPerfect?(t=this._w%2==0?Math.round(t):Math.round(t-.5)+.5,e=this._h%2==0?Math.round(e):Math.round(e-.5)+.5):(t=n(t),e=n(e));for(let t of this.joints)t.visible?this._uid==t.spriteA._uid?(!t.spriteB._visible||this.layer<=t.spriteB.layer)&&t._display():(!t.spriteA._visible||this.layer<t.spriteA.layer)&&t._display():t.visible??=!0;this.p.push(),this.p.imageMode("center"),this.p.rectMode("center"),this.p.ellipseMode("center"),this.p.translate(t,e),this.rotation&&this.p.rotate(this.rotation),this.p.scale(this._mirror._x,this._mirror._y),this.p.fill(this.color),this._draw(),this.p.pop(),this._cameraActiveWhenDrawn=this.p.camera.active,this.autoDraw&&(this.autoDraw=null)}}_drawFixture(t){const e=t.m_shape;if("polygon"==e.m_type||"chain"==e.m_type){"chain"==e.m_type&&(this.p.push(),this.p.noFill());let t=e.m_vertices;this.p.beginShape();for(let e=0;e<t.length;e++)this.p.vertex(t[e].x*s,t[e].y*s);"chain"!=e.m_type?this.p.endShape("close"):(this.p.endShape(),this.p.pop())}else if("circle"==e.m_type){const t=2*e.m_radius*s;this.p.ellipse(e.m_p.x*s,e.m_p.y*s,t,t)}else"edge"==e.m_type&&this.p.line(e.m_vertex1.x*s,e.m_vertex1.y*s,e.m_vertex2.x*s,e.m_vertex2.y*s)}_args2Vec(t,e){return Array.isArray(t)?{x:t[0],y:t[1]}:("object"==typeof t&&(e=t.y,t=t.x),{x:t||0,y:e||0})}_parseForceArgs(){let t=arguments;"number"!=typeof t[0]||1!=t.length&&"number"==typeof t[1]?2==t.length&&"number"!=typeof t[1]&&(t[2]=t[1],t[1]=void 0):(t[3]=t[2],t[2]=t[1],t[1]=this.p.sin(this._bearing)*t[0],t[0]=this.p.cos(this._bearing)*t[0]);let e={};return e.forceVector=new i.Vec2(this._args2Vec(t[0],t[1])),void 0!==t[2]&&(e.poa=this._args2Vec(t[2],t[3]),e.poa=r(e.poa.x,e.poa.y,this.tileSize)),e}applyForce(t,e,i,s){if(!this.body)return;if("game.thegamebox.ca"==location.host)return this.applyForceScaled(...arguments);let{forceVector:r,poa:o}=this._parseForceArgs(...arguments);o?this.body.applyForce(r,o):this.body.applyForceToCenter(r)}applyForceScaled(){if(!this.body)return;let{forceVector:t,poa:e}=this._parseForceArgs(...arguments);t.mul(this.mass),e?this.body.applyForce(t,e):this.body.applyForceToCenter(t)}attractTo(t,e,s,r,o){if(!this.body)return;if("number"!=typeof t){let i=t;if(!i||i==this.p.mouse&&!this.p.mouse.active)return;s=e,e=i.y,t=i.x}if(this.x==t&&this.y==e)return;let h=e-this.y,n=t-this.x,a=s/Math.sqrt(h*h+n*n),l=new i.Vec2(n*a,h*a);this.body.applyForceToCenter(l)}repelFrom(t,e,i,s,r){if(this.body){if("number"!=typeof t){let s=t;if(!s||s==this.p.mouse&&!this.p.mouse.active)return;i=e,e=s.y,t=s.x}this.attractTo(t,e,-i,s,r)}}applyTorque(t){this.body&&this.body.applyTorque(t)}moveTowards(t,e,i){if(void 0!==t){if("number"!=typeof t&&null!==t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;if(!s||void 0===s.x||void 0===s.y)throw"sprite.moveTowards/moveAway ERROR: movement destination not defined.";i=e,e=s.y,t=s.x}if(i??=.1,null!=t){let e=t-this.x;h(e)?this.vel.x=0:this.vel.x=e*i*this.tileSize}if(null!=e){let t=e-this.y;h(t)?this.vel.y=0:this.vel.y=t*i*this.tileSize}}}moveAway(t,e,i){this.moveTowards(...arguments),this.vel.x*=-1,this.vel.y*=-1}move(t,e,i){let s=isNaN(arguments[0]);if(s?(e=arguments[0],i=arguments[1],t=1):s=isNaN(e),!t)return;"string"==typeof e&&(this._heading=e,e=this._getDirectionAngle(e)),e??=this.direction;let r=this.x+this.p.cos(e)*t,o=this.y+this.p.sin(e)*t;return s&&this.tileSize>1?(r=Math.round(r),o=Math.round(o)):e%90==0&&(r=n(r),o=n(o)),this.moveTo(r,o,i)}moveTo(e,i,s){if("number"!=typeof e){let t=e;if(t==this.p.mouse&&!this.p.mouse.active)return;if(!t||void 0===t.x||void 0===t.y)throw"sprite.moveTo ERROR: destination not defined.";s=i,i=t.y,e=t.x}if(this._dest.x=this.x,this._dest.y=this.y,e==this.x?e=!1:(this._dest.x=e,e=!0),i==this.y?i=!1:(this._dest.y=i,i=!0),this._destIdx++,!e&&!i)return Promise.resolve(!0);if(this.speed&&(s??=this.speed),this.tileSize>1&&(s??=.1),s??=1,s<=0)return console.warn("sprite.move: speed should be a positive number"),Promise.resolve(!1);let r=this._dest.y-this.y,o=this._dest.x-this.x,h=s/Math.sqrt(r*r+o*o);this.vel.x=o*h,this.vel.y=r*h;let n=this.direction,a=n-.1,l=n+.1,p=s+.01,d=this._destIdx,u=Math.max(this.p.world.velocityThreshold,.25*p)/this.tileSize;return(async()=>{let s=p+p,r=p+p;do{if(d!=this._destIdx)return!1;await t.delay();let e=this.direction;if(e<=a||e>=l||Math.abs(this.vel.x)<=u&&Math.abs(this.vel.y)<=u)return!1;s=Math.abs(this.x-this._dest.x),r=Math.abs(this.y-this._dest.y)}while(e&&s>p||i&&r>p);return s<p&&(this.x=this._dest.x),r<p&&(this.y=this._dest.y),this.vel.x=0,this.vel.y=0,!0})()}rotateTowards(t,e){if(1==this.__collider)throw new v(0);let i,s,r,o=arguments;"number"!=typeof o[0]?(i=o[0].x,s=o[0].y,e=o[1],r=o[2]):arguments.length>2&&(i=o[0],s=o[1],e=o[2],r=o[3]),void 0!==i?t=this.angleToFace(i,s,r):t-=this.rotation,e??=.1,this.rotationSpeed=t*e}angleTo(t,e){if("object"==typeof t){let i=t;if(i==this.p.mouse&&!this.p.mouse.active)return 0;if(void 0===i.x||void 0===i.y)return console.error("sprite.angleTo ERROR: rotation destination not defined, object given with no x or y properties"),0;e=i.y,t=i.x}return this.p.atan2(e-this.y,t-this.x)}angleToFace(t,e,i){if("object"==typeof t&&(i=e,e=t.y,t=t.x),Math.abs(t-this.x)<.01&&Math.abs(e-this.y)<.01)return 0;let s=this.angleTo(t,e);i??=0,s+=i;let r=s-this.rotation%360,o=360-Math.abs(r);return o*=r<0?1:-1,Math.abs(r)<Math.abs(o)?r:o}rotateTo(t,e){if(1==this.__collider)throw new v(0);let i,s,r,o=arguments;if("number"!=typeof o[0]?(i=o[0].x,s=o[0].y,e=o[1],r=o[2]):arguments.length>2&&(i=o[0],s=o[1],e=o[2],r=o[3]),void 0!==i)t=this.angleToFace(i,s,r);else{if(t==this.rotation)return;t-=this.rotation}return this.rotate(t,e)}rotate(e,i){if(1==this.__collider)throw new v(0);if(isNaN(e))throw new v(1,[e]);if(0==e)return;let s=Math.abs(e);i??=1,i>s&&(i=s);let r=this.rotation+e,o=e>0;this.rotationSpeed=i*(o?1:-1);let h=Math.floor(s/i)-1;this._rotateIdx??=0,this._rotateIdx++;let n=this._rotateIdx;return(async()=>{if(h>1){let e=Math.abs(this.rotationSpeed)+.01;do{if(this._rotateIdx!=n)return!1;if(await t.delay(),o&&this.rotationSpeed<.01||!o&&this.rotationSpeed>-.01)return!1}while((o&&r>this.rotation||!o&&r<this.rotation)&&e<Math.abs(r-this.rotation));Math.abs(r-this.rotation)>.01&&(this.rotationSpeed=r-this.rotation,await t.delay())}else await t.delay();return this._rotateIdx==n&&(this.rotationSpeed=0,this.rotation=r,!0)})()}async changeAni(t){if(this.p.p5play.disableImages)return;if(arguments.length>1)t=[...arguments];else if(t instanceof this.p.SpriteAnimation){if(t==this._ani)return;t=[t]}else if(!Array.isArray(t)){if(t==this._ani?.name)return;t=[t]}let e,i;this._aniChangeCount++;for(let s=0;s<t.length;s++){let r=t[s];(r instanceof this.p.SpriteAnimation||r instanceof p5.Image||"string"==typeof r&&1!=r.length&&r.includes("."))&&(r=this.addAni(r),t[s]=r),"string"==typeof r&&(r={name:r},t[s]=r),r.name.length>1&&("!"==r.name[0]&&(r.name=r.name.slice(1),r.start=-1,r.end=0),"<"!=r.name[0]&&">"!=r.name[0]||(r.name=r.name.slice(1),r.flipX=!0),"^"==r.name[0]&&(r.name=r.name.slice(1),r.flipY=!0),"**"==r.name&&(e=!0,t=t.slice(0,-1)),";;"==r.name&&(i=!0,t=t.slice(0,-1)))}let s=this._aniChangeCount;do{for(let e=0;e<t.length;e++){let i=t[e];!i.start&&t.length>1&&(i.start=0),await this._playSequencedAni(i)}}while(e&&s==this._aniChangeCount);1!=t.length&&i&&this._ani.stop()}_playSequencedAni(t){return new Promise((e=>{let{name:i,start:s,end:r,flipX:o,flipY:h}=t;this._changeAni(i),o&&(this._ani.scale.x=-this._ani.scale.x),h&&(this._ani.scale.y=-this._ani.scale.y),s<0&&(s=this._ani.length+s),void 0!==s&&(this._ani.frame=s),void 0!==r?this._ani.goToFrame(r):this._ani.frame==this._ani.lastFrame&&e(),this._ani._onComplete=this._ani._onChange=()=>{o&&(this._ani.scale.x=-this._ani.scale.x),h&&(this._ani.scale.y=-this._ani.scale.y),this._ani._onComplete=this._ani._onChange=null,e()}}))}changeAnimation(){return this.changeAni(...arguments)}_changeAni(t){this._ani?._onChange&&this._ani._onChange(),this._ani?.onChange&&this._ani.onChange();let e=this.animations[t];if(!e)for(let i=this.groups.length-1;i>=0;i--){if(e=this.groups[i].animations[t],e){e=e.clone();break}}if(!e)throw this.p.noLoop(),new v("Sprite.changeAnimation",[t]);this._ani=e,this._ani.name=t,this.resetAnimationsOnChange&&(this._ani.frame=0)}remove(){this.removed=!0}_remove(){this.body&&this.p.world.destroyBody(this.body),this.body=null;for(let t of this.groups)t.remove(this);0==Object.keys(this._collisions).length&&0==Object.keys(this._overlappers).length&&delete this.p.p5play.sprites[this._uid]}toString(){return"s"+this.idNum}_ensureCollide(t,e){if(!t)throw new v("Sprite.collide",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new v("Sprite.collide",0,[t]);if(e&&"function"!=typeof e)throw new v("Sprite.collide",1,[e]);if(!1!==this._hasOverlap[t._uid]&&(this._hasOverlap[t._uid]=!1),!1!==t._hasOverlap[this._uid]&&(t._hasOverlap[this._uid]=!1,t instanceof this.p.Group))for(let e of t)e._hasOverlap[this._uid]=!1}collide(t,e){return this.collides(t,e)}collides(t,e){return this._ensureCollide(t,e),this._collides[t._uid]=e||!0,1==this._collisions[t._uid]}colliding(t,e){this._ensureCollide(t,e),this._colliding[t._uid]=e||!0;let i=this._collisions[t._uid];return i>0?i:0}collided(t,e){return this._ensureCollide(t,e),this._collided[t._uid]=e||!0,-1==this._collisions[t._uid]}_removeContactsWith(t){if(t instanceof this.p.Group)for(let e of t)this._removeContactsWith(e);else this.__removeContactsWith(t)}__removeContactsWith(t){if(this.body)for(let e=this.body.getContactList();e;e=e.next){let i=e.contact;i.m_fixtureA.m_body.sprite._uid!=t._uid&&i.m_fixtureB.m_body.sprite._uid!=t._uid||this.p.world.destroyContact(i)}}_ensureOverlap(t,e){if(!t)throw new v("Sprite.overlap",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new v("Sprite.overlap",0,[t]);if(e&&"function"!=typeof e)throw new v("Sprite.overlap",1,[e]);if(this._hasSensors||this.addDefaultSensors(),!t._hasSensors)if(t instanceof this.p.Sprite)t.addDefaultSensors();else{for(let e of t)e._hasSensors||e.addDefaultSensors();t._hasSensors=!0}if(1!=this._hasOverlap[t._uid]&&(this._removeContactsWith(t),this._hasOverlap[t._uid]=!0),1!=t._hasOverlap[this._uid]&&(t._removeContactsWith(this),t._hasOverlap[this._uid]=!0,t instanceof this.p.Group))for(let e of t)e._hasOverlap[this._uid]=!0}overlap(t,e){return this.overlaps(t,e)}overlaps(t,e){return this._ensureOverlap(t,e),this._overlaps[t._uid]=e||!0,1==this._overlappers[t._uid]}overlapping(t,e){this._ensureOverlap(t,e),this._overlapping[t._uid]=e||!0;let i=this._overlappers[t._uid];return i>0?i:0}overlapped(t,e){return this._ensureOverlap(t,e),this._overlapped[t._uid]=e||!0,-1==this._overlappers[t._uid]}_sortFixtures(){let t=null,e=null;for(let i=this.fixtureList;i;i=i.getNext())i.m_isSensor?e?e.m_next=i:e=i:t?t.m_next=i:t=i;e&&(e.m_next=null),t&&(t.m_next=e),this.body.m_fixtureList=t||e}addDefaultSensors(){let t;if(this.body){for(let e=this.fixtureList;e;e=e.getNext())e.m_isSensor||(t=e.m_shape,this.body.createFixture({shape:t,isSensor:!0}));this._sortFixtures()}else this.addSensor();this._hasSensors=!0}},this.Sprite.propTypes={x:"Float64",y:"Float64",vel:"Vec2",rotation:"number",rotationSpeed:"number",ani:"string",autoDraw:"boolean",allowSleeping:"boolean",autoUpdate:"boolean",bounciness:"number",collider:"Uint8",color:"color",debug:"boolean",density:"number",direction:"number",drag:"number",friction:"number",h:"number",isSuperFast:"boolean",layer:"number",life:"Int32",mass:"number",mirror:"Vec2_boolean",offset:"Vec2",pixelPerfect:"boolean",removed:"boolean",rotationDrag:"number",rotationLock:"boolean",scale:"Vec2",shape:"Uint8",sleeping:"boolean",stroke:"color",strokeWeight:"number",text:"string",textColor:"color",tile:"string",tileSize:"number",visible:"boolean",w:"number",bearing:"number"},this.Sprite.props=Object.keys(this.Sprite.propTypes),this.Sprite.propsAll=this.Sprite.props.concat(["d","diameter","dynamic","fill","height","heading","kinematic","resetAnimationsOnChange","speed","static","width"]),this.Sprite.colliderTypes=["d","s","k","n"],this.Sprite.shapeTypes=["box","circle","chain","polygon"],this.Turtle=function(e){if(t.allSprites.tileSize>1)throw new Error("Turtle can't be used when allSprites.tileSize is greater than 1.");e??=25;let i=new t.Sprite(e,e,[[e,.4*e],[-e,.4*e],[0,.8*-e]]);i.color="green",i._isTurtleSprite=!0,i._prevPos={x:i.x,y:i.y};let s=i.move;return i.move=async function(){this._prevPos.x=this.x,this._prevPos.y=this.y,await s.call(this,...arguments)},i},this.SpriteAnimation=class extends Array{constructor(){super(),this.p=t;let e,i=[...arguments];if(this.name="default",(i[0]instanceof this.p.Sprite||i[0]instanceof this.p.Group)&&(e=i[0],i=i.slice(1),this._addedToSpriteOrGroup=!0),e??=this.p.allSprites,"string"!=typeof i[0]||1!=i[0].length&&i[0].includes(".")||(this.name=i[0],i=i.slice(1)),this.frame=0,this._cycles=0,this.targetFrame=-1,this.offset={x:e.anis.offset.x||0,y:e.anis.offset.y||0},this._frameDelay=e.anis.frameDelay||4,this.demoMode=e.anis.demoMode||!1,this.playing=!0,this.visible=!0,this.looping=e.anis.looping,this.looping??=!0,this.endOnFirstFrame=!1,this.frameChanged=!1,this.onComplete=this.onChange=null,this._onComplete=this._onChange=null,this.rotation=e.anis.rotation||0,this._scale=new l,0!=i.length&&"number"!=typeof i[0])if(e.animations[this.name]=this,e._ani=this,Array.isArray(i[0])&&"string"==typeof i[0][0]&&(i=[...i[0]]),2!=i.length||"string"!=typeof i[0]||"string"!=typeof i[1]&&"number"!=typeof i[1])if("string"==typeof i[i.length-1]||i[i.length-1]instanceof p5.Image)for(let s=0;s<i.length;s++)i[s]instanceof p5.Image?this.push(i[s]):this.push(this.p.loadImage(i[s]));else{let r,o=e.spriteSheet;if(i[0]instanceof p5.Image||"string"==typeof i[0]){if(i.length>=3)throw new v("SpriteAnimation",1);o=i[0],r=i[1]}else r=i[0];let h=this;if(o instanceof p5.Image&&1!=o.width&&1!=o.height)this.spriteSheet=o,n();else{let a;a="string"==typeof o?o:o.url,this.spriteSheet=this.p.loadImage(a,(()=>{n()}))}function n(){if(Array.isArray(r)||Array.isArray(r.frames)){if("number"!=typeof r[0]){let t=r;if(Array.isArray(r.frames)){t=r.frames,delete r.frames;for(let e=0;e<t.length;e++)t[e]={pos:t[e]},Object.assign(t[e],r)}for(let e of t)r=e,n();return}r=4==r.length?{pos:r.slice(0,2),size:r.slice(2)}:{pos:r}}let{w:t,h:i,width:s,height:o,size:a,row:l,col:p,line:d,x:u,y:c,pos:_,frames:f,frameCount:g,frameDelay:y,frameSize:m,delay:w,rotation:x}=r;m??=a||e.anis.frameSize,w&&(h.frameDelay=w),y&&(h.frameDelay=y),x&&(h.rotation=x),g??=f||1,t??=s||e.anis.w,i??=o||e.anis.h,u??=p||0,c??=d||l||0,_&&(u=_[0],c=_[1]),"number"==typeof m?t=i=m:m&&(t=m[0],i=m[1]);let v=e.tileSize;t&&i?(t*=v,i*=v):!e._dimensionsUndef&&e.w&&e.h?(t=e.w,i=e.h):v?t=i=v:g?(t=h.spriteSheet.width/g,i=h.spriteSheet.height):t=i=h.spriteSheet.width<h.spriteSheet.height?h.spriteSheet.width:h.spriteSheet.height,1!=v?(u*=v,c*=v):void 0===d&&void 0===l&&void 0===p||(u*=t,c*=i);for(let e=0;e<g;e++)h.push({x:u,y:c,w:t,h:i}),u+=t,u>=h.spriteSheet.width&&(u=0,c+=i,c>=h.spriteSheet.height&&(c=0))}}else{let p,d,u=i[0];if(isNaN(i[1])?p=i[1]:d=Number(i[1]),".png"!=u.slice(-4)||p&&".png"!=p.slice(-4))throw new v("SpriteAnimation",0,[u]);let c=0,_=0;for(let y=u.length-5;y>=0&&!isNaN(u.charAt(y));y--)c++;if(p)for(let m=p.length-5;m>=0&&!isNaN(p.charAt(m));m--)_++;let f,g=u.slice(0,-4-c);if(p&&(f=p.slice(0,-4-_)),p&&g!=f)this.push(this.p.loadImage(u)),this.push(this.p.loadImage(p));else{let w,x=parseInt(u.slice(-4-c,-4),10);if(d??=parseInt(p.slice(-4-_,-4),10),d<x){let b=d;d=x,x=b}if(p&&c!=_)for(let S=x;S<=d;S++)w=g+S+".png",this.push(this.p.loadImage(w));else for(let A=x;A<=d;A++)w=g+this.p.nf(A,c)+".png",this.push(this.p.loadImage(w))}}}get frameDelay(){return this._frameDelay}set frameDelay(t){t<=0&&(t=1),this._frameDelay=t}get scale(){return this._scale}set scale(t){"number"==typeof t&&(t={x:t,y:t}),this._scale._x=t.x,this._scale._y=t.y,this._scale._avg=t.x}clone(){let t=new this.p.SpriteAnimation;t.spriteSheet=this.spriteSheet;for(let e=0;e<this.length;e++)t.push(this[e]);return t.offset.x=this.offset.x,t.offset.y=this.offset.y,t.frameDelay=this.frameDelay,t.playing=this.playing,t.looping=this.looping,t.rotation=this.rotation,t}draw(t,i,s,r,o){if(this.x=t||0,this.y=i||0,!this.visible)return;r??=1,o??=1,this.p.push(),this.p.imageMode("center"),this.p.translate(this.x,this.y),this.p.rotate(s||this.rotation),this.p.scale(r*this._scale._x,o*this._scale._y);let h=this[this.frame];if(void 0!==h)if(this.spriteSheet){let{x:t,y:e,w:i,h:s}=h;this.demoMode?this.p.image(this.spriteSheet,this.offset.x,this.offset.y,this.spriteSheet.w,this.spriteSheet.h,t-this.spriteSheet.w/2+i/2,e-this.spriteSheet.h/2+s/2):this.p.image(this.spriteSheet,this.offset.x,this.offset.y,i,s,t,e,i,s)}else this.p.image(h,this.offset.x,this.offset.y);else e("Warning: "+this.name+" animation not loaded yet or frame "+this.frame+" does not exist. Load this animation in the p5.js preload function if you need to use it at the start of your program.");this.p.pop()}update(){this._cycles++;this.frame;if(this.frameChanged=!1,1===this.length&&(this.playing=!1,this.frame=0),this.playing&&this._cycles%this.frameDelay==0){if(this.frameChanged=!0,(-1==this.targetFrame&&this.frame==this.lastFrame||this.frame==this.targetFrame)&&(this.endOnFirstFrame&&(this.frame=0),this.looping?this.targetFrame=-1:this.playing=!1,this._onComplete&&this._onComplete(),this.onComplete&&this.onComplete(),!this.looping))return;this.targetFrame>this.frame&&-1!==this.targetFrame?this.frame++:this.targetFrame<this.frame&&-1!==this.targetFrame?this.frame--:this.targetFrame===this.frame&&-1!==this.targetFrame?this.playing=!1:this.looping?this.frame>=this.lastFrame?this.frame=0:this.frame++:this.frame<this.lastFrame&&this.frame++}}play(t){return this.playing=!0,void 0!==t&&(this.frame=t),this.targetFrame=-1,new Promise((t=>{this._onComplete=()=>{this._onComplete=null,t()}}))}pause(t){this.playing=!1,t&&(this.frame=t)}stop(t){this.playing=!1,t&&(this.frame=t)}rewind(){return this.looping=!1,this.goToFrame(0)}loop(){this.looping=!0,this.playing=!0}noLoop(){this.looping=!1}nextFrame(){this.frame<this.length-1?this.frame=this.frame+1:this.looping&&(this.frame=0),this.targetFrame=-1,this.playing=!1}previousFrame(){this.frame>0?this.frame=this.frame-1:this.looping&&(this.frame=this.length-1),this.targetFrame=-1,this.playing=!1}goToFrame(t){if(!(t<0||t>=this.length))return this.targetFrame=t,this.targetFrame!==this.frame&&(this.playing=!0),new Promise((t=>{this._onComplete=()=>{this._onComplete=null,t()}}))}get lastFrame(){return this.length-1}get frameImage(){let t=this[this.frame];if(t instanceof p5.Image)return t;let{x:e,y:i,w:s,h:r}=t,o=createGraphics(s,r);return o.image(this.spriteSheet,this.offset.x,this.offset.y,s,r,e,i,s,r),o}get w(){return this.width}get width(){return this[this.frame]instanceof p5.Image?this[this.frame].width:this[this.frame]?this[this.frame].w:1}get h(){return this.height}get height(){return this[this.frame]instanceof p5.Image?this[this.frame].height:this[this.frame]?this[this.frame].h:1}get frames(){let t=[];for(let e=0;e<this.length;e++)t.push(this[e]);return t}get images(){return this.frames}},this.SpriteAnimation.props=["frameDelay","frameSize","looping","offset","rotation","scale","demoMode"],this.SpriteAnimations=class{#t={};constructor(){let e=this,i=[...t.SpriteAnimation.props],s=["offset","scale"];for(let t of i)Object.defineProperty(this,t,{get:()=>e.#t[t],set(i){e.#t[t]=i;for(let s in e){let r=e[s];r instanceof SpriteAnimation&&(r[t]=i)}}});for(let t of s){this.#t[t]={_x:0,_y:0};for(let i of["x","y"])Object.defineProperty(this.#t[t],i,{get:()=>e.#t[t]["_"+i],set(s){e.#t[t]["_"+i]=s;for(let r in e){let o=e[r];o instanceof SpriteAnimation&&(o[t][i]=s)}}})}}},this.Group=class extends Array{constructor(...e){let i;if(e[0]instanceof t.Group&&(i=e[0],e=e.slice(1)),super(...e),this.p=t,"number"==typeof e[0])return;for(let t of this)if(!(t instanceof this.p.Sprite))throw new Error("A group can only contain sprites");if(this.idNum=this.p.p5play.groupsCreated,this._uid=this.idNum,this.p.p5play.groups[this._uid]=this,this.p.p5play.groupsCreated++,this.p.allSprites||(this._isAllSpritesGroup=!0),this.subgroups=[],i instanceof this.p.Group){i.subgroups.push(this);let t=i;do{t=this.p.p5play.groups[t.parent],t.subgroups.push(this)}while(!t._isAllSpritesGroup);this.parent=i._uid}else this._isAllSpritesGroup||(this.p.allSprites.subgroups.push(this),this.parent=0);this.animations=new this.p.SpriteAnimations,this._collides={},this._colliding={},this._collided={},this._hasOverlap={},this._overlaps={},this._overlapping={},this._overlapped={},this._collisions={},this._overlappers={};let s=this;this.Sprite=class extends this.p.Sprite{constructor(){super(s,...arguments)}},this.GroupSprite=this.Sprite,this.Group=class extends this.p.Group{constructor(){super(s,...arguments)}},this.Subgroup=this.Group,this.mouse={presses:null,pressing:null,pressed:null,holds:null,holding:null,held:null,released:null,hovers:null,hovering:null,hovered:null};for(let t in this.mouse)this.mouse[t]=function(e){for(let i of s)if(i.mouse[t](e))return!0;return!1};let r=[...this.p.Sprite.propsAll,"spriteSheet"];for(let t of r)"ani"!=t&&"velocity"!=t&&Object.defineProperty(this,t,{get(){let e=s["_"+t],i=s.length-1;if(void 0===e&&!s._isAllSpritesGroup){let r=this.p.p5play.groups[s.parent];r&&(e=r[t],i=r.length-1)}return e},set(e){s["_"+t]=e;for(let i=0;i<s.length;i++){let r=s[i],o=e;"function"==typeof e&&(o=e(i)),r[t]=o}}});let o=["mirror","offset","scale","vel"];for(let t of o){t="_"+t,this[t]="vel"!=t?{}:new this.p.Vector,this[t]._x=0,this[t]._y=0;for(let e of["x","y"])Object.defineProperty(this[t],e,{get(){let i=s[t]["_"+e],r=s.length-1;if(void 0===i&&!s._isAllSpritesGroup){let o=s.p.p5play.groups[s.parent];o&&(i=o[t][e],r=o.length-1)}return i},set(i){s[t]["_"+e]=i;for(let r=0;r<s.length;r++){let o=s[r],h=i;"function"==typeof i&&(h=i(r)),o[t][e]=h}}})}this._isAllSpritesGroup&&(this.autoCull=!0,this.tileSize=1,this.autoDraw=!0,this.autoUpdate=!0),this.add=this.push,this.contains=this.includes}_getTopLayer(){if(0==this.length)return 0;if(1==this.length&&void 0===this[0]._layer)return 0;let t=this[0]._layer;for(let e of this)e._layer>t&&(t=e._layer);return t}get ani(){return this._ani}set ani(t){this.addAni(t);for(let e of this)e.changeAni(t)}get animation(){return this._ani}set animation(t){this.ani=t}get anis(){return this.animations}get img(){return this._ani.frameImage}set img(t){this.ani=t}get image(){return this._ani.frameImage}set image(t){this.ani=t}set amount(t){let e=t-this.length,i=e>0;e=Math.abs(e);for(let t=0;t<e;t++)i?new this.Sprite:this[this.length-1].remove()}_resetCentroid(){let t=0,e=0;for(let i of this)t+=i.x,e+=i.y;return this.centroid={x:t/this.length,y:e/this.length},this.centroid}_resetDistancesFromCentroid(){for(let t of this)t.distCentroid={x:t.x-this.centroid.x,y:t.y-this.centroid.y}}_ensureCollide(t,e){if(!t)throw new v("Group.collide",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new v("Group.collide",0,[t]);if(e&&"function"!=typeof e)throw new v("Group.collide",1,[e]);if(!1!==this._hasOverlap[t._uid]){this._hasOverlap[t._uid]=!1;for(let e of this)e._hasOverlap[t._uid]=!1}if(!1!==t._hasOverlap[this._uid]&&(t._hasOverlap[this._uid]=!1,t instanceof this.p.Group))for(let e of t)e._hasOverlap[this._uid]=!1}collide(t,e){return this.collides(t,e)}collides(t,e){return this._ensureCollide(t,e),this._collides[t._uid]=e||!0,1==this._collisions[t._uid]}colliding(t,e){this._ensureCollide(t,e),this._colliding[t._uid]=e||!0;let i=this._collisions[t._uid];return i>0?i:0}collided(t,e){return this._ensureCollide(t,e),this._collided[t._uid]=e||!0,-1==this._collisions[t._uid]}_removeContactsWith(t){for(let e of this)e._removeContactsWith(t)}_ensureOverlap(t,e){if(!t)throw new v("Group.overlap",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new v("Group.overlap",0,[t]);if(e&&"function"!=typeof e)throw new v("Group.overlap",1,[e]);if(!this._hasSensors){for(let t of this)t._hasSensors||t.addDefaultSensors();this._hasSensors=!0}if(!t._hasSensors)if(t instanceof this.p.Sprite)t.addDefaultSensors();else{for(let e of t)e._hasSensors||e.addDefaultSensors();t._hasSensors=!0}if(1!=this._hasOverlap[t._uid]){this._removeContactsWith(t),this._hasOverlap[t._uid]=!0;for(let e of this)e._hasOverlap[t._uid]=!0}if(1!=t._hasOverlap[this._uid]&&(t._removeContactsWith(this),t._hasOverlap[this._uid]=!0,t instanceof this.p.Group))for(let e of t)e._hasOverlap[this._uid]=!0}overlap(t,e){return this.overlaps(t,e)}overlaps(t,e){return this._ensureOverlap(t,e),this._overlaps[t._uid]=e||!0,1==this._overlappers[t._uid]}overlapping(t,e){this._ensureOverlap(t,e),this._overlapping[t._uid]=e||!0;let i=this._overlappers[t._uid];return i>0?i:0}overlapped(t,e){return this._ensureOverlap(t,e),this._overlapped[t._uid]=e||!0,-1==this._overlappers[t._uid]}applyForce(){for(let t of this)t.applyForce(...arguments)}applyForceScaled(){for(let t of this)t.applyForceScaled(...arguments)}attractTo(){for(let t of this)t.attractTo(...arguments)}applyTorque(){for(let t of this)t.applyTorque(...arguments)}move(t,e,i){let s=[];for(let r of this)s.push(r.move(t,e,i));return Promise.all(s)}moveTo(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;i=e,e=s.y,t=s.x}let s=this._resetCentroid(),r=[];for(let o of this){let h={x:o.x-s.x+t,y:o.y-s.y+e};r.push(o.moveTo(h.x,h.y,i))}return Promise.all(r)}moveTowards(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;i=e,e=s.y,t=s.x}if(void 0!==t||void 0!==e){this._resetCentroid();for(let s of this){void 0===s.distCentroid&&this._resetDistancesFromCentroid();let r={x:s.distCentroid.x+t,y:s.distCentroid.y+e};s.moveTowards(r.x,r.y,i)}}}moveAway(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;i=e,e=s.y,t=s.x}if(void 0!==t||void 0!==e){this._resetCentroid();for(let s of this){void 0===s.distCentroid&&this._resetDistancesFromCentroid();let r={x:s.distCentroid.x+t,y:s.distCentroid.y+e};s.moveAway(r.x,r.y,i)}}}push(...t){for(let e of t){if(!(e instanceof this.p.Sprite))throw new Error("you can only add sprites to a group, no "+typeof e+"s");for(let t in this._hasOverlap){let i=this._hasOverlap[t];i&&!e._hasSensors&&e.addDefaultSensors(),e._hasOverlap[t]=i}super.push(e),this.parent&&this.p.p5play.groups[this.parent].push(e),e.groups.push(this)}return this.length}size(){return this.length}toString(){return"g"+this.idNum}cull(t,e,i,s,r){if(void 0===i){r=e,t=e=i=s=t}if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(s))throw new TypeError("The culling boundary must be defined with numbers");if(r&&"function"!=typeof r)throw new TypeError("The callback to group.cull must be a function");let o=this.p.camera.x-this.p.world.hw/this.p.camera.zoom,h=this.p.camera.y-this.p.world.hh/this.p.camera.zoom,n=-i+o,a=-t+h,l=this.p.width+s+o,p=this.p.height+e+h,d=0;for(let t=0;t<this.length;t++){let e=this[t];"chain"!=e.shape&&((e.x<n||e.y<a||e.x>l||e.y>p)&&(d++,r?r(e,d):e.remove(),e.removed&&t--))}return d}remove(t){if(void 0===t){for(;this.length>0;)this[0].remove();return}let e;if(e="number"==typeof t?t>=0?t:this.length+t:this.indexOf(t),-1!=e){let t=this[e];if(!t.removed){let e=t.groups.findIndex((t=>t._uid==this._uid));t.groups.splice(e,1)}return this.splice(e,1),t}throw new Error("Sprite not found in group")}removeAll(){this.remove()}draw(){let t=[...this];t.sort(((t,e)=>t._layer-e._layer));for(let e=0;e<t.length;e++){let i=t[e];2147483647!=i._life&&i._life--<0?(i.remove(),t.splice(e,1),e--):!1===i._visible||this.p.p5play._inPostDraw&&!i.autoDraw||i.draw()}this._autoDraw&&(this._autoDraw=null)}update(){for(let t of this)this.p.p5play._inPostDraw&&!this.autoUpdate||t.update();this._autoUpdate&&(this._autoUpdate=null)}},this.Sprite.prototype.addAnimation=this.Group.prototype.addAnimation=this.Sprite.prototype.addAni=this.Group.prototype.addAni=this.Sprite.prototype.addImage=this.Group.prototype.addImage=this.Sprite.prototype.addImg=this.Group.prototype.addImg=function(){if(this.p.p5play.disableImages)return void(this._ani={});let t,e,i=[...arguments];return i[0]instanceof this.p.SpriteAnimation?(e=i[0],e._addedToSpriteOrGroup&&(e=e.clone()),t=e.name||"default",e.name=t):i[1]instanceof this.p.SpriteAnimation?(t=i[0],e=i[1],e._addedToSpriteOrGroup&&(e=e.clone()),e.name=t):(e=new this.p.SpriteAnimation(this,...i),t=e.name),this.animations[t]=e,this._ani=e,e._addedToSpriteOrGroup=!0,!this._dimensionsUndef||1==e.w&&1==e.h||(this.w=e.w,this.h=e.h),e},this.Sprite.prototype.addAnis=this.Group.prototype.addAnis=this.Sprite.prototype.addAnimations=this.Group.prototype.addAnimations=this.Sprite.prototype.addImages=this.Group.prototype.addImages=this.Sprite.prototype.addImgs=this.Group.prototype.addImgs=function(){let t,e=arguments;1==e.length?t=e[0]:(this.spriteSheet=e[0],t=e[1]);for(let e in t){let i=t[e];this.addAni(e,i)}},this.World=class extends i.World{constructor(){super(new i.Vec2(0,0),!0),this.p=t,this.mod=[],this._offset={x:0,y:0};let e=this;this.offset={get x(){return e._offset.x},set x(t){e._offset.x=t||0,e.resize()},get y(){return e._offset.y},set y(t){e._offset.y=t||0,e.resize()}},this.resize(),this.contacts=[],this.on("begin-contact",this._beginContact),this.on("end-contact",this._endContact),this._gravity={get x(){return e.m_gravity.x},set x(t){if((t=Math.round(t||0))!=e.m_gravity.x){e.mod[0]=!0;for(let t of e.p.allSprites)t.sleeping=!1;e.m_gravity.x=t}},get y(){return e.m_gravity.y},set y(t){if((t=Math.round(t||0))!=e.m_gravity.y){e.mod[0]=!0;for(let t of e.p.allSprites)t.sleeping=!1;e.m_gravity.y=t}}},this.velocityThreshold=.19,this.mouseTracking??=!0,this.mouseSprite=null,this.mouseSprites=[],this.autoStep=!0}get gravity(){return this._gravity}set gravity(t){this._gravity.x=t.x,this._gravity.y=t.y}get velocityThreshold(){return this._velocityThreshold}set velocityThreshold(t){i.Settings.velocityThreshold=t,this._velocityThreshold=t}resize(t,e){t??=this.p.width,e??=this.p.height,this.hw=.5*t,this.hh=.5*e,this.origin={x:this.hw-this.offset.x,y:this.hh-this.offset.y},this._tiled&&1!=this.p.allSprites.tileSize&&(this.origin.x-=.5*this.p.allSprites.tileSize,this.origin.y-=.5*this.p.allSprites.tileSize)}get tiled(){return this._tiled}set tiled(t){if(t&&!this._tiled){let t=.5*this.p.allSprites.tileSize;this.origin.x-=t,this.origin.y-=t}if(!1===t&&this._tiled){let t=.5*this.p.allSprites.tileSize;this.origin.x+=t,this.origin.y+=t}this._tiled=t}step(t,e,i){for(let t of this.p.allSprites)t.prevPos.x=t.x,t.prevPos.y=t.y,t.prevRotation=t.rotation;super.step(t||1/(this.p._targetFrameRate||60),e||8,i||3);let s=Object.values(this.p.p5play.sprites);for(let t of s)t._step();this.autoStep&&(this.autoStep=null)}getSpritesAt(t,e,r,o){o??=!0;const h=new i.Vec2(t/s,e/s),n=new i.AABB;n.lowerBound=new i.Vec2(h.x-.001,h.y-.001),n.upperBound=new i.Vec2(h.x+.001,h.y+.001);let a=[];this.queryAABB(n,(t=>(t.getShape().testPoint(t.getBody().getTransform(),h)&&a.push(t),!0))),r??=this.p.allSprites;let l=[];if(a.length>0)for(let t of r)t.body&&a.includes(t.body.m_fixtureList)&&t._cameraActiveWhenDrawn==o&&l.push(t);return l}getSpriteAt(t,e,i){let s=this.getSpritesAt(t,e,i);return s.sort(((t,e)=>-1*(t._layer-e._layer))),s[0]}_beginContact(t){let e=t.m_fixtureA,i=t.m_fixtureB,s="_collisions";e.m_isSensor&&(s="_overlappers"),e=e.m_body.sprite,i=i.m_body.sprite,e[s][i._uid]=0,i[s][e._uid]=0;for(let t of i.groups)(!e[s][t._uid]||e[s][t._uid]<0)&&(t[s][e._uid]=0,e[s][t._uid]=0);for(let t of e.groups){(!i[s][t._uid]||i[s][t._uid]<0)&&(t[s][i._uid]=0,i[s][t._uid]=0);for(let e of i.groups)(!t[s][e._uid]||t[s][e._uid]<0)&&(t[s][e._uid]=0,e[s][t._uid]=0)}}_endContact(t){let e=t.m_fixtureA,i=t.m_fixtureB,s="_collisions";e.m_isSensor&&(s="_overlappers"),e=e.m_body.sprite,i=i.m_body.sprite,e[s][i._uid]=0!=e[s][i._uid]?-2:-3,i[s][e._uid]=0!=i[s][e._uid]?-2:-3;for(let t of i.groups){let i=!1;for(let r of t)if(r[s][e._uid]>=0){i=!0;break}i||(t[s][e._uid]=0!=t[s][e._uid]?-2:-3,e[s][t._uid]=0!=e[s][t._uid]?-2:-3)}for(let t of e.groups){let e=!1;for(let r of t)if(r[s][i._uid]>=0){e=!0;break}if(!e){t[s][i._uid]=0!=t[s][i._uid]?-2:-3,i[s][t._uid]=0!=i[s][t._uid]?-2:-3;for(let e of i.groups)t[s][e._uid]=0!=t[s][e._uid]?-2:3,e[s][t._uid]=0!=e[s][t._uid]?-2:3}}}_findContact(t,e,i,s){let r=e[t][i._uid];if(r&&(!s||!0!==r))return r;let o=i instanceof this.p.Sprite;if(o)for(let o of i.groups)if(r=e[t][o._uid],r&&(!s||!0!==r))return r;if(e instanceof this.p.Sprite)for(let h of e.groups){if(r=h[t][i._uid],r&&(!s||!0!==r))return r;if(o)for(let o of i.groups)if(r=h[t][o._uid],r&&(!s||!0!==r)&&(h._uid!=o._uid||e._uid<i._uid))return r}return!1}get allowSleeping(){return this.getAllowSleeping()}set allowSleeping(t){this.setAllowSleeping(t)}},this.Camera=class{constructor(e,i,s){this.p=t;this._pos={x:0,y:0},this.__pos={x:0,y:0},this.mouse={x:this.p.mouseX,y:this.p.mouseY},this.active=!1,this.bound={min:{x:0,y:0},max:{x:0,y:0}},this._zoomIdx=-1,this._zoom=s||1,this.x=e||0,this.y=i||0}get pos(){return this._pos}set pos(t){this.x=t.x,this.y=t.y}get position(){return this._pos}set position(t){this.x=t.x,this.y=t.y}_calcBoundsX(t){let e=this.p.world.hw/this._zoom;this.bound.min.x=t-e-100,this.bound.max.x=t+e+100}_calcBoundsY(t){let e=this.p.world.hh/this._zoom;this.bound.min.y=t-e-100,this.bound.max.y=t+e+100}get x(){return this._pos.x}set x(t){this._pos.x=t;let e=-t+this.p.world.hw/this._zoom;this.p.allSprites.pixelPerfect&&(e=Math.round(e)),this.__pos.x=e,this._calcBoundsX(t)}get y(){return this._pos.y}set y(t){this._pos.y=t;let e=-t+this.p.world.hh/this._zoom;this.p.allSprites.pixelPerfect&&(e=Math.round(e)),this.__pos.y=e,this._calcBoundsY(t)}get zoom(){return this._zoom}set zoom(t){this._zoom=t;let e=-this._pos.x+this.p.world.hw/t,i=-this._pos.y+this.p.world.hh/t;this.p.allSprites.pixelPerfect&&(e=Math.round(e),i=Math.round(i)),this.__pos.x=e,this.__pos.y=i,this._calcBoundsX(this._pos.x),this._calcBoundsY(this._pos.y)}zoomTo(t,e){if(t==this._zoom)return Promise.resolve(!0);e??=.1;let i=Math.abs(t-this._zoom),s=Math.round(i/e);t<this.zoom&&(e=-e),this._zoomIdx++;let r=this._zoomIdx;return(async()=>{for(let t=0;t<s;t++){if(r!=this._zoomIdx)return!1;this.zoom+=e,await this.p.delay()}return this.zoom=t,!0})()}on(){this.active||(this.p.push(),this.p.scale(this._zoom),this.p.translate(this.__pos.x,this.__pos.y),this.active=!0)}off(){this.active&&(this.p.pop(),this.active=!1)}},i.Fixture.prototype.shouldCollide=function(t){let e=this,i=t;if(e.m_isSensor&&i.m_isSensor)return!0;if(e.m_isSensor||i.m_isSensor)return!1;e=e.m_body.sprite,i=i.m_body.sprite;let s=e.p.world._findContact("_hasOverlap",e,i);return s||(s=e.p.world._findContact("_hasOverlap",i,e)),!s},this.Tiles=class{constructor(e,i,s,r,o){"string"==typeof e&&("\n"==e[0]&&(e=e.slice(1)),e=(e=e.replaceAll("\t","  ")).split("\n")),i??=0,s??=0,r??=1,o??=1;let h=new t.Group;for(let n=0;n<e.length;n++)for(let a=0;a<e[n].length;a++){let l,p,d=e[n][a];if(" "==d||"."==d)continue;let u=Object.values(t.p5play.groups);for(p of u)if(l=p.animations[d],l)break;if(l){h.push(new p.Sprite(l,i+a*r,s+n*o));continue}let c,_=!1;for(p of u)if(p.tile==d){_=!0;break}if(_)h.push(new p.Sprite(i+a*r,s+n*o));else{for(c of t.allSprites)if(c.tile==d){_=!0;break}if(!_)throw"Tile not found: "+d;c.x=i+a*r,c.y=s+n*o}}return h}},this.createTiles=function(t,e,i,s,r){return new this.Tiles(t,e,i,s,r)},this.Joint=class{constructor(e,r,o){if(this.p=t,this.spriteA=e,this.spriteB=r,o??="glue",this.type=o,"glue"==o){let t=i.WeldJoint({},e.body,r.body,e.body.getWorldCenter());this._createJoint(t)}let h=this;for(let e of["A","B"]){if("A"==e&&"wheel"==o)continue;if("B"==e&&"hinge"==o)break;const i="_offset"+e;this[i]=t.createVector.call(t);for(let t of["x","y"])Object.defineProperty(this[i],t,{get(){let i=h._j["m_localAnchor"+e][t]/h["sprite"+e].tileSize*s;return n(i)},set(i){h._j["m_localAnchor"+e][t]=i/s*h["sprite"+e].tileSize}})}let a=[];"distance"!=o&&"glue"!=o&&"rope"!=o||a.push("enableMotor","maxPower","motorSpeed","power","speed"),"rope"==o&&a.push("damping","springiness"),"hinge"==o||"glue"==o?a.push("offsetB"):"wheel"==o&&a.push("offsetA");let l={};for(let t of a)l[t]={value:null,enumerable:!1};Object.defineProperties(this,l),this.visible=!0,e.joints.push(this),r.joints.push(this)}_createJoint(t){this._j=this.p.world.createJoint(t)}_display(){this._draw(this.spriteA.x+this.offsetA.x,this.spriteA.y+this.offsetA.y,this.spriteB.x,this.spriteB.y),this.visible=null}_draw(t,e,i,s){s?this.p.line(t,e,i,s):this.p.point(t,e)}get draw(){return this._display}set draw(t){this._draw=t}get offsetA(){return this._offsetA}set offsetA(t){this._offsetA.x=t.x,this._offsetA.y=t.y}get offsetB(){return this._offsetB}set offsetB(t){this._offsetB.x=t.x,this._offsetB.y=t.y}get springiness(){return this._springiness}set springiness(t){t>0&&(t=t<.1?this.p.map(t,0,.1,30,4):t<.5?this.p.map(t,.1,.5,4,2.5):t<.8?this.p.map(t,.5,.8,2.5,1):t<.9?this.p.map(t,.8,.9,1,.5):this.p.map(t,.9,1,.5,.2)),this._springiness=t,"wheel"==this.type?this._j.setSpringFrequencyHz(t):this._j.setFrequency(t)}get damping(){return"wheel"!=this.type?this._j.getDampingRatio():this._j.getSpringDampingRatio()}set damping(t){"wheel"==this.type?this._j.setSpringDampingRatio(t):this._j.setDampingRatio(t)}get speed(){return this._j.getJointSpeed()}set speed(t){this._j.isMotorEnabled()||this._j.enableMotor(!0),this._j.setMotorSpeed(t)}get motorSpeed(){return this._j.getMotorSpeed()}get enableMotor(){return this._j.isMotorEnabled()}set enableMotor(t){this._j.enableMotor(t)}get maxPower(){return this._j.getMaxMotorTorque()}set maxPower(t){!this._j.isMotorEnabled()&&t&&this._j.enableMotor(!0),this._j.setMaxMotorTorque(t),t||this._j.enableMotor(!1)}get power(){return this._j.getMotorTorque()}get collideConnected(){return this._j.getCollideConnected()}set collideConnected(t){this._j.m_collideConnected=t}remove(){this._removed||(this.spriteA.joints.splice(this.spriteA.joints.indexOf(this),1),this.spriteB.joints.splice(this.spriteB.joints.indexOf(this),1),this.p.world.destroyJoint(this._j),this._removed=!0)}},this.GlueJoint=class extends this.Joint{constructor(t,e){super(...arguments,"glue")}},this.DistanceJoint=class extends this.Joint{constructor(t,e){super(...arguments,"distance");let s=i.DistanceJoint({},t.body,e.body,t.body.getWorldCenter(),e.body.getWorldCenter());this._createJoint(s)}_display(){this._draw(this.spriteA.x+this.offsetA.x,this.spriteA.y+this.offsetA.y,this.spriteB.x+this.offsetB.x,this.spriteB.y+this.offsetB.y),this.visible=null}},this.WheelJoint=class extends this.Joint{constructor(t,e){super(...arguments,"wheel");let s=i.WheelJoint({maxMotorTorque:1e3,frequencyHz:4,dampingRatio:.7},t.body,e.body,e.body.getWorldCenter(),new i.Vec2(0,1));this._createJoint(s),this._angle="degrees"==this.p._angleMode?90:1.5707963267948966}_display(){let t=this.spriteA.x,e=this.spriteA.y,i=this.spriteB.x+this.offsetB.x,s=this.spriteB.y+this.offsetB.y,r=this.p.tan(this.spriteA.rotation),o=this.p.tan(this._angle+this.spriteA.rotation),h=(s-e+r*t-o*i)/(r-o),n=r*(h-t)+e;this._draw(h,n,i,s),this.visible=null}get angle(){return this._angle}set angle(t){t!=this._angle&&(this._angle=t,this._j.m_localXAxisA=new i.Vec2(this.p.cos(t),this.p.sin(t)),this._j.m_localXAxisA.normalize(),this._j.m_localYAxisA=i.Vec2.crossNumVec2(1,this._j.m_localXAxisA))}},this.HingeJoint=class extends this.Joint{constructor(t,e){super(...arguments,"hinge");let s=i.RevoluteJoint({},t.body,e.body,t.body.getWorldCenter());this._createJoint(s)}_display(){this._draw(this.spriteA.x+this.offsetA.x,this.spriteA.y+this.offsetA.y),this.visible=null}get range(){return this.upperLimit-this.lowerLimit}set range(t){t/=2,this.upperLimit=t,this.lowerLimit=-t}get lowerLimit(){let t=this._j.getLowerLimit();return"radians"==this.p._angleMode?t:this.p.degrees(t)}set lowerLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),this.spriteA.body.setAwake(!0),this.spriteB.body.setAwake(!0),"degrees"==this.p._angleMode&&(t=this.p.radians(t)),this._j.m_lowerAngle=t}get upperLimit(){let t=this._j.getUpperLimit();return"radians"==this.p._angleMode?t:this.p.degrees(t)}set upperLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),this.spriteA.body.setAwake(!0),this.spriteB.body.setAwake(!0),"degrees"==this.p._angleMode&&(t=this.p.radians(t)),this._j.m_upperAngle=t}get angle(){let e=this._j.getJointAngle();return"radians"==this.p._angleMode?e:t.radians(e)}},this.RevoluteJoint=this.HingeJoint,this.SliderJoint=class extends this.Joint{constructor(t,e){super(...arguments,"slider");let s=i.PrismaticJoint({lowerTranslation:-1,upperTranslation:1,enableLimit:!0,maxMotorForce:50,motorSpeed:0,enableMotor:!0},t.body,e.body,t.body.getWorldCenter(),new i.Vec2(1,0));this._createJoint(s),this._angle=0}get angle(){return this._angle}set angle(t){t!=this._angle&&(this._angle=t,this._j.m_localXAxisA=new i.Vec2(this.p.cos(t),this.p.sin(t)),this._j.m_localXAxisA.normalize(),this._j.m_localYAxisA=i.Vec2.crossNumVec2(1,this._j.m_localXAxisA))}get range(){return this.upperLimit-this.lowerLimit}set range(t){t/=2,this.upperLimit=t,this.lowerLimit=-t}get lowerLimit(){return this._j.getLowerLimit()/this.spriteA.tileSize*s}set lowerLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),t=t*this.spriteA.tileSize/s,this._j.setLimits(t,this._j.getUpperLimit())}get upperLimit(){return this._j.getUpperLimit()/this.spriteA.tileSize*s}set upperLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),t=t*this.spriteA.tileSize/s,this._j.setLimits(this._j.getLowerLimit(),t)}},this.PrismaticJoint=this.SliderJoint,this.RopeJoint=class extends this.Joint{constructor(t,e){super(...arguments,"rope");let s=i.RopeJoint({maxLength:1},t.body,e.body,t.body.getWorldCenter());this._createJoint(s),this._j.m_localAnchorB.x=0,this._j.m_localAnchorB.y=0}get maxLength(){return t=this._j.getMaxLength(),e=this.spriteA.tileSize,t/e*s;var t,e}set maxLength(t){var e,i;this._j.setMaxLength((e=t,i=this.spriteA.tileSize,e*i/s))}};class l{constructor(){let t=this;Object.defineProperties(this,{x:{get:()=>t._x,set(e){e!=t._x&&(t._x=e,t._avg=.5*(t._x+t._y))},configurable:!0,enumerable:!0},y:{get:()=>t._y,set(e){e!=t._y&&(t._y=e,t._avg=.5*(t._x+t._y))},configurable:!0,enumerable:!0},_x:{value:1,enumerable:!1,writable:!0},_y:{value:1,enumerable:!1,writable:!0},_avg:{value:1,enumerable:!1,writable:!0}})}valueOf(){return this._avg}}!function(){let t=new Float32Array(1),e=new Int32Array(t.buffer)}();function p(t){return!/^(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*(?:(?:(?:async\s(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*)?function|class)(?:\s|(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*)|(?:[_$\w][\w0-9_$]*\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\()|(?:\[\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*(?:(?:['][^']+['])|(?:["][^"]+["]))\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\]\())/.test(t.toString())}function d(t,e){return"triangle"==e?t=[t,-120,3]:"square"==e?t=[t,-90,4]:"pentagon"==e?t=[t,-72,5]:"hexagon"==e?t=[t,-60,6]:"septagon"==e?t=[t,-51.4285714286,7]:"octagon"==e?t=[t,-45,8]:"enneagon"==e?t=[t,-40,9]:"decagon"==e?t=[t,-36,10]:"hendecagon"==e?t=[t,-32.7272727273,11]:"dodecagon"==e&&(t=[t,-30,12]),t}this.p5play.palettes??=[{a:"aqua",b:"black",c:"crimson",d:"darkviolet",e:"peachpuff",f:"olive",g:"green",h:"hotpink",i:"indigo",j:"navy",k:"khaki",l:"lime",m:"magenta",n:"brown",o:"orange",p:"pink",q:"turquoise",r:"red",s:"skyblue",t:"tan",u:"blue",v:"violet",w:"white",x:"gold",y:"yellow",z:"gray"}],this.colorPal=(e,i)=>{if(e instanceof p5.Color)return e;let s;return"number"==typeof i&&(i=t.p5play.palettes[i]),i??=t.p5play.palettes[0],i&&(s=i[e]),""===s||"."===e||" "===e?t.color(0,0,0,0):t.color(s||e)},this.spriteArt=(e,i,s)=>{i??=1,"number"==typeof s&&(s=t.p5play.palettes[s]),s??=t.p5play.palettes[0];let r=e;"string"==typeof e&&(r=(e=(e=(e=e.trim()).replace(/\r*\n\t+/g,"\n")).replace(/\s+$/g,"")).split("\n"));let o=0;for(let t of r)t.length>o&&(o=t.length);let h=r.length,n=t.createImage(o*i,h*i);n.loadPixels();for(let t=0;t<r.length;t++)for(let e=0;e<r[t].length;e++)for(let o=0;o<i;o++)for(let h=0;h<i;h++){let a=this.colorPal(r[t][e],s);n.set(e*i+o,t*i+h,a)}return n.updatePixels(),n.w=n.width,n.h=n.height,t.p5play.images.onLoad(n),n},this.createSprite=function(){return new this.Sprite(...arguments)},this.createGroup=function(){return new this.Group(...arguments)},this.loadAnimation=this.loadAni=function(){return new this.SpriteAnimation(...arguments)},this.animation=function(t,e,i,s,r,o){t.visible&&t.update(),t.draw(e,i,s,r,o)},this.delay=t=>new Promise(t?e=>{setTimeout(e,t)}:requestAnimationFrame),this.sleep=t=>this.delay(t),this.play=t=>{if(!t.play)throw new Error("Tried to play your input but it wasn't a sound object: "+t);return new Promise(((e,i)=>{t.play(),t.onended((()=>e()))}))},this.p5play.playIntro=async function(){if(document.getElementById("p5play-intro"))return;t._incrementPreload();let e=document.createElement("div");e.id="p5play-intro",e.style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 1000; background-color: black;";let i=document.createElement("img");i.src="https://p5play.org/v3/made_with_p5play.png",i.style="position: absolute; top: 50%; left: 50%; width: 40vh; height: 20vh; margin-left: -20vh; margin-top: -10vh; z-index: 1000; opacity: 0; transition: opacity 0.1s ease-in-out;",document.body.append(e),e.append(i),await t.delay(100),i.style.opacity="1",i.style.transition="scale 1.4s, opacity 0.4s ease-in-out",i.style.scale="1.1",await t.delay(1100),i.style.opacity="0",await t.delay(300),e.style.display="none",e.remove(),document.getElementById("p5play-intro")?.remove(),t._decrementPreload()};{let t=location.hostname;switch(t){case"":case"127.0.0.1":case"localhost":case"p5play.org":case"editor.p5js.org":case"codepen.io":case"codera.app":case"cdpn.io":case"glitch.com":case"replit.com":case"stackblitz.com":case"jsfiddle.net":case"aijs-912fe.web.app":break;default:if(/^[\d\.]+$/.test(t)||t.endsWith("stackblitz.io")||t.endsWith("glitch.me")||t.endsWith("repl.co")||t.endsWith("codehs.com")||t.endsWith("openprocessing.org")||location.origin.endsWith("preview.p5js.org"))break;this.p5play.playIntro()}}let u=p5.disableFriendlyErrors;p5.disableFriendlyErrors=!0,this.canvas=this.canvas;const c=this.createCanvas;this.createCanvas=function(){let e,i,s,r,o=[...arguments],h=!1,n=!1;if("string"==typeof o[0]&&(o[0].includes(":")?s=o[0].split(":"):(o[2]=o[0],o[0]=void 0),"fullscreen"==o[1]&&(h=!0)),o[0]?"number"==typeof o[0]&&"number"!=typeof o[1]&&(o[2]=o[1],o[1]=o[0]):(o[0]=window.innerWidth,o[1]=window.innerHeight,h=!0),"string"==typeof o[2]){let t=o[2].toLowerCase();"p2d"!=t&&"webgl"!=t&&(t=t.split(" "),o.pop()),"pixelated"==t[0]&&(n=!0,t[1]?r=Number(t[1].slice(1)):h=!0,s=[o[0],o[1]]),"fullscreen"==t[0]&&(h=!0)}if(s){let t=Number(s[0]),h=Number(s[1]);r?(e=t*r,i=h*r):(e=window.innerWidth,i=window.innerWidth*(h/t),i>window.innerHeight&&(e=window.innerHeight*(t/h),i=window.innerHeight)),e=Math.round(e),i=Math.round(i),n||(o[0]=e,o[1]=i)}let a=c.call(t,...o);this.canvas.tabIndex=0,this.canvas.w=o[0],this.canvas.h=o[1],this.canvas.addEventListener("keydown",(function(t){" "!=t.key&&"/"!=t.key&&"ArrowUp"!=t.key&&"ArrowDown"!=t.key&&"ArrowLeft"!=t.key&&"ArrowRight"!=t.key||t.preventDefault()})),this.canvas.addEventListener("mouseover",(()=>{this.mouse.isOnCanvas=!0,this.mouse.active=!0})),this.canvas.addEventListener("mouseleave",(()=>{this.mouse.isOnCanvas=!1})),this.canvas.addEventListener("touchstart",(t=>t.preventDefault())),this.canvas.addEventListener("contextmenu",(t=>t.preventDefault())),this.canvas.resize=this.resizeCanvas,this.world.resize(),this.camera.x=this.world.hw,this.camera.y=this.world.hh,u||(p5.disableFriendlyErrors=!1);let l="\n.p5Canvas, .q5Canvas {\n\toutline: none;\n\t-webkit-touch-callout: none;\n\t-webkit-text-size-adjust: none;\n\t-webkit-user-select: none;\n\toverscroll-behavior: none;\n}\nmain {\n\toverscroll-behavior: none;\n}";h&&(l="html,\nbody,\n"+l,l+="\nhtml, body {\n\tmargin: 0;\n\tpadding: 0;\n\toverflow: hidden;\n\theight: 100%;\n}\nmain {\n\tmargin: auto;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\talign-content: center;\n\tjustify-content: center;\n\theight: 100%;\n}"),n&&(l+=`\n#${this.canvas.id} {\n\timage-rendering: pixelated;\n\twidth: ${e}px!important;\n\theight: ${i}px!important;\n}`);let p=document.createElement("style");p.innerHTML=l,document.head.appendChild(p),n&&(t.pixelDensity(1),t.noSmooth());let d=navigator.userAgent.indexOf("iPhone OS");if(d>-1){let e=navigator.userAgent.substring(d+10,d+12);this.p5play.version=e,e<16&&t.pixelDensity(1),this.p5play.os.platform="iOS",this.p5play.os.version=e}else void 0!==navigator.userAgentData&&(this.p5play.os.platform=navigator.userAgentData.platform);return a},this.Canvas=class{constructor(t,e,i){}get w(){}get width(){}get h(){}get height(){}resize(){}},this.Canvas=function(){return t.createCanvas(...arguments)};const _=this.resizeCanvas;this.resizeCanvas=(t,e)=>{_.call(this,t,e),this.world.resize(),this.camera._pos.x=this.world.hw,this.camera._pos.y=this.world.hh};const f=this.background;this.background=function(){let t,e=arguments;1==e.length&&("string"==typeof e[0]||e[0]instanceof p5.Color)&&(t=this.colorPal(e[0])),void 0!==t?f.call(this,t):f.call(this,...e)};const g=this.fill;this.fill=function(){let t,e=arguments;1==e.length&&(t=this.colorPal(e[0])),void 0!==t?g.call(this,t):g.call(this,...e)};const y=this.stroke;this.stroke=function(){let t,e=arguments;1==e.length&&(t=this.colorPal(e[0])),void 0!==t?y.call(this,t):y.call(this,...e)},this.p5play.images={onLoad:t=>{}},this.p5play.disableImages=!1;const m=this.loadImage;this.loadImage=this.loadImg=function(){if(this.p5play.disableImages)return t._decrementPreload(),{w:16,width:16,h:16,height:16,pixels:[]};let e,i=arguments,s=i[0],r=t.p5play.images[s];if("function"==typeof i[i.length-1]&&(e=i[i.length-1]),r)return 1==r.width&&1==r.height||!r.pixels.length?e?(r.cbs.push(e),r.calls++):t._decrementPreload():(e&&e(),t._decrementPreload()),r;return r=m.call(t,s,(e=>{e.w=e.width,e.h=e.height;for(let t of e.cbs)t(e);for(let i=1;i<e.calls;i++)t._decrementPreload();e.cbs=[],t.p5play.images.onLoad(r)})),r.cbs=[],r.calls=1,e&&r.cbs.push(e),r.url=s,t.p5play.images[s]=r,r};const w=this.image;this.image=function(){t.p5play.disableImages||w.call(t,...arguments)};let x={generic:["Ah! I found an error","Oh no! Something went wrong","Oof! Something went wrong","Houston, we have a problem","Whoops, having trouble here"],Sprite:{constructor:{base:"Sorry I'm unable to make a new Sprite",0:"What is $0 for? If you're trying to specify the x position of the sprite, please specify the y position as well.",1:"If you're trying to specify points for a chain Sprite, please use an array of position arrays.\n$0"},hw:{0:"I can't change the halfWidth of a Sprite directly, change the sprite's width instead."},hh:{1:"I can't change the halfHeight of a Sprite directly, change the sprite's height instead."},rotate:{0:"Can't use this function on a sprite with a static collider, try changing the sprite's collider type to kinematic.",1:'Can\'t use "$0" for the angle of rotation, it must be a number.'},rotateTo:{},rotateTowards:{},changeAnimation:'I can\'t find any animation named "$0".',collide:{0:"I can't make that sprite collide with $0. Sprites can only collide with another sprite or a group.",1:"The collision callback has to be a function.",2:"You're trying to check for an collision with a sprite or group that doesn't exist!"},overlap:{0:"I can't make that sprite overlap with $0. Sprites can only overlap with another sprite or a group.",1:"The overlap callback has to be a function.",2:"You're trying to check for an overlap with a sprite or group that doesn't exist!"}},SpriteAnimation:{constructor:{base:"Hey so, I tried to make a new SpriteAnimation but couldn't",0:'I don\'t know how to display this type of image: "$0". I can only use ".png" image files.',1:"The name of the animation must be the first input parameter."}},Group:{constructor:{base:"Hmm awkward! Well it seems I can't make that new Group you wanted"}}};x.Group.collide=x.Sprite.collide,x.Group.overlap=x.Sprite.overlap,x.Sprite.rotateTo[0]=x.Sprite.rotateTowards[0]=x.Sprite.rotate[0];class v extends Error{constructor(t,e,i){super(),"string"!=typeof t&&(i=e,e=t,t=(t=this.stack.match(/\n\s*at ([^\(]*)/)[1]).slice(0,-1)),"number"!=typeof e&&(i=e,e=void 0),"new"==t.slice(0,3)&&(t=t.slice(4));let s=(t=t.split("."))[0];t=t[1]||"constructor";let r=this.stack.match(/\/([^p\/][^5][^\/:]*:[^\/:]+):/);r&&(r=r[1].split(":"),r=" in "+r[0]+" at line "+r[1]),r=" using "+s+"."+t+". ",i=i||[];let o,h=x[s][t];o=h.base?h.base+r:x.generic[Math.floor(Math.random()*x.generic.length)]+r,void 0!==e&&(h=h[e]),h=h.replace(/\$([0-9]+)/g,((t,e)=>i[e])),o+=h,p5._friendlyError(o,t)}}this.allSprites=new this.Group,this.world=new this.World,this.camera=new this.Camera,this.InputDevice=class{constructor(){this.holdThreshold=12}init(t){for(let e of t)this[e]=0}ac(t){return t}presses(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),1==this[t]||-2==this[t]}pressing(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),-2==this[t]?1:this[t]>0?this[t]:0}pressed(t){return this.released(t)}holds(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),this[t]==this.holdThreshold}holding(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),this[t]>=this.holdThreshold?this[t]:0}held(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),-3==this[t]}released(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),this[t]<=-1}releases(t){return this.released(t)}},this._Mouse=class extends this.InputDevice{constructor(){super();let t=this;this._position={get x(){return t.x},set x(e){t.x=e},get y(){return t.y},set y(e){t.y=e}};this.init(["x","y","left","center","right"]),this.default="left",this.drag={left:0,center:0,right:0},this.isOnCanvas=!1,this.active=!1,this.x,this.y}get pos(){return this._position}get position(){return this._position}ac(t){return t=t.slice(0,4)?"left":"right"==t.slice(0,5)?"right":"middle"==t.slice(0,6)?"center":t.toLowerCase()}drags(t){return t??=this.default,1==this.drag[t]}dragging(t){return t??=this.default,this.drag[t]>0?this.drag[t]:0}dragged(t){return t??=this.default,-1==this.drag[t]}},this.mouse=new this._Mouse,this._SpriteMouse=class extends this._Mouse{constructor(){super(),this.hover=0}hovers(){return 1==this.hover}hovering(){return this.hover>0?this.hover:0}hovered(){return-1==this.hover}};const b=function(t){if(this.mouse[t]++,this.mouse.active=!0,this.world.mouseSprites.length){let e=this.world.mouseSprite;e&&(e.mouse[t]=0,e.mouse.drag[t]=0),e=this.world.mouseSprites[0],e.mouse[t]=1,this.world.mouseSprite=e}},S=this._onmousedown;this._onmousedown=function(t){let e="left";1===t.button?e="center":2===t.button&&(e="right"),b.call(this,e),S.call(this,t)};const A=this._ontouchstart;this._ontouchstart=function(t){b.call(this,"left"),A.call(this,t)};const C=function(t){let e=this.mouse;if(e[t]>0&&e.drag[t]<=0){e.drag[t]=1,e._isDragging=!0;let i=this.world.mouseSprite?.mouse;i&&(i.drag[t]=1,i._isDragging=!0)}},k=this._onmousemove;this._onmousemove=function(t){let e="left";1===t.button?e="center":2===t.button&&(e="right"),C.call(this,e),k.call(this,t)};const z=function(t){let e=this.mouse;e[t]>=e.holdThreshold?e[t]=-3:e[t]>1?e[t]=-1:e[t]=-2;let i=this.world.mouseSprite?.mouse;i&&(i.hover>1?(i[t]>=this.mouse.holdThreshold?i[t]=-3:i[t]>1?i[t]=-1:i[t]=-2,i.drag[t]>0&&(i.drag[t]=i[t])):(i[t]=0,i.drag[t]=0))},M=this._onmouseup;this._onmouseup=function(t){let e="left";1===t.button?e="center":2===t.button&&(e="right"),z.call(this,e),M.call(this,t)};const j=this._ontouchend;if(this._ontouchend=function(t){z.call(this,"left"),j.call(this,t)},delete this._Mouse,this._KeyBoard=class extends this.InputDevice{constructor(){super(),this.default=" "}ac(t){if(1==t.length)return t.toLowerCase();if(!isNaN(t)){if(38==t)return"ArrowUp";if(40==t)return"ArrowDown";if(37==t)return"ArrowLeft";if(39==t)return"ArrowRight";if(t<10)return t+"";throw new Error('Use key names with the keyboard input functions, not key codes! If you are trying to detect if the user pressed a number key make it a string. For example: "5"')}return"space"==t||"spacebar"==t?" ":t[0].toUpperCase()+t.slice(1).toLowerCase()}get space(){return this[" "]}get spacebar(){return this[" "]}},this.kb=new this._KeyBoard,delete this._KeyBoard,this.keyboard=this.kb,navigator.keyboard){const t=navigator.keyboard;window==window.top?t.getLayoutMap().then((t=>{"w"!=t.get("KeyW")&&(this.p5play.standardizeKeyboard=!0)})):this.p5play.standardizeKeyboard=!0}else this.p5play.standardizeKeyboard=!0;function T(t){let e=t.code;return 4==e.length&&"Key"==e.slice(0,3)?e[3].toLowerCase():t.key}let L={w:"up",s:"down",a:"left",d:"right",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",i:"up2",k:"down2",j:"left2",l:"right2"};const D=this._onkeydown;this._onkeydown=function(t){let e=t.key;this.p5play.standardizeKeyboard&&(e=T(t));let i=[e],s=L[e];s&&i.push(s);for(let t of i)(!this.kb[t]||this.kb[t]<0)&&(this.kb[t]=1);D.call(this,t)};const F=this._onkeyup;this._onkeyup=function(t){let e=t.key;this.p5play.standardizeKeyboard&&(e=T(t));let i=[e],s=L[e];s&&i.push(s);for(let t of i)this.kb[t]>=this.kb.holdThreshold?this.kb[t]=-3:this.kb[t]>1?this.kb[t]=-1:this.kb[t]=-2;F.call(this,t)},this._Contro=class extends this.InputDevice{constructor(t){super();this.init(["a","b","x","y","l","r","lt","rt","select","start","up","down","left","right","leftTrigger","rightTrigger"]),this.leftStick={x:0,y:0,btn:0},this.rightStick={x:0,y:0,btn:0},this._btns={a:0,b:1,x:2,y:3,l:4,r:5,lt:6,rt:7,select:8,start:9,leftStickButton:10,rightStickButton:11,up:12,down:13,left:14,right:15},this._axes={leftStick:{x:0,y:1},rightStick:{x:2,y:3},leftTrigger:4,rightTrigger:5},t.id.includes("GuliKit")&&(this._btns.a=1,this._btns.b=0,this._btns.x=3,this._btns.y=2),e(t),this.gamepad=t,this.id=t.id}ac(t){return t.toLowerCase()}_update(){if(this.gamepad=navigator.getGamepads()[this.gamepad.index],!this.gamepad)return;let t=this.gamepad;for(let e in this._btns){let i=this._btns[e];t.buttons[i].pressed?this[e]++:this[e]=this[e]>0?-1:0}return this.leftStick.x=t.axes[this._axes.leftStick.x],this.leftStick.y=t.axes[this._axes.leftStick.y],this.rightStick.x=t.axes[this._axes.rightStick.x],this.rightStick.y=t.axes[this._axes.rightStick.y],void 0!==t.axes[this._axes.leftTrigger]?(this.leftTrigger=t.axes[this._axes.leftTrigger],this.rightTrigger=t.axes[this._axes.rightTrigger]):(this.leftTrigger=t.buttons[this._btns.lt].value,this.rightTrigger=t.buttons[this._btns.rt].value),!0}},this._Contros=class extends Array{constructor(){super();let t=this;window.addEventListener("gamepadconnected",(e=>{t._addContro(e.gamepad)})),window.addEventListener("gamepaddisconnected",(e=>{t._removeContro(e.gamepad)})),this.default="a";let e=["presses","pressing","pressed","holds","holding","held","released"];for(let t of e)this[t]=e=>{if(this[0])return this[0][t](e)};let i=["a","b","x","y","l","r","lt","rt","select","start","leftStickButton","rightStickButton","up","down","left","right"];for(let e of i)Object.defineProperty(this,e,{get:()=>t[0]?t[0][e]:0});let s=["leftStick","rightStick"];for(let e of s){this[e]={};for(let i of["x","y"])Object.defineProperty(this[e],i,{get:()=>t[0]?t[0][e][i]:0})}if(!navigator?.getGamepads)return;let r=navigator.getGamepads();for(let t of r)t&&this._addContro(t)}_addContro(i){i&&(e("controller "+this.length+" connected: "+i.id),this.push(new t._Contro(i)))}_removeContro(t){if(t){e("controller "+this.length+" disconnected: "+t.id);for(let e=0;e<this.length;e++)if(this[e].gamepad.index===t.index){this.splice(e,1);break}}}_update(){for(let t of this)t._update()}},this.contro=new this._Contros,delete this._Contros,this.controllers=this.contro,this.getFPS||(this.p5play._fps=60),this.getFPS??=()=>this.p5play._fps,this.p5play._fpsArr=[60],this.renderStats=(t,e)=>{let i=this.p5play._renderStats;void 0===i.show&&(1==this.allSprites.tileSize||this.allSprites.tileSize>16?i.fontSize=16:i.fontSize=10,i.gap=1.25*i.fontSize,console.warn("renderStats() uses inaccurate FPS approximations. Even if your game runs at a solid 60hz display rate, the fps calculations shown may be lower. The only way to get accurate results, is to use your web browser's performance testing tools.")),i.x=t||10,i.y=e||20,i.show=!0}})),p5.prototype.registerMethod("pre",(function(){this.p5play._fps&&(this.p5play._preDrawFrameTime=performance.now()),this.p5play.spritesDrawn=0,this.mouse.x=(this.mouseX-this.world.hw)/this.camera.zoom+this.camera.x,this.mouse.y=(this.mouseY-this.world.hh)/this.camera.zoom+this.camera.y,this.camera.mouse.x=this.mouseX,this.camera.mouse.y=this.mouseY,this.contro._update()})),p5.prototype.registerMethod("post",(function(){this.p5play._inPostDraw=!0,this.allSprites.autoCull&&this.allSprites.cull(1e4),this.allSprites._autoDraw&&(this.camera.on(),this.allSprites.draw(),this.camera.off()),this.allSprites._autoDraw??=!0;let t=this.p5play._renderStats;if(t.show){if(1==this.frameCount||this.frameCount%60==0){let t,e=this.p5play._fpsArr.reduce(((t,e)=>t+e));e=Math.round(e/this.p5play._fpsArr.length),this.p5play._fpsAvg=e,this.p5play._fpsMin=Math.min(...this.p5play._fpsArr),this.p5play._fpsMax=Math.max(...this.p5play._fpsArr),this.p5play._fpsArr=[],t=e>55?this.color(30,255,30):e>25?this.color(255,100,30):this.color(255,30,30),this.p5play._statsColor=t}this.p5play._fpsArr.push(this.getFPS()),this.push(),this.fill(0,0,0,128),this.rect(t.x-5,t.y-t.fontSize,8.5*t.fontSize,4*t.gap+5),this.fill(this.p5play._statsColor),this.textSize(t.fontSize),this.textFont("monospace");let e=t.x,i=t.y;this.text("sprites: "+this.p5play.spritesDrawn,e,i),this.text("fps avg: "+this.p5play._fpsAvg,e,i+t.gap),this.text("fps min: "+this.p5play._fpsMin,e,i+2*t.gap),this.text("fps max: "+this.p5play._fpsMax,e,i+3*t.gap),this.pop(),t.show=!1}this.world.autoStep&&this.world.step(),this.world.autoStep??=!0,this.allSprites._autoUpdate&&this.allSprites.update(),this.allSprites._autoUpdate??=!0;for(let t of this.allSprites)t.autoDraw??=!0,t.autoUpdate??=!0;for(let t in this.kb)"holdThreshold"!=t&&(this.kb[t]<0?this.kb[t]=0:this.kb[t]>0&&this.kb[t]++);let e=this.mouse,i=this.world.mouseSprite?.mouse;for(let t of["left","center","right"])e[t]<0?e[t]=0:e[t]>0&&e[t]++,i&&(i[t]=e[t]);if(this.world.mouseTracking){let t=this.world.getSpritesAt(e.x,e.y);t.sort(((t,e)=>-1*(t._layer-e._layer)));let s=this.world.getSpritesAt(this.camera.mouse.x,this.camera.mouse.y,this.allSprites,!1);s.sort(((t,e)=>-1*(t._layer-e._layer))),t=t.concat(s);for(let e=0;e<t.length;e++){let i=t[e];0!=e?i.mouse.hover>0?i.mouse.hover=-1:i.mouse.hover<0&&(i.mouse.hover=0):i.mouse.hover++}let r=this.world.mouseSprite;if(e.left<=0&&e.center<=0&&e.right<=0)r=null,this.world.mouseSprite=null;else for(let t of["left","center","right"])e.drag[t]<0?e.drag[t]=0:e.drag[t]>0&&e.drag[t]++,i&&(i.drag[t]=e.drag[t],i.x=r.x-e.x,i.y=r.y-e.y);for(let e of this.world.mouseSprites)if(!(i?._isDragging&&e==r||t.includes(e))){let t=e.mouse;t.hover=-1,t.left=t.center=t.right=0}this.world.mouseSprites=t}this.camera.off(),this.p5play._fps&&(this.p5play._postDrawFrameTime=performance.now(),this.p5play._fps=Math.round(1e3/(this.p5play._postDrawFrameTime-this.p5play._preDrawFrameTime))||1),this.p5play._inPostDraw=!1}));
