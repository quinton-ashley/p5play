if("undefined"==typeof p5)throw"You need to load q5.js or p5.js before p5play";if("object"!=typeof planck){if("object"!=typeof process)throw"You need to load planck.js before p5play!";global.planck=require("./planck.min.js")}let p5playInit=function(){const t="3.33",e=this,i=planck;let s=p5.disableFriendlyErrors;if(p5.disableFriendlyErrors=!0,"object"!=typeof process&&0!=window._p5play_gtagged){let e=document.createElement("script");e.src="https://www.googletagmanager.com/gtag/js?id=G-EHXNCTSYLK",e.async=!0,document.head.append(e),window._p5play_gtagged=!0,e.onload=()=>{window.dataLayer??=[],window.gtag=function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-EHXNCTSYLK"),gtag("event","p5play_v"+t.replace(".","_"))}}let r=!e._q5&&1==p5.VERSION[0],o=!e._q5&&2==p5.VERSION[0];const a=e.DEGREES;e.angleMode(a);const h=(t,s,r)=>new i.Vec2(t*r/e.world.meterSize,s*r/e.world.meterSize),n=(t,s,r)=>new i.Vec2(t/r*e.world.meterSize,s/r*e.world.meterSize),l=i.Settings.linearSlop,d=i.Settings.angularSlop/60,p=t=>Math.abs(t)<=l,u=(t,e)=>Math.abs(t-Math.round(t))<=(e||l)?Math.round(t):t,c=(t,i)=>{let s=e._angleMode==a?360:e.TWO_PI,r=(t-i)%s,o=(s-Math.abs(r))*-Math.sign(r);return(Math.abs(r)<Math.abs(o)?r:o)||0},_={_collisions:["_collides","_colliding","_collided"],_overlappers:["_overlaps","_overlapping","_overlapped"]};this.P5Play=class{constructor(){if(this.version=t,this.sprites={},this.groups={},this.groupsCreated=0,this.spritesCreated=0,this.spritesDrawn=0,this.images={},this.disableImages=!1,this.palettes=[],this.emojiScale=1,this.friendlyRounding=!0,this.storeDeletedGroupRefs=!0,this.snapToGrid=!1,this.gridSize=.5,this.os={},this.context="web",window.matchMedia?this.hasMouse=!window.matchMedia("(any-hover: none)").matches:this.hasMouse=!0,this.standardizeKeyboard=!1,"object"==typeof navigator){let t=navigator.userAgent.indexOf("iPhone OS");if(t>-1){let e=navigator.userAgent.substring(t+10,t+12);this.os.platform="iOS",this.os.version=e}else{let t=navigator.userAgentData?.platform;!t&&navigator.platform&&(t=navigator.platform.slice(3),"Mac"==t?t="macOS":"Win"==t?t="Windows":"Lin"==t&&(t="Linux")),this.os.platform=t}}this.renderStats=!1,this._renderStats={x:10,y:20,font:"monospace"},this._fps=60,this._fpsArr=[60],this._collides={},this._colliding={},this._collided={},this._overlaps={},this._overlapping={},this._overlapped={}}onImageLoad(){}},this.p5play=new e.P5Play,delete e.P5Play;let g=!0,f=1,y=e.log=console.log;this.DYN="dynamic",this.DYNAMIC="dynamic",this.STA="static",this.STATIC="static",this.KIN="kinematic",this.KINEMATIC="kinematic",this.Sprite=class{constructor(t,s,r,o,a){this._isSprite=!0,this.idNum;let h,n,l=[...arguments];if(void 0!==l[0]&&l[0]._isGroup&&(h=l[0],l=l.slice(1)),void 0!==l[0]&&("string"==typeof l[0]||l[0]instanceof e.Ani||l[0]instanceof p5.Image)&&(n=l[0],l=l.slice(1)),1==l.length&&"number"==typeof l[0])throw new T("Sprite",0,[l[0]]);if(Array.isArray(l[0])){if(t=void 0,s=void 0,r=l[0],o=void 0,a=l[1],Array.isArray(a))throw new T("Sprite",1,[`[[${r}], [${o}]]`])}else t=l[0],s=l[1],r=l[2],o=l[3],a=l[4];"string"==typeof r&&(a=r,r=void 0),"string"==typeof o&&(!function(t){if("d"==t||"s"==t||"k"==t||"n"==t)return!0;let e=t.slice(0,2);return"dy"==e||"st"==e||"ki"==e||"no"==e}(o)?r=x(r,o):a=o,o=void 0),this.idNum=e.p5play.spritesCreated,this._uid=1e3+this.idNum,e.p5play.sprites[this._uid]=this,e.p5play.spritesCreated++,this.groups=[],this.animations=new e.Anis,this.joints=[],this.joints.deleteAll=()=>{for(;this.joints.length>0;)this.joints.at(-1).delete()},this.joints.removeAll=this.joints.deleteAll,this.watch,this.mod={},this._deleted=!1,this._life=2147483647,this._visible=!0,this._pixelPerfect=!1,this._aniChangeCount=0,this._draw=()=>this.__draw(),this._hasOverlap={},this._collisions={},this._overlappers={},h??=e.allSprites,this._tile="",this.tileSize=h.tileSize||1;let d=this;this._position={x:0,y:0},this._pos=e.createVector.call(e),Object.defineProperty(this._pos,"x",{get(){if(!d.body||!g)return d._position.x;let t=d.body.getPosition().x/d.tileSize*e.world.meterSize;return e.p5play.friendlyRounding?u(t):t},set(t){if(d._position.x=t,d.body){let s=new i.Vec2(t*d.tileSize/e.world.meterSize,d.body.getPosition().y);d.body.setPosition(s)}}}),Object.defineProperty(this._pos,"y",{get(){if(!d.body||!g)return d._position.y;let t=d.body.getPosition().y/d.tileSize*e.world.meterSize;return e.p5play.friendlyRounding?u(t):t},set(t){if(d._position.y=t,d.body){let s=new i.Vec2(d.body.getPosition().x,t*d.tileSize/e.world.meterSize);d.body.setPosition(s)}}}),this._canvasPos=e.createVector.call(e),Object.defineProperty(this._canvasPos,"x",{get(){let t=d._pos.x-e.camera.x;return e._c2d&&(t+=e.canvas.hw/e.camera._zoom),t}}),Object.defineProperty(this._canvasPos,"y",{get(){let t=d._pos.y-e.camera.y;return e._c2d&&(t+=e.canvas.hh/e.camera._zoom),t}}),this._velocity={x:0,y:0},this._direction=0,this._vel=e.createVector.call(e),Object.defineProperties(this._vel,{x:{get(){let t;return t=d.body?d.body.getLinearVelocity().x:d._velocity.x,t/=d.tileSize,e.p5play.friendlyRounding?u(t):t},set(t){t*=d.tileSize,d.body?d.body.setLinearVelocity(new i.Vec2(t,d.body.getLinearVelocity().y)):d._velocity.x=t,(t||this.y)&&(d._direction=this.heading())}},y:{get(){let t;return t=d.body?d.body.getLinearVelocity().y:d._velocity.y,t/=d.tileSize,e.p5play.friendlyRounding?u(t):t},set(t){t*=d.tileSize,d.body?d.body.setLinearVelocity(new i.Vec2(d.body.getLinearVelocity().x,t)):d._velocity.y=t,(t||this.x)&&(d._direction=this.heading())}}}),this._mirror={get x(){return this._scale.x<0},set x(t){d.watch&&(d.mod[26]=!0),this._scale.x=Math.abs(this._scale.x)*(t?-1:1)},get y(){return this._scale.y<0},set y(t){d.watch&&(d.mod[26]=!0),this._scale.y=Math.abs(this._scale.y)*(t?-1:1)}},this._heading="right",this._layer=h._layer,this._layer??=e.allSprites._getTopLayer()+1,h.dynamic&&(a??="dynamic"),h.kinematic&&(a??="kinematic"),h.static&&(a??="static"),a??=h.collider,a&&"string"==typeof a||(a="dynamic"),this.collider=a,t??=h.x,void 0===t&&(t=e._c2d?e.canvas.hw/this.tileSize:0,r&&(this._vertexMode=!0)),s??=h.y,void 0===s&&(s=e._c2d?e.canvas.hh/this.tileSize:0);let p=!1;if(void 0===r&&(r=h.w||h.width||h.d||h.diameter||h.v||h.vertices,o||h.d||h.diameter||(o=h.h||h.height,p=!0)),"function"==typeof t&&(t=t.call(this,h.length)),"function"==typeof s&&(s=s.call(this,h.length)),"function"==typeof r&&(r=r.call(this,h.length)),"function"==typeof o&&(o=o.call(this,h.length)),this.x=t,this.y=s,!h._isAllSpritesGroup&&!n){for(let t in h.animations){n=t;break}n||(n=h._img,"function"==typeof n&&(n=n.call(this,h.length)),n&&(this._img=!0))}for(let t=h;t;t=e.p5play.groups[t.parent])this.groups.push(t);if(this.groups.reverse(),n){let t=this.tileSize;this._img||n instanceof p5.Image?(this.image="string"!=typeof n?n:new e.EmojiImage(n,r),r||1==this._img.w&&1==this._img.h||(r=(this._img.defaultWidth||this._img.w)/t,o??=(this._img.defaultHeight||this._img.h)/t)):("string"==typeof n?this._changeAni(n):this._ani=n.clone(),r||1==this._ani.w&&1==this._ani.h||(r=(this._ani.defaultWidth||this._ani.w)/t,o??=(this._ani.defaultHeight||this._ani.h)/t))}if(this.groups=[],this.mouse=new e._SpriteMouse,this._rotation=0,this._rotationSpeed=0,this._bearing=0,this._scale=new m,Object.defineProperty(this._scale,"x",{get(){return this._x},set(t){if(t==this._x)return;d.watch&&(d.mod[26]=!0);let e=Math.abs(t/this._x);d._w*=e,d._hw*=e,d._resizeColliders({x:e,y:1}),this._x=t,this._avg=.5*(this._x+this._y)}}),Object.defineProperty(this._scale,"y",{get(){return this._y},set(t){if(t==this._y)return;d.watch&&(d.mod[26]=!0);let e=Math.abs(t/this._y);d._h&&(this._h*=e,this._hh*=e),d._resizeColliders({x:1,y:e}),this._y=t,this._avg=.5*(this._x+this._y)}}),this._offset={_x:0,_y:0,get x(){return this._x},set x(t){t!=this._x&&(d.watch&&(d.mod[21]=!0),d._offsetCenterBy(t-this._x,0))},get y(){return this._y},set y(t){t!=this._y&&(d.watch&&(d.mod[21]=!0),d._offsetCenterBy(0,t-this._y))}},this._massUndef=!0,void 0===r&&(this._dimensionsUndef=!0,this._widthUndef=!0,r=this.tileSize>1?1:50,void 0===o&&(this._heightUndef=!0)),p&&(o??=this.tileSize>1?1:50),this._shape=h.shape,3!=this.__collider)this._vertexMode?this.addCollider(r):this.addCollider(0,0,r,o),this.shape=this._shape;else{if(this.w=r,Array.isArray(r))throw new Error('Cannot set the collider type of a sprite with a polygon or chain shape to "none". To achieve the same effect, use .overlaps(allSprites) to have your sprite overlap with the allSprites group.');void 0!==r&&void 0===o?this.shape="circle":(this.shape="box",this.h=o)}this.prevPos={x:t,y:s},this.prevRotation=0,this._dest={x:t,y:s},this._destIdx=0,this._debug=!1,this.text,h._isAllSpritesGroup||e.allSprites.push(this),h.push(this);let c=h.vel.x||0,_=h.vel.y||0;"function"==typeof c&&(c=c.call(this,h.length-1)),"function"==typeof _&&(_=_.call(this,h.length-1)),this.vel.x=c,this.vel.y=_;let f=["ani","collider","x","y","w","h","d","diameter","dynamic","height","kinematic","static","vel","width"];for(let t of e.Sprite.propsAll){if(f.includes(t))continue;let i=h[t];void 0!==i&&("function"==typeof i&&w(i)&&(i=i.call(this,h.length-1)),"object"==typeof i?i instanceof p5.Color?this[t]=e.color(i):this[t]=Object.assign({},i):this[t]=i)}f=["add","animation","animations","autoCull","contains","GroupSprite","Group","idNum","length","mod","mouse","p","parent","Sprite","Subgroup","subgroups","velocity"];for(let t=0;t<this.groups.length;t++){let i=this.groups[t],s=Object.keys(i);for(let t of s){if(!isNaN(t)||"_"==t[0]||f.includes(t)||e.Sprite.propsAll.includes(t))continue;let s=i[t];void 0!==s&&("function"==typeof s&&w(s)&&(s=s.call(this,i.length-1)),this[t]="object"==typeof s?Object.assign({},s):s)}}{let t=e.random(.12,.96),i=e.random(.12,.96),s=e.random(.12,.96);1!=e._colorFormat&&(t*=255,i*=255,s*=255),this.color??=e.color(t,i,s)}this._textFill??=e.color(0),this._textSize??=1==this.tileSize?e.canvas?e.textSize():12:.8,this.remove=this.delete}addCollider(t,s,r,o){if(this._deleted)return void console.error("Can't add colliders to a sprite that was deleted.");3==this.__collider&&(this._collider="dynamic",this.__collider=0);let a={};a.shape=this._parseShape(...arguments),"chain"==a.shape.m_type&&(a.density=0,a.restitution=0),a.density??=this.density||5,a.friction??=this.friction||.5,a.restitution??=this.bounciness||.2,this.body?this.body.m_gravityScale||=1:(this.body=e.world.createBody({position:h(this.x,this.y,this.tileSize),type:this.collider}),this.body.sprite=this);let n=new i.Vec2(this.body.getLocalCenter());this.body.createFixture(a),this.watch&&(this.mod[19]=!0),this.body.setMassData({mass:this.body.getMass(),center:n,I:this.body.getInertia()})}addSensor(t,i,s,r){if(this._deleted)return void console.error("Can't add sensors to a sprite that was deleted.");let o=this._parseShape(...arguments);this.body||(this.body=e.world.createBody({position:h(this.x,this.y,this.tileSize),type:"dynamic",gravityScale:0}),this.body.sprite=this,this.mass=0,this._massUndef=!0,this.rotation=this._rotation,this.vel=this._velocity),this.body.createFixture({shape:o,isSensor:!0}),this._sortFixtures(),this._hasSensors=!0}_parseShape(t,s,r,o){let a,n,l,d,u=[...arguments];if(0==u.length?(t=0,s=0,r=this._w,o=this._h):u.length<=2&&(t=0,s=0,r=u[0],o=u[1],this._vertexMode=!0),Array.isArray(r)||"string"==typeof o?(isNaN(r)||(r=Number(r)),"number"!=typeof r&&Array.isArray(r[0])&&(this._originMode??="start"),"string"==typeof o?(a=x(r,o),o=void 0):a=r):(n=void 0!==r&&void 0===o?"circle":"box",r??=this.tileSize>1?1:50,o??=r,l=h(r-.08,o-.08,this.tileSize)),"box"==n)d=i.Box(l.x/2,l.y/2,h(t,s,this.tileSize),0);else if("circle"==n)d=i.Circle(h(t,s,this.tileSize),l.x/2);else if(a){let c,_,g=[{x:0,y:0}],f={x:0,y:0},y={x:0,y:0},m={x:0,y:0},w=Array.isArray(a[0]);function v(){f.x<y.x&&(y.x=f.x),f.y<y.y&&(y.y=f.y),f.x>m.x&&(m.x=f.x),f.y>m.y&&(m.y=f.y)}if(w){this._vertexMode&&(c=a[0][0],_=a[0][1],this.fixture&&this._relativeOrigin?(c=this.x-this._relativeOrigin.x,_=this.y-this._relativeOrigin.y,g.pop()):(this.x=c,this.y=_));for(let S=0;S<a.length;S++){if(this._vertexMode){if(0==S&&!this.fixture)continue;f.x=a[S][0]-c,f.y=a[S][1]-_}else f.x+=a[S][0],f.y+=a[S][1];g.push({x:f.x,y:f.y}),v()}}else{let A=1;a.length%2&&(A=a[a.length-1]);let C=A>0?1:-1;A=Math.abs(A);let M=0;for(let k=0;k<A;k++){for(let T=0;T<a.length-1;T+=2){let z=a[T];M+=a[T+1],f.x+=z*e.cos(M),f.y+=z*e.sin(M),g.push({x:f.x,y:f.y}),v()}M*=C}}let b=!1;if(p(Math.abs(g[0].x)-Math.abs(g[g.length-1].x))&&p(Math.abs(g[0].y)-Math.abs(g[g.length-1].y))?(n="chain"!=this._shape?"polygon":"chain",this._originMode="center",this._isConvexPoly(g.slice(0,-1))&&(b=!0)):n="chain",r=m.x-y.x,o=m.y-y.y,"start"==this._originMode)for(let j=0;j<g.length;j++)g[j]=h(g[j].x,g[j].y,this.tileSize);else{let P=0,O=0,D=0,F=0,I=g.length;("polygon"==n||b)&&I--;for(let L=0;L<I;L++)D+=g[L].x,F+=g[L].y;P=D/I,O=F/I,this.fixture||(this._relativeOrigin={x:P,y:O}),this._vertexMode&&w&&(this.fixture?(P=this._relativeOrigin.x,O=this._relativeOrigin.y):(this.x+=P,this.y+=O));for(let B=0;B<g.length;B++){let W=g[B];g[B]=h(W.x+t-P,W.y+s-O,this.tileSize)}}(!b||g.length-1>i.Settings.maxPolygonVertices||"chain"==this._shape)&&(n="chain"),"polygon"==n?d=i.Polygon(g):"chain"==n&&(d=i.Chain(g,!1))}if(this.shape??=n,this.fixtureList){this._extents??={t:this.hh,b:this.hh,l:this._hw,r:this._hw};let E=this._extents,N=t-.5*r,G=t+.5*r,R=s-.5*o,V=s+.5*o;N<E.l&&(E.l=N),G>E.r&&(E.r=G),R<E.t&&(E.t=R),V>E.b&&(E.b=V),this._totalWidth=E.r-E.l,this._totalHeight=E.b-E.t;let U=Math.abs;this._largestExtent=Math.max(U(E.l),U(E.r),U(E.t),U(E.b))}else this._w=r,this._hw=.5*r,1!=this.__shape&&(this._h=o,this._hh=.5*o);return d}removeColliders(){this.body&&(this._removeContacts(0),this._removeFixtures(0))}removeSensors(){this.body&&(this._removeContacts(1),this._removeFixtures(1),this._hasSensors=!1)}_removeFixtures(t){let i;for(let s=this.fixtureList;s;s=s.getNext())if(void 0===t||s.m_isSensor==t){let t=s.m_next;s.destroyProxies(e.world.m_broadPhase),i?i.m_next=t:this.body.m_fixtureList=t}else i=s}_removeContacts(t){if(!this.body)return;let i=this.body.m_contactList;for(;i;){let s=i.contact;i=i.next,void 0!==t&&s.m_fixtureA.m_isSensor!=t||e.world.destroyContact(s)}}_offsetCenterBy(t,e){if(!t&&!e)return;if(this._offset._x+=t,this._offset._y+=e,!this.body)return;let i=h(t,e,this.tileSize);this.__offsetCenterBy(i.x,i.y)}__offsetCenterBy(t,e){for(let i=this.body.m_fixtureList;i;i=i.m_next){let s=i.m_shape;if("circle"!=s.m_type){let i=s.m_vertices;for(let s of i)s.x+=t,s.y+=e}else s.m_p.x+=t,s.m_p.y+=e}}_cloneBodyProps(){let t={},e=["bounciness","density","drag","friction","heading","isSuperFast","rotation","rotationDrag","rotationLock","rotationSpeed","scale","vel","x","y"];this._massUndef&&this._dimensionsUndef||e.push("mass");for(let i of e)"object"==typeof this[i]?t[i]=Object.assign({},this[i]):t[i]=this[i];return t}get animation(){return this._ani}set animation(t){this.changeAni(t)}get ani(){return this._ani}set ani(t){this.changeAni(t)}get anis(){return this.animations}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate=t}get autoDraw(){return this._autoDraw}set autoDraw(t){this._autoDraw=t}get allowSleeping(){return this.body?.isSleepingAllowed()}set allowSleeping(t){this.watch&&(this.mod[5]=!0),this.body&&this.body.setSleepingAllowed(t)}get bounciness(){if(this.fixture)return this.fixture.getRestitution()}set bounciness(t){this.watch&&(this.mod[7]=!0);for(let e=this.fixtureList;e;e=e.getNext())e.setRestitution(t)}get collider(){return this._collider}set collider(t){if(t==this._collider)return;let i=(t=t.toLowerCase())[0];if("d"==i&&(t="dynamic"),"s"==i&&(t="static"),"k"==i&&(t="kinematic"),"n"==i&&(t="none"),t==this._collider)return;if("none"==t&&("chain"==this._shape||"polygon"==this._shape))return void console.error('Cannot set the collider type of a polygon or chain collider to "none". To achieve the same effect, use .overlaps(allSprites) to have your sprite overlap with the allSprites group.');if(this._deleted)throw new Error("Cannot change the collider type of a sprite that was deleted.");let s=this.__collider;this._collider=t,this.__collider=["d","s","k","n"].indexOf(i),this.watch&&(this.mod[8]=!0),void 0!==s&&(3!=this.__collider?(this.body&&this.body.setType(t),3==s&&(this.addCollider(),this.x=this._position.x,this.y=this._position.y,this.vel.x=this._velocity.x,this.vel.y=this._velocity.y,this.rotation=this._rotation,this.rotationSpeed=this._rotationSpeed)):(this.removeColliders(),this.fixture?.m_isSensor?this.body.m_gravityScale=0:(this._syncWithPhysicsBody(),e.world.destroyBody(this.body),this.body=null)))}get physicsType(){return this._collider}set physicsType(t){this.collider=t}get physics(){return this._collider}set physics(t){this.collider=t}_syncWithPhysicsBody(){this._position.x=this.x,this._position.y=this.y,this._velocity.x=this.vel.x,this._velocity.y=this.vel.y,this._rotation=this.rotation,this._rotationSpeed=this.rotationSpeed}_parseColor(t){return t instanceof p5.Color?t:"object"!=typeof t&&1==t.length?e.colorPal(t):e.color(t)}get color(){return this._color}set color(t){this.watch&&(this.mod[9]=!0),this._color=this._parseColor(t)}get colour(){return this._color}set colour(t){this.color=t}get fill(){return this._color}set fill(t){this.color=t}get stroke(){return this._stroke}set stroke(t){this.watch&&(this.mod[29]=!0),this._stroke=this._parseColor(t)}get strokeWeight(){return this._strokeWeight}set strokeWeight(t){this.watch&&(this.mod[30]=!0),this._strokeWeight=t}get textColor(){return this._textFill}set textColor(t){this.watch&&(this.mod[32]=!0),this._textFill=this._parseColor(t)}get textColour(){return this._textFill}set textColour(t){this.textColor=t}get textFill(){return this._textFill}set textFill(t){this.textColor=t}get textSize(){return this._textSize}set textSize(t){this.watch&&(this.mod[33]=!0),this._textSize=t}get textStroke(){return this._textStroke}set textStroke(t){this.watch&&(this.mod[34]=!0),this._textStroke=this._parseColor(t)}get textStrokeWeight(){return this._textStrokeWeight}set textStrokeWeight(t){this.watch&&(this.mod[35]=!0),this._textStrokeWeight=t}get tile(){return this._tile}set tile(t){this.watch&&(this.mod[36]=!0),this._tile=t}get tileSize(){return this._tileSize}set tileSize(t){this.watch&&(this.mod[37]=!0),this._tileSize=t}get bearing(){return this._bearing}set bearing(t){this.watch&&(this.mod[6]=!0),this._bearing=t}get debug(){return this._debug}set debug(t){this.watch&&(this.mod[10]=!0),this._debug=t}get density(){if(this.fixture)return this.fixture.getDensity()}set density(t){this.watch&&(this.mod[11]=!0);for(let e=this.fixtureList;e;e=e.getNext())e.setDensity(t)}_getDirectionAngle(t){t=t.toLowerCase().replaceAll(/[ _-]/g,"");let i={up:-90,down:90,left:180,right:0,upright:-45,rightup:-45,upleft:-135,leftup:-135,downright:45,rightdown:45,downleft:135,leftdown:135,forward:this.rotation,backward:this.rotation+180}[t];return"radians"==e._angleMode&&(i=e.radians(i)),i}get direction(){return 0!==this.vel.x||0!==this.vel.y?e.atan2(this.vel.y,this.vel.x):this._isTurtleSprite?this.rotation:this._direction}set direction(t){this.watch&&(this.mod[12]=!0),"string"==typeof t&&(this._heading=t,t=this._getDirectionAngle(t)),this._direction=t,this._isTurtleSprite&&(this.rotation=t);let i=this.speed;this.vel.x=e.cos(t)*i,this.vel.y=e.sin(t)*i}get drag(){return this.body?.getLinearDamping()}set drag(t){this.watch&&(this.mod[13]=!0),this.body&&this.body.setLinearDamping(t)}get draw(){return this._display}set draw(t){this._userDefinedDraw=!0,this._draw=t}get dynamic(){return this.body?.isDynamic()}set dynamic(t){this.collider=t?"dynamic":"kinematic"}get fixture(){return this.fixtureList}get fixtureList(){return this.body?this.body.m_fixtureList:null}get friction(){if(this.fixture)return this.fixture.getFriction()}set friction(t){this.watch&&(this.mod[14]=!0);for(let e=this.fixtureList;e;e=e.getNext())e.setFriction(t)}get heading(){return this._heading}set heading(t){this.direction=t}get img(){return this._img||this._ani?.frameImage}set img(t){this.image=t}get image(){return this._img||this._ani?.frameImage}set image(t){"string"==typeof t&&(t=t.includes(".")?e.loadImage(t):new e.EmojiImage(t,this.w)),this._img=this._extendImage(t)}_extendImage(t){return t.offset??={x:0,y:0},t._scale??={x:1,y:1},t.scale||Object.defineProperty(t,"scale",{get:()=>t._scale,set:e=>{"number"==typeof e&&(e={x:e,y:e}),t._scale=e}}),t}get isMoving(){return 0!=this.vel.x||0!=this.vel.y}get isSuperFast(){return this.body?.isBullet()}set isSuperFast(t){this.watch&&(this.mod[16]=!0),this.body&&this.body.setBullet(t)}get kinematic(){return this.body?.isKinematic()}set kinematic(t){this.collider=t?"kinematic":"dynamic"}get layer(){return this._layer}set layer(t){this.watch&&(this.mod[17]=!0),this._layer=t}get life(){return this._life}set life(t){this.watch&&(this.mod[18]=!0),this._life=t}get mass(){return this.body?.getMass()}set mass(t){if(!this.body)return;this.watch&&(this.mod[19]=!0);const e={I:0,center:new i.Vec2(this.body.getLocalCenter()),mass:0};this.body.getMassData(e),e.mass=t>0?t:1e-8,this.body.setMassData(e),delete this._massUndef}resetMass(){if(!this.body)return;let t=new i.Vec2(this.body.getLocalCenter());this.watch&&(this.mod[19]=!0),this.body.resetMassData(),this.body.setMassData({mass:this.body.getMass(),center:t,I:this.body.getInertia()})}resetCenterOfMass(){this.watch&&(this.mod[19]=!0),this.body.resetMassData();let{x:t,y:e}=this.body.getLocalCenter();if(0==t&&0==e)return;this.__offsetCenterBy(-t,-e),this.body.resetMassData();let i=this.body.getPosition();this.body.setPosition({x:i.x+t,y:i.y+e})}get mirror(){return this._mirror}set mirror(t){this.watch&&(this.mod[20]=!0),void 0!==t.x&&(this._mirror.x=t.x),void 0!==t.y&&(this._mirror.y=t.y)}get offset(){return this._offset}set offset(t){t.x??=this._offset._x,t.y??=this._offset._y,t.x==this._offset._x&&t.y==this._offset._y||(this.watch&&(this.mod[21]=!0),this._offsetCenterBy(t.x-this._offset._x,t.y-this._offset._y))}get opacity(){return this._opacity??1}set opacity(t){this.watch&&(this.mod[41]=!0),this._opacity=t}get previousPosition(){return this.prevPos}set previousPosition(t){this.prevPos=t}get previousRotation(){return this.prevRotation}set previousRotation(t){this.prevRotation=t}get pixelPerfect(){return this._pixelPerfect}set pixelPerfect(t){this.watch&&(this.mod[22]=!0),this._pixelPerfect=t}get rotation(){if(!this.body||!g)return this._rotation||0;let t=this.body.getAngle();return e.p5play.friendlyRounding&&(t=u(t,d)),e._angleMode==a?e.degrees(t):t}set rotation(t){this._rotation=t,this.body&&(e._angleMode==a&&(t=e.radians(t%360)),this.body.setAngle(t),this.body.synchronizeTransform())}get rotationDrag(){return this.body?.getAngularDamping()}set rotationDrag(t){this.body&&(this.watch&&(this.mod[24]=!0),this.body.setAngularDamping(t))}get rotationLock(){return this.body?.isFixedRotation()}set rotationLock(t){if(!this.body)return;this.watch&&(this.mod[25]=!0);let e=this.mass;this.body.setFixedRotation(t),this.mass=e}get rotationSpeed(){if(this.body){let t=this.body.getAngularVelocity()/60;return e._angleMode==a?e.degrees(t):t}return this._rotationSpeed}set rotationSpeed(t){this.body?(t*=60,e._angleMode==a&&(t=e.radians(t)),this.body.setAngularVelocity(t)):this._rotationSpeed=t}get scale(){return this._scale}set scale(t){if(0==t&&(t=.01),"number"==typeof t?t={x:t,y:t}:(t.x??=this._scale._x,t.y??=this._scale._y),t.x==this._scale._x&&t.y==this._scale._y)return;this.watch&&(this.mod[26]=!0);let e={x:Math.abs(t.x/this._scale._x),y:Math.abs(t.y/this._scale._y)};this._w*=e.x,this._hw*=e.x,this._h&&(this._h*=e.y,this._hh*=e.y),this._resizeColliders(e),this._scale._x=t.x,this._scale._y=t.y,this._scale._avg=t.x}get sleeping(){if(this.body)return!this.body.isAwake()}set sleeping(t){this.body&&(this.watch&&(this.mod[28]=!0),this.body.setAwake(!t))}get speed(){return e.createVector(this.vel.x,this.vel.y).mag()}set speed(t){let i=this.direction;this.vel.x=e.cos(i)*t,this.vel.y=e.sin(i)*t}get static(){return this.body?.isStatic()}set static(t){this.collider=t?"static":"dynamic"}get tint(){return this._tint}set tint(t){this.watch&&(this.mod[38]=!0),this._tint=this._parseColor(t)}get tintColor(){return this._tint}set tintColor(t){this.tint=t}set vertices(t){if(3==this.__collider)throw new Error('Cannot set vertices of a sprite with collider type of "none".');this.watch&&(this.mod[27]=!0),this._removeFixtures(),this._originMode="start",this.addCollider(t),this._hasSensors&&this.addDefaultSensors()}get vertices(){return this._getVertices()}_getVertices(t){let i=this.fixture.getShape(),s=[...i.m_vertices];"polygon"==i.m_type&&s.unshift(s.at(-1));let r=this.x,o=this.y;for(let i=0;i<s.length;i++){let a=[s[i].x/this.tileSize*e.world.meterSize+r,s[i].y/this.tileSize*e.world.meterSize+o];e.p5play.friendlyRounding&&(a[0]=u(a[0]),a[1]=u(a[1])),s[i]=t?a:e.createVector(a[0],a[1])}return s}get visible(){return this._visible}set visible(t){this.watch&&(this.mod[39]=!0),this._visible=t}get x(){return this._pos.x}set x(t){this._pos.x=t}get y(){return this._pos.y}set y(t){this._pos.y=t}get pos(){return this._pos}set pos(t){if(this.body){let s=new i.Vec2(t.x*this.tileSize/e.world.meterSize,t.y*this.tileSize/e.world.meterSize);this.body.setPosition(s)}this._position.x=t.x,this._position.y=t.y}get position(){return this._pos}set position(t){this.pos=t}get canvasPos(){return this._canvasPos}get w(){return this._w}set w(t){if(t<0&&(t=.01),t==this._w)return;this.watch&&(this.mod[40]=!0);let e=t/this._w;this._w=t,this._hw=.5*t,this._resizeColliders({x:e,y:1}),delete this._widthUndef,delete this._dimensionsUndef}get hw(){return this._hw}set hw(t){throw new T("Sprite.hw")}get width(){return this._w}set width(t){this.w=t}get halfWidth(){return this.hw}set halfWidth(t){throw new T("Sprite.hw")}get h(){return this._h||this._w}set h(t){if(t<0&&(t=.01),1==this.__shape)return void(this.w=t);if(t==this._h)return;this.watch&&(this.mod[15]=!0);let e=t/this._h;this._h=t,this._hh=.5*t,this._resizeColliders({x:1,y:e}),delete this._heightUndef,delete this._dimensionsUndef}get hh(){return this._hh||this._hw}set hh(t){throw new T("Sprite.hh")}get height(){return this.h}set height(t){this.h=t}get halfHeight(){return this.hh}set halfHeight(t){throw new T("Sprite.hh")}get d(){return this._w}set d(t){t<0&&(t=.01);let e=1!=this.__shape;if(e||this._w!=t){if(this.watch&&(this.mod[40]=!0),!e){let e=t/this._w;this._resizeColliders({x:e,y:e})}this._w=t,this._hw=.5*t,e&&(this.shape="circle")}}get diameter(){return this._w}set diameter(t){this.d=t}get r(){return this._hw}set r(t){this.d=2*t}get radius(){return this._hw}set radius(t){this.d=2*t}_resizeColliders(t){if(this.body){for(let e=this.fixtureList;e;e=e.getNext()){if(e.m_isSensor)continue;let i=e.m_shape;if("circle"==i.m_type)1!=t.x?i.m_radius*=t.x:i.m_radius*=t.y;else for(let e of i.m_vertices)e.x*=t.x,e.y*=t.y}(this._widthUndef||this._heightUndef)&&this.resetMass(),this.body.synchronizeFixtures()}}_isConvexPoly(t){t:for(let e=0;e<2;e++){1==e&&(t=t.reverse());for(let s=0;s<t.length;++s){const r=s,o=s<t.length-1?r+1:0,a=t[r],h=i.Vec2.sub(t[o],a);for(let s=0;s<t.length;++s){if(s==r||s==o)continue;const n=i.Vec2.sub(t[s],a);if(i.Vec2.cross(h,n)<0){if(0==e)continue t;return!1}}}break}return!0}get shape(){return this._shape}set shape(t){if(t==this._shape)return;let i=e.Sprite.shapeTypes.indexOf(t);if(-1==i)throw new Error('Invalid shape type: "'+t+'"\nThe valid shape types are: "'+e.Sprite.shapeTypes.join('", "')+'"');if(3==this.__collider&&i>=2)return void console.error('Cannot set the collider shape to chain or polygon if the sprite has a collider type of "none". To achieve the same effect, use .overlaps(allSprites) to have your sprite overlap with the allSprites group.');let s,r,o=this.__shape;if(this.__shape=i,this._shape=t,this.watch&&(this.mod[27]=!0),void 0===o)return;if(0==this.__shape?(this._h=this._w,this._hh=this._hw):(this._h=void 0,this._hh=void 0),1!=o&&1!=this.__shape?s=this._getVertices(!0):r=this._w,this._removeFixtures(),3!=this.__collider)if(s)this._originMode??="center",this.addCollider(s);else if(1==o){let t=this._w*Math.sin(Math.PI/12);this.addCollider(0,0,[t,-30,12])}else this.addCollider();this._hasSensors&&this.addDefaultSensors();let a=this._offset._x,h=this._offset._y;(a||h)&&(this._offset._x=0,this._offset._y=0,this._offsetCenterBy(a,h))}get update(){return this._update}set update(t){this._customUpdate=t}get postDraw(){return this._postDraw}set postDraw(t){this._customPostDraw=t}get vel(){return this._vel}set vel(t){this.vel.x=t.x,this.vel.y=t.y}get velocity(){return this._vel}set velocity(t){this.vel=t}get gravityScale(){return this.body?.getGravityScale()}set gravityScale(t){this.body&&(this.watch&&(this.mod[42]=!0),this.body.setGravityScale(t))}_update(){this._customUpdate&&this._customUpdate(),this.autoUpdate&&(this.autoUpdate=null)}_step(){this.life-=f,2147483647!=this._life&&this._life<=0&&this.remove(),this.body&&g||this._deleted||(this._position.x+=this.vel.x*f,this._position.y+=this.vel.y*f,this._rotation+=this._rotationSpeed*f),this.watch&&(this.x!=this.prevX&&(this.mod[0]=this.mod[2]=!0),this.y!=this.prevY&&(this.mod[1]=this.mod[2]=!0),this.rotation!=this.prevRotation&&(this.mod[3]=this.mod[4]=!0)),(this.body||this._deleted)&&this.__step()}__step(){let t,i=this;for(let s in _)for(let r in this[s]){if(r>=1e3){if(i._isGroup||i._uid>=r)continue;t=e.p5play.sprites[r]}else{if(i._isGroup&&i._uid>=r)continue;t=e.p5play.groups[r]}let o=i[s][r]+1;t&&0!=o&&-2!=o?(this[s][r]=o,t[s][i._uid]=o):(delete i[s][r],t&&delete t[s][i._uid])}}___step(){let t,i,s,r,o=this,a=!0;for(let h in _){for(let n in this[h]){if(n>=1e3){if(o._isGroup||o._uid>=n)continue;t=e.p5play.sprites[n]}else{if(o._isGroup&&o._uid>=n)continue;t=e.p5play.groups[n]}if(o._isGroup||t?._isGroup)continue;if(s=o._hasOverlap[t._uid]??t._hasOverlap[o._uid],a&&!1!==s||!a&&!0!==s)continue;let l=o[h][n];for(let s=0;s<3;s++){if(0==s&&1!=l&&-3!=l)continue;if(1==s&&-1==l)continue;if(2==s&&l>=1)continue;i=_[h][s];let a=e.p5play[i][o._uid];if(a){r=a[t._uid],r&&r.call(o,o,t,l);for(let e of t.groups)r=a[e._uid],r&&r.call(o,o,t,l)}let n=e.p5play[i][t._uid];if(n){r=n[o._uid],r&&r.call(t,t,o,l);for(let e of o.groups)r=n[e._uid],!r||a&&r==a[e._uid]||r.call(t,t,o,l)}}}a=!1}if(this._deleted&&0==Object.keys(this._collisions).length&&0==Object.keys(this._overlappers).length){this._isSprite?delete e.p5play.sprites[this._uid]:e.p5play.storeDeletedGroupRefs||delete e.p5play.groups[this._uid];for(let t in _)for(let i of _[t])delete e.p5play[i][this._uid]}}_display(){let t,i=this.x*this.tileSize+e.world.origin.x,s=this.y*this.tileSize+e.world.origin.y;if(!this._userDefinedDraw){let t;if(t=this._totalWidth?Math.max(this._totalWidth,this._totalHeight):void 0!==this._h?Math.max(this._w,this._h):this._w,this.ani&&!e.p5play.disableImages&&(t=Math.max(t,this.ani.w,this.ani.h)),"chain"!=this.shape&&e.camera.isActive&&(i+t<e.camera.bound.min.x||i-t>e.camera.bound.max.x||s+t<e.camera.bound.min.y||s-t>e.camera.bound.max.y))return void(this._visible=null)}if(this._visible=!0,e.p5play.spritesDrawn++,this._pixelPerfect){let t,r;this.ani&&this.ani.length&&!e.p5play.disableImages?(t=this.ani[this.ani._frame].w,r=this.ani[this.ani._frame].h):(t=this._w,r=this._h),i=t%2==0?Math.round(i):Math.round(i-.5)+.5,s=r%2==0?Math.round(s):Math.round(s-.5)+.5}else i=u(i),s=u(s);for(let t of this.joints)t.visible?this._uid==t.spriteA._uid?(!t.spriteB._visible||this.layer<=t.spriteB.layer)&&t._display():(!t.spriteA._visible||this.layer<t.spriteA.layer)&&t._display():t.visible??=!0;0!=this._opacity&&(e.push(),e.imageMode("center"),e.rectMode("center"),e.ellipseMode("center"),e.translate(i,s),this.rotation&&e.rotate(this.rotation),1==this._scale.x&&1==this._scale.y||e.scale(this._scale.x,this._scale.y),e.fill(this.color),void 0!==this._strokeWeight&&e.strokeWeight(this._strokeWeight),this._opacity&&(e.opacity?e.opacity(this._opacity):(t=e.ctx.globalAlpha,e.ctx.globalAlpha=this._opacity)),this._tint&&e.tint(this._tint),this._draw(),e.pop(),this._opacity&&(e.ctx.globalAlpha=t),this._cameraActiveWhenDrawn=e.camera.isActive,e.camera.isActive||(e.camera._wasOff=!0),this.autoDraw&&(this.autoDraw=null))}__draw(){let t=this._ani||this._img;if(t&&!e.p5play.disableImages){(this._offset.x||this._offset.y)&&e.translate(this._offset.x,this._offset.y);let i=t._scale._x,s=t._scale._y;(1!=i||1!=s)&&e.scale(i,s);let r=t.offset.x,o=t.offset.y;this._ani?t.draw(r,o):e.image(t,r,o)}if(!t||this.debug||e.p5play.disableImages)if(this.debug&&(e.noFill(),e.stroke(0,255,0),e.line(0,-2,0,2),e.line(-2,0,2,0)),3!=this.__collider){this.debug||0===this._strokeWeight?e.noStroke():2==this.__shape?e.stroke(this.stroke||this.color):this._stroke&&e.stroke(this._stroke);for(let t=this.fixtureList;t;t=t.getNext()){if(this.debug)t.m_isSensor?e.stroke(255,255,0,127):e.stroke(0,255,0,127);else if(t.m_isSensor)continue;this._drawFixture(t)}}else 0!==this._strokeWeight&&e.stroke(this._stroke||120),0==this.__shape?e.rect(this._offset._x,this._offset._y,this.w*this.tileSize,this.h*this.tileSize):1==this.__shape&&e.circle(this._offset._x,this._offset._y,this.d*this.tileSize);void 0!==this.text&&(e.textAlign(e.CENTER,e.CENTER),e.fill(this._textFill),this._textStrokeWeight&&e.strokeWeight(this._textStrokeWeight),this._textStroke?e.stroke(this._textStroke):e.noStroke(),e.textSize(this.textSize*this.tileSize),e.text(this.text,0,0))}_postDraw(){this._ani?.update&&this._ani.update();for(let t in this.mouse)-1==this.mouse[t]&&(this.mouse[t]=0);this._customPostDraw&&this._customPostDraw(),this.autoDraw??=!0,this.autoUpdate??=!0}_drawFixture(t){const i=t.m_shape;if("polygon"==i.m_type||"chain"==i.m_type){if("chain"==i.m_type){if(0==e._strokeWeight)return;e.push(),e.noFill()}let t=i.m_vertices;e.beginShape();for(let i=0;i<t.length;i++)e.vertex(t[i].x*e.world.meterSize,t[i].y*e.world.meterSize);"chain"!=i.m_type?e.endShape("close"):(e.endShape(),e.pop())}else if("circle"==i.m_type){const t=2*i.m_radius*e.world.meterSize;e.ellipse(i.m_p.x*e.world.meterSize,i.m_p.y*e.world.meterSize,t,t)}else"edge"==i.m_type&&e.line(i.m_vertex1.x*e.world.meterSize,i.m_vertex1.y*e.world.meterSize,i.m_vertex2.x*e.world.meterSize,i.m_vertex2.y*e.world.meterSize)}_args2Vec(t,e){return Array.isArray(t)?{x:t[0],y:t[1]}:("object"==typeof t&&(e=t.y,t=t.x),{x:t||0,y:e||0})}_parseForceArgs(){let t=arguments;"number"!=typeof t[0]||1!=t.length&&"number"==typeof t[1]?2==t.length&&"number"!=typeof t[1]&&(t[2]=t[1],t[1]=void 0):(t[3]=t[2],t[2]=t[1],t[1]=e.sin(this._bearing)*t[0],t[0]=e.cos(this._bearing)*t[0]);let s={};return s.forceVector=new i.Vec2(this._args2Vec(t[0],t[1])),void 0!==t[2]&&(s.poa=this._args2Vec(t[2],t[3]),s.poa=h(s.poa.x,s.poa.y,this.tileSize)),s}applyForce(t,e){if(!this.body)return;if("game.thegamebox.ca"==location.host)return this.applyForceScaled(...arguments);let{forceVector:i,poa:s}=this._parseForceArgs(...arguments);s?this.body.applyForce(i,s):this.body.applyForceToCenter(i)}applyForceScaled(t,e){if(!this.body)return;let{forceVector:i,poa:s}=this._parseForceArgs(...arguments);i.mul(this.mass),s?this.body.applyForce(i,s):this.body.applyForceToCenter(i)}attractTo(t,s,r,o,a){if(!this.body||0!=this.__collider)return void console.error("attractTo can only be used on sprites with dynamic colliders");if("number"!=typeof t){let i=t;if(!i||i==e.mouse&&!e.mouse.isActive)return;r=s,s=i.y,t=i.x}if(this.x==t&&this.y==s)return;let h=s-this.y,n=t-this.x,l=r/Math.sqrt(h*h+n*n),d=new i.Vec2(n*l,h*l);this.body.applyForceToCenter(d)}repelFrom(t,i,s,r,o){if(this.body&&0==this.__collider){if("number"!=typeof t){let r=t;if(!r||r==e.mouse&&!e.mouse.isActive)return;s=i,i=r.y,t=r.x}this.attractTo(t,i,-s,r,o)}else console.error("repelFrom can only be used on sprites with dynamic colliders")}applyTorque(t){this.body&&this.body.applyTorque(t)}moveTowards(t,i,s){if(void 0!==t){if("number"!=typeof t&&null!==t){let r=t;if(r==e.mouse&&!e.mouse.isActive)return;if(!r||void 0===r.x||void 0===r.y)throw"sprite.moveTowards/moveAway ERROR: movement destination not defined.";s=i,i=r.y,t=r.x}if(s??=.1,null!=t){let e=t-this.x;p(e)?this.vel.x=0:this.vel.x=e*s*this.tileSize}if(null!=i){let t=i-this.y;p(t)?this.vel.y=0:this.vel.y=t*s*this.tileSize}}}moveAway(t,e,i){this.moveTowards(...arguments),this.vel.x*=-1,this.vel.y*=-1}move(t,i,s){if(!t)return Promise.resolve(!1);let r=isNaN(arguments[0]);r&&(t=1,i=arguments[0],s=arguments[1]),"string"==typeof i&&(r=!0,this._heading=i,i=this._getDirectionAngle(i)),i??=this.direction;let o=e.cos(i)*t,a=e.sin(i)*t;return 1==this.tileSize&&!e.p5play.snapToGrid||!r&&i%90!=0||t%e.p5play.gridSize!=0?(o+=this.x,a+=this.y,i%45==0&&(o=u(o),a=u(a))):(o=Math.round((this.x+Math.round(o))/e.p5play.gridSize)*e.p5play.gridSize,a=Math.round((this.y+Math.round(a))/e.p5play.gridSize)*e.p5play.gridSize),this.moveTo(o,a,s)}moveTo(t,i,s){if("number"!=typeof t&&t){let r=t;if(r==e.mouse&&!e.mouse.isActive)return;if(!r||void 0===r.x||void 0===r.y)throw"sprite.moveTo ERROR: destination not defined.";s=i,i=r.y,t=r.x}if(null!=t&&t!=this.x?(this._dest.x=t,t=!0):(this._dest.x=this.x,t=!1),null!=i&&i!=this.y?(this._dest.y=i,i=!0):(this._dest.y=this.y,i=!1),this._destIdx++,!t&&!i)return Promise.resolve(!0);if(s??=this.speed||(this.tileSize<=1?1:.1),s<=0)return console.warn("sprite.move: speed should be a positive number"),Promise.resolve(!1);let r=this._dest.y-this.y,o=this._dest.x-this.x,a=s/Math.sqrt(r*r+o*o);this.vel.x=o*a,this.vel.y=r*a;let h=this.direction<0?this.direction+360:this.direction,n=h-.1,l=h+.1,d=e.world.velocityThreshold;d=Math.min(d,.1*s);let p=.51*s*(e.world.meterSize/60),u=t&&i,c=this._destIdx;return(async()=>{let s,r;do{if(await e.sleep(),c!=this._destIdx)return!1;let o=this.direction<0?this.direction+360:this.direction;if(u&&(o<=n||o>=l)||Math.abs(this.vel.x)<=d&&Math.abs(this.vel.y)<=d)return!1;t&&(s=this.vel.x>0?this._dest.x-this.x:this.x-this._dest.x),i&&(r=this.vel.y>0?this._dest.y-this.y:this.y-this._dest.y)}while(t&&s>p||i&&r>p);return this.x=this._dest.x,this.y=this._dest.y,this.vel.x=0,this.vel.y=0,!0})()}rotateTowards(t,e){if(1==this.__collider)return void new T(0);let i,s,r,o=arguments;"number"!=typeof o[0]?(i=o[0].x,s=o[0].y,e=o[1],r=o[2]):arguments.length>2&&(i=o[0],s=o[1],e=o[2],r=o[3]),void 0!==i?t=this.angleToFace(i,s,r):t-=this.rotation,e??=.1,this.rotationSpeed=t*e}angleTo(t,i){if("object"==typeof t){let s=t;if(s==e.mouse&&!e.mouse.isActive)return 0;if(void 0===s.x||void 0===s.y)return console.error("sprite.angleTo ERROR: rotation destination not defined, object given with no x or y properties"),0;i=s.y,t=s.x}return e.atan2(i-this.y,t-this.x)}rotationToFace(t,e,i){return"object"==typeof t&&(i=e,e=t.y,t=t.x),Math.abs(t-this.x)<.01&&Math.abs(e-this.y)<.01?0:this.angleTo(t,e)+(i||0)}angleToFace(t,e,i){let s=this.rotationToFace(t,e,i);return c(s,this.rotation)}rotateTo(t,i,s){if(1==this.__collider)return void new T(0);let r=arguments;if("number"!=typeof r[0]?t=this.rotationToFace(r[0].x,r[0].y,s):r.length>2&&(s=r[3],i=r[2],t=this.rotationToFace(r[0],r[1],s)),t==this.rotation)return;let o=e._angleMode==a?360:e.TWO_PI;return(t=(t-this.rotation)%o)<0&&i>0&&(t+=o),t>0&&i<0&&(t-=o),i??=this.rotationSpeed||Math.sign(t),this.rotate(t,i)}rotateMinTo(t,e,i){if(1==this.__collider)return void new T(0);let s=arguments;return"number"!=typeof s[0]?t=this.rotationToFace(s[0].x,s[0].y,i):s.length>2&&(i=s[3],e=s[2],t=this.rotationToFace(s[0],s[1],i)),t!=this.rotation?(t=c(t,this.rotation),e??=this.rotationSpeed>.1?this.rotationSpeed:1,e=Math.abs(e)*Math.sign(t),this.rotate(t,e)):void 0}rotate(t,i){if(1==this.__collider)return void new T(0);if(isNaN(t))return void new T(1,[t]);if(0==t)return;i??=this.rotationSpeed||1;let s=t>0&&i>0;s||(t=-Math.abs(t),i=-Math.abs(i)),this.rotationSpeed=i;let r=Math.abs(i),o=this.rotation+t;this._rotateIdx??=0,this._rotateIdx++;let a=this._rotateIdx;return(async()=>{let t=.01;do{let h=Math.abs(o-this.rotation);if(r>h&&(this.rotationSpeed=h*Math.sign(i)),await e.sleep(),this._rotateIdx!=a)return!1;if(s&&this.rotationSpeed<t||!s&&this.rotationSpeed>-.01)return!1}while((s&&o>this.rotation||!s&&o<this.rotation)&&t<Math.abs(o-this.rotation));return this.rotationSpeed=0,this.rotation=o,!0})()}addAni(){if(e.p5play.disableImages)return void(this._ani=new e.Ani);let t,i,s=[...arguments];return s[0]instanceof e.Ani?(i=s[0],i._addedToSpriteOrGroup&&(i=i.clone()),t=i.name||"default",i.name=t):s[1]instanceof e.Ani?(t=s[0],i=s[1],i._addedToSpriteOrGroup&&(i=i.clone()),i.name=t):(i=new e.Ani(this,...s),t=i.name),this.animations[t]=i,this._ani=i,i._addedToSpriteOrGroup=!0,!this._dimensionsUndef||1==i.w&&1==i.h||(this.w=i.w,this.h=i.h),i}addAnis(){let t,e=arguments;1==e.length?t=e[0]:(this.spriteSheet=e[0],t=e[1]);for(let e in t){let i=t[e];this.addAni(e,i)}}async changeAni(t){if(e.p5play.disableImages)return;if(arguments.length>1)t=[...arguments];else if(t instanceof e.Ani){if(t==this._ani)return;t=[t]}else if(!Array.isArray(t)){if(t==this._ani?.name)return;t=[t]}let i,s;this._aniChangeCount++;for(let r=0;r<t.length;r++){let o=t[r];(o instanceof e.Ani||o instanceof p5.Image||"string"==typeof o&&1!=o.length&&o.includes("."))&&(o=this.addAni(o),t[r]=o),"string"==typeof o&&(o={name:o},t[r]=o),o.name.length>1&&("!"==o.name[0]&&(o.name=o.name.slice(1),o.start=-1,o.end=0),"<"!=o.name[0]&&">"!=o.name[0]||(o.name=o.name.slice(1),o.flipX=!0),"^"==o.name[0]&&(o.name=o.name.slice(1),o.flipY=!0),"**"==o.name&&(i=!0,t=t.slice(0,-1)),";;"==o.name&&(s=!0,t=t.slice(0,-1)))}let r=this._aniChangeCount;do{for(let e=0;e<t.length;e++){let i=t[e];!i.start&&t.length>1&&(i.start=0),await this._playSequencedAni(i)}}while(i&&r==this._aniChangeCount);1!=t.length&&s&&this._ani.stop()}_playSequencedAni(t){return new Promise((e=>{let{name:i,start:s,end:r,flipX:o,flipY:a}=t;this._changeAni(i),o&&(this._ani.scale.x=-this._ani.scale.x),a&&(this._ani.scale.y=-this._ani.scale.y),s<0&&(s=this._ani.length+s),void 0!==s&&(this._ani._frame=s),void 0!==r?this._ani.goToFrame(r):this._ani._frame==this._ani.lastFrame&&e(),this._ani._onComplete=this._ani._onChange=()=>{o&&(this._ani.scale.x=-this._ani.scale.x),a&&(this._ani.scale.y=-this._ani.scale.y),this._ani._onComplete=this._ani._onChange=null,e()}}))}changeAnimation(){return this.changeAni(...arguments)}_changeAni(t){this._ani?._onChange&&this._ani._onChange(),this._ani?.onChange&&this._ani.onChange();let i=this.animations[t];if(!i)for(let e=this.groups.length-1;e>=0;e--){if(i=this.groups[e].animations[t],i){i=i.clone();break}}if(!i)throw e.noLoop(),new T("Sprite.changeAnimation",[t]);this._ani=i,this._ani.name=t,this.resetAnimationsOnChange&&(this._ani._frame=0)}delete(){if(!this._deleted){this.watch&&(this.mod[23]=!0),this._deleted=!0;for(let t=this.groups.length-1;t>=0;t--){this.groups[t].remove(this)}this.body&&e.world.destroyBody(this.body),this.body=null}}get deleted(){return this._deleted}get removed(){return this._deleted}toString(){return"s"+this.idNum}_setContactCB(t,i,s,r){let o;o=0==s?_._collisions[r]:_._overlappers[r];let a=e.p5play[o],h=a[this._uid]??={};h[t._uid]!=i&&(h[t._uid]=i,h=a[t._uid],h&&h[this._uid]&&(delete h[this._uid],0==Object.keys(h).length&&delete a[t._uid]))}_validateCollideParams(t,e){if(!t)throw new T("Sprite.collide",2);if(!t._isSprite&&!t._isGroup)throw new T("Sprite.collide",0,[t]);if(e&&"function"!=typeof e)throw new T("Sprite.collide",1,[e])}_ensureCollide(t,e,i){if(!1!==this._hasOverlap[t._uid]&&(this._hasOverlap[t._uid]=!1),!1!==t._hasOverlap[this._uid]&&(t._hasOverlap[this._uid]=!1,t._isGroup))for(let e of t)e._hasOverlap[this._uid]=!1,this._hasOverlap[e._uid]=!1}collide(t,e){return this.collides(t,e)}collides(t,e){return this._validateCollideParams(t,e),this._ensureCollide(t),e&&this._setContactCB(t,e,0,0),1==this._collisions[t._uid]||this._collisions[t._uid]<=-3}colliding(t,e){this._validateCollideParams(t,e),this._ensureCollide(t),e&&this._setContactCB(t,e,0,1);let i=this._collisions[t._uid];return i<=-3?1:i>0?i:0}collided(t,e){return this._validateCollideParams(t,e),this._ensureCollide(t),e&&this._setContactCB(t,e,0,2),this._collisions[t._uid]<=-1}_validateOverlapParams(t,e){if(!t)throw new T("Sprite.overlap",2);if(!t._isSprite&&!t._isGroup)throw new T("Sprite.overlap",0,[t]);if(e&&"function"!=typeof e)throw new T("Sprite.overlap",1,[e])}_ensureOverlap(t){if(this._hasSensors||this.addDefaultSensors(),!t._hasSensors)if(t._isSprite)t.addDefaultSensors();else{for(let e of t)e._hasSensors||e.addDefaultSensors();t._hasSensors=!0}if(this._hasOverlap[t._uid]||(this._removeContactsWith(t),this._hasOverlap[t._uid]=!0),!t._hasOverlap[this._uid]&&(t._removeContactsWith(this),t._hasOverlap[this._uid]=!0,t._isGroup))for(let e of t)e._hasOverlap[this._uid]=!0,this._hasOverlap[e._uid]=!0}overlap(t,e){return this.overlaps(t,e)}overlaps(t,e){return this._validateOverlapParams(t,e),this._ensureOverlap(t),e&&this._setContactCB(t,e,1,0),1==this._overlappers[t._uid]||this._overlappers[t._uid]<=-3}overlapping(t,e){this._validateOverlapParams(t,e),this._ensureOverlap(t),e&&this._setContactCB(t,e,1,1);let i=this._overlappers[t._uid];return i<=-3?1:i>0?i:0}overlapped(t,e){return this._validateOverlapParams(t,e),this._ensureOverlap(t),e&&this._setContactCB(t,e,1,2),this._overlappers[t._uid]<=-1}_removeContactsWith(t){if(t._isGroup)for(let e of t)this._removeContactsWith(e);else this.__removeContactsWith(t)}__removeContactsWith(t){if(this.body)for(let i=this.body.getContactList();i;i=i.next){let s=i.contact;s.m_fixtureA.m_body.sprite._uid!=t._uid&&s.m_fixtureB.m_body.sprite._uid!=t._uid||e.world.destroyContact(s)}}_sortFixtures(){let t,e,i=null,s=null;for(let r=this.fixtureList;r;r=r.getNext())r.m_isSensor?(s?s.m_next=r:s=r,e=r):(i?i.m_next=r:i=r,t=r);s&&(e.m_next=null),i&&(t.m_next=s),this.body.m_fixtureList=i||s}addDefaultSensors(){let t;if(this.body&&this.fixtureList){for(let e=this.fixtureList;e;e=e.getNext())e.m_isSensor||(t=e.m_shape,this.body.createFixture({shape:t,isSensor:!0}));this._sortFixtures()}else this.addSensor();this._hasSensors=!0}distanceTo(t){return e.dist(this.x,this.y,t.x,t.y)}},e.Sprite.propTypes={x:"Float64",y:"Float64",vel:"Vec2",rotation:"number",rotationSpeed:"number",allowSleeping:"boolean",bearing:"number",bounciness:"number",collider:"Uint8",color:"color",debug:"boolean",density:"number",direction:"number",drag:"number",friction:"number",h:"number",isSuperFast:"boolean",layer:"number",life:"Int32",mass:"number",mirror:"Vec2_boolean",offset:"Vec2",pixelPerfect:"boolean",deleted:"boolean",rotationDrag:"number",rotationLock:"boolean",scale:"Vec2",shape:"Uint8",sleeping:"boolean",stroke:"color",strokeWeight:"number",text:"string",textColor:"color",textSize:"number",textStroke:"color",textStrokeWeight:"number",tile:"string",tileSize:"number",tint:"color",visible:"boolean",w:"number",opacity:"number",gravityScale:"number"},e.Sprite.props=Object.keys(e.Sprite.propTypes),e.Sprite.propsAll=e.Sprite.props.concat(["autoDraw","autoUpdate","colour","d","diameter","dynamic","fill","height","heading","kinematic","resetAnimationsOnChange","speed","spriteSheet","static","textColour","textFill","width"]),e.Sprite.colliderTypes=["d","s","k","n"],e.Sprite.shapeTypes=["box","circle","chain","polygon"],e.Turtle=function(t){if(e.allSprites.tileSize>1)throw new Error("Turtle can't be used when allSprites.tileSize is greater than 1.");t??=25;let i=new e.Sprite(t,t,[[t,.4*t],[-t,.4*t],[0,.8*-t]]);i.color="green",i._isTurtleSprite=!0,i._prevPos={x:i.x,y:i.y};let s=i.move;return i.move=function(){return this._prevPos.x=this.x,this._prevPos.y=this.y,s.call(this,...arguments)},i},this.Ani=class extends Array{constructor(){super();let t,i=[...arguments];if(this.name="default","object"==typeof i[0]&&(i[0]._isSprite||i[0]._isGroup)&&(t=i[0],i=i.slice(1),this._addedToSpriteOrGroup=!0),t??=e.allSprites,"string"!=typeof i[0]||1!=i[0].length&&i[0].includes(".")||(this.name=i[0],i=i.slice(1)),this._frame=0,this._cycles=0,this.targetFrame=-1,this.offset={x:t.anis.offset.x??0,y:t.anis.offset.y??0},this._frameDelay=t.anis.frameDelay||4,this.demoMode=t.anis.demoMode??!1,this.playing=!0,this.visible=!0,this.looping=t.anis.looping??!0,this.endOnFirstFrame=t.anis.endOnFirstFrame??!1,this.frameChanged=!1,this.onComplete=this.onChange=null,this._onComplete=this._onChange=null,this.rotation=t.anis.rotation??0,this._scale=new m,0!=i.length&&"number"!=typeof i[0]){if(t.animations[this.name]=this,t._ani=this,Array.isArray(i[0])&&"string"==typeof i[0][0]&&(i=[...i[0]]),2!=i.length||"string"!=typeof i[0]||"string"!=typeof i[1]&&"number"!=typeof i[1])if("string"==typeof i.at(-1)||i.at(-1)instanceof p5.Image)for(let s=0;s<i.length;s++)i[s]instanceof p5.Image?this.push(i[s]):this.push(e.loadImage(i[s]));else{let r,o=t.spriteSheet;if(i[0]instanceof p5.Image||"string"==typeof i[0]){if(i.length>=3)throw new T("Ani",1);o=i[0],r=i[1]}else r=i[0];let a=this;if(null==o)throw new T("Ani",2);if(o instanceof p5.Image&&1!=o.width&&1!=o.height)this.spriteSheet=o,h();else{let n;n="string"==typeof o?o:o.src,e._incrementPreload(),this.spriteSheet=e.loadImage(n,(()=>{h(),e._decrementPreload()})),this.spriteSheet.src=n,"string"==typeof o&&(t.spriteSheet=this.spriteSheet)}function h(){Array.isArray(r)&&(r="object"==typeof r[0]?{frames:r}:4==r.length?{pos:r.slice(0,2),size:r.slice(2)}:{pos:r});let{w:i,h:s,width:o,height:h,size:n,row:l,col:d,line:p,x:u,y:c,pos:_,frames:g,frameCount:f,frameDelay:y,frameSize:m,delay:w}=r;m??=n||t.anis.frameSize,w&&(a.frameDelay=w),y&&(a.frameDelay=y),g&&Array.isArray(g)?f=g.length:f??=g||1,i??=o||t.anis.w,s??=h||t.anis.h,u??=d||0,c??=p||l||0,_&&(u=_[0],c=_[1]),"number"==typeof m?i=s=m:m&&(i=m[0],s=m[1]);let x=t.tileSize;if(i&&s?(i*=x,s*=x):!t._dimensionsUndef&&t.w&&t.h?(i??=t.w*x,s??=t.h*x):1!=x?(i??=x,s??=x):f?(i??=a.spriteSheet.width/f,s??=a.spriteSheet.height):i=s=a.spriteSheet.width<a.spriteSheet.height?a.spriteSheet.width:a.spriteSheet.height,Array.isArray(g)){let t=Math.round(a.spriteSheet.width/i);for(let r of g){let o;"number"==typeof r?(c=Math.floor(r/t)*s,u=r%t*i,o={x:u,y:c,w:i,h:s}):2==r.length?(u=r[0]*i,c=r[1]*s,o={x:u,y:c,w:i,h:s}):o={x:r[0],y:r[1],w:r[2],h:r[3]},e._defaultImageScale&&(o.defaultWidth=o.w*e._defaultImageScale,o.defaultHeight=o.h*e._defaultImageScale),a.push(o)}}else{(1!=x||_||void 0!==p||void 0!==l||void 0!==d)&&(u*=i,c*=s);for(let t=0;t<f;t++){let t={x:u,y:c,w:i,h:s};e._defaultImageScale&&(t.defaultWidth=i*e._defaultImageScale,t.defaultHeight=s*e._defaultImageScale),a.push(t),u+=i,u>=a.spriteSheet.width&&(u=0,c+=s,c>=a.spriteSheet.height&&(c=0))}}if(a.cutFrames=r.cutFrames??t.anis.cutFrames,a.cutFrames)for(let t=0;t<a.length;t++){let e=a[t];a[t]=a.spriteSheet.get(e.x,e.y,e.w,e.h)}}}else{let l,d,p=i[0];isNaN(i[1])?l=i[1]:d=Number(i[1]);let u=p.lastIndexOf("."),c=0,_=0;for(let w=u-1;w>=0&&!isNaN(p.charAt(w));w--)c++;if(l)for(let x=l.length-5;x>=0&&!isNaN(l.charAt(x));x--)_++;let g,f=p.slice(u),y=p.slice(0,u-c);if(l&&(g=l.slice(0,u-_)),l&&y!=g)this.push(e.loadImage(p)),this.push(e.loadImage(l));else{let v,b=parseInt(p.slice(u-c,u),10);if(d??=parseInt(l.slice(u-_,u),10),d<b){let S=d;d=b,b=S}if(l&&c!=_)for(let A=b;A<=d;A++)v=y+A+f,this.push(e.loadImage(v));else for(let C=b;C<=d;C++)v=y+e.nf(C,c)+f,this.push(e.loadImage(v))}}1==this.length&&(this.playing=!1)}}get frame(){return this._frame}set frame(t){if(t<0||t>=this.length)throw new T("Ani.frame",[t,this.length]);this._frame=t,this._cycles=0}get frameDelay(){return this._frameDelay}set frameDelay(t){t<=0&&(t=1),this._frameDelay=t}get scale(){return this._scale}set scale(t){"number"==typeof t&&(t={x:t,y:t}),this._scale._x=t.x,this._scale._y=t.y,this._scale._avg=t.x}clone(){this.length||console.error(`The animation named "${this.name}" must be loaded before it can be properly copied. Sprites need their own copy of a group's animation. Try loading the animation in the preload function and creating new group sprites in the setup function.`);let t=new e.Ani;t.spriteSheet=this.spriteSheet;for(let e=0;e<this.length;e++)t.push(this[e]);return t.name=this.name,t.offset.x=this.offset.x,t.offset.y=this.offset.y,t.frameDelay=this.frameDelay,t.playing=this.playing,t.looping=this.looping,t.rotation=this.rotation,t}draw(t,i,s,r){let o=this[this._frame];if(void 0!==o)if(this.spriteSheet){let{x:a,y:h,w:n,h:l}=o;this.demoMode?e.image(this.spriteSheet,t,i,s||this.spriteSheet.w,r||this.spriteSheet.h,a-this.spriteSheet.w/2+n/2,h-this.spriteSheet.h/2+l/2):e.image(this.spriteSheet,t,i,s||o.defaultWidth||n,r||o.defaultHeight||l,a,h,n,l)}else e.image(o,t,i,s,r);else console.warn('p5play: "'+this.name+'" animation not loaded yet or frame '+this._frame+" does not exist. Load this animation in the preload function if you need to use it at the start of your program.");if(this.playing)if(this._cycles++,this._cycles%this.frameDelay==0){if(this._cycles=0,this.frameChanged=!0,(-1==this.targetFrame&&this._frame==this.lastFrame||this._frame==this.targetFrame)&&(this.endOnFirstFrame&&(this._frame=0),this.looping?this.targetFrame=-1:this.playing=!1,this._onComplete&&this._onComplete(),this.onComplete&&this.onComplete(),!this.looping))return;this.targetFrame>this._frame&&-1!==this.targetFrame?this._frame++:this.targetFrame<this._frame&&-1!==this.targetFrame?this._frame--:this.targetFrame===this._frame&&-1!==this.targetFrame?this.playing=!1:this.looping?this._frame>=this.lastFrame?this._frame=0:this._frame++:this._frame<this.lastFrame&&this._frame++}else this.frameChanged=!1}play(t){return this.playing=!0,void 0!==t&&this._frame!=t&&(this._frame=t,this._cycles=0),this.targetFrame=-1,new Promise((t=>{this._onComplete=()=>{this._onComplete=null,t()}}))}pause(t){this.playing=!1,t&&(this._frame=t)}stop(t){this.playing=!1,t&&(this._frame=t)}rewind(){return this.looping=!1,this.goToFrame(0)}loop(){this.looping=!0,this.playing=!0}noLoop(){this.looping=!1}nextFrame(){this._frame<this.length-1?this._frame=this._frame+1:this.looping&&(this._frame=0),this.targetFrame=-1,this.playing=!1,this._cycles=0}previousFrame(){this._frame>0?this._frame=this._frame-1:this.looping&&(this._frame=this.length-1),this.targetFrame=-1,this.playing=!1,this._cycles=0}goToFrame(t){if(!(t<0||t>=this.length))return this.targetFrame=t,this._cycles=0,this.targetFrame!==this._frame&&(this.playing=!0),new Promise((t=>{this._onComplete=()=>{this._onComplete=null,t()}}))}get lastFrame(){return this.length-1}get frameImage(){let t=this[this._frame];if(t instanceof p5.Image)return t;let{x:i,y:s,w:r,h:o}=t,a=e.createImage(r,o);return a.copy(this.spriteSheet,this.offset.x,this.offset.y,r,o,i,s,r,o),a}get w(){return this.width}get width(){let t=this[this._frame];return t instanceof p5.Image?t.width:t?t.w:1}get defaultWidth(){return this[this._frame].defaultWidth}get h(){return this.height}get height(){let t=this[this._frame];return t instanceof p5.Image?t.height:t?t.h:1}get defaultHeight(){return this[this._frame].defaultHeight}},e.Ani.props=["demoMode","endOnFirstFrame","frameDelay","looping","offset","scale","cutFrames"],this.Anis=class{#t={};constructor(){let t=this,i=[...e.Ani.props,"w","h"],s=["offset","scale"];for(let s of i)Object.defineProperty(this,s,{get:()=>t.#t[s],set(i){t.#t[s]=i;for(let r in t){let o=t[r];o instanceof e.Ani&&(o[s]=i)}}});for(let i of s){this.#t[i]={_x:0,_y:0};for(let s of["x","y"])Object.defineProperty(this.#t[i],s,{get:()=>t.#t[i]["_"+s],set(r){t.#t[i]["_"+s]=r;for(let o in t){let a=t[o];a instanceof e.Ani&&(a[i][s]=r)}}})}}get width(){return this.w}set width(t){this.w=t}get height(){return this.h}set height(t){this.h=t}},this.Group=class extends Array{constructor(...t){let i;if(t[0]instanceof e.Group&&(i=t[0],t=t.slice(1)),super(...t),"number"==typeof t[0])return;for(let t of this)if(!(t instanceof e.Sprite))throw new Error("A group can only contain sprites");if(this._isGroup=!0,this.x,this.y,this.vel,this.rotation,this.rotationSpeed,this.autoDraw,this.allowSleeping,this.autoUpdate,this.bounciness,this.collider,this.color,this.debug,this.density,this.direction,this.drag,this.friction,this.h,this.isSuperFast,this.layer,this.life,this.mass,this.mirror,this.offset,this.pixelPerfect,this.deleted,this.rotationDrag,this.rotationLock,this.scale,this.shape,this.sleeping,this.stroke,this.strokeWeight,this.text,this.textColor,this.tile,this.tileSize,this.visible,this.w,this.bearing,this.d,this.dynamic,this.heading,this.kinematic,this.resetAnimationsOnChange,this.speed,this.static,this.idNum,e.p5play.groupsCreated<999)this.idNum=e.p5play.groupsCreated;else{for(let t=1;t<e.p5play.groups.length;t++)if(!e.p5play.groups[t]?.deleted){this.idNum=t;break}if(!this.idNum){console.warn("ERROR: Surpassed the limit of 999 groups in memory. Try setting `p5play.storeDeletedGroupRefs = false`. Use less groups or delete groups from the p5play.groups array to recycle ids.");for(let t=1;t<e.p5play.groups.length;t++)if(!e.p5play.groups[t]?.length){this.idNum=t;break}this.idNum??=1}}if(this._uid=this.idNum,e.p5play.groups[this._uid]=this,e.p5play.groupsCreated++,e.allSprites||(this._isAllSpritesGroup=!0),this.subgroups=[],i instanceof e.Group){i.subgroups.push(this);let t=i;do{t=e.p5play.groups[t.parent],t.subgroups.push(this)}while(!t._isAllSpritesGroup);this.parent=i._uid}else this._isAllSpritesGroup||(e.allSprites.subgroups.push(this),this.parent=0);this.animations=new e.Anis,this._hasOverlap={},this._collisions={},this._overlappers={};let s=this;this.Sprite=class extends e.Sprite{constructor(){super(s,...arguments)}},this.GroupSprite=this.Sprite,this.Group=class extends e.Group{constructor(){super(s,...arguments)}},this.Subgroup=this.Group,this.mouse={presses:null,pressing:null,pressed:null,holds:null,holding:null,held:null,released:null,hovers:null,hovering:null,hovered:null};for(let t in this.mouse)this.mouse[t]=function(e){for(let i of s)if(i.mouse[t](e))return!0;return!1};for(let t of e.Sprite.propsAll)"ani"!=t&&"velocity"!=t&&"width"!=t&&"height"!=t&&"diameter"!=t&&Object.defineProperty(this,t,{get(){let i=s["_"+t];if(void 0===i&&!s._isAllSpritesGroup){let r=e.p5play.groups[s.parent];r&&(i=r[t])}return i},set(e){s["_"+t]=e;for(let i of s.subgroups)i["_"+t]=e;for(let i=0;i<s.length;i++){let r=s[i],o=e;"function"==typeof e&&(o=e(i)),r[t]=o}}});let r=["mirror","offset","scale","vel"];for(let t of r){t="_"+t,this[t]="vel"!=t?{}:new e.Vector,this[t]._x=0,this[t]._y=0;for(let i of["x","y"])Object.defineProperty(this[t],i,{get(){let r=s[t]["_"+i],o=s.length-1;if(void 0===r&&!s._isAllSpritesGroup){let a=e.p5play.groups[s.parent];a&&(r=a[t][i],o=a.length-1)}return r},set(e){s[t]["_"+i]=e;for(let r=0;r<s.length;r++){let o=s[r],a=e;"function"==typeof e&&(a=e(r)),o[t][i]=a}}})}this._isAllSpritesGroup&&(this.autoCull=!0,this.tileSize=1,this.autoDraw=!0,this.autoUpdate=!0),this.add=this.push,this.contains=this.includes,this.removeAll=this.deleteAll}_getTopLayer(){if(0==this.length)return 0;if(1==this.length&&void 0===this[0]._layer)return 0;let t=this[0]._layer;for(let e of this)e._layer>t&&(t=e._layer);return t}get ani(){return this._ani}set ani(t){this.addAni(t);for(let e of this)e.changeAni(t)}get animation(){return this._ani}set animation(t){this.ani=t}get anis(){return this.animations}get img(){return this._img}set img(t){this.image=t}get image(){return this._img}set image(t){"function"!=typeof t?("string"==typeof t&&(t=t.includes(".")?e.loadImage(t):new e.EmojiImage(t,this.w||this.width||this.d||this.diameter)),this._img=e.Sprite.prototype._extendImage(t)):this._img=t}get amount(){return this.length}set amount(t){let e=t-this.length,i=e>0;e=Math.abs(e);for(let t=0;t<e;t++)i?new this.Sprite:this[this.length-1].delete()}get diameter(){return this.d}set diameter(t){this.d=t}get width(){return this.w}set width(t){this.w=t}get height(){return this.h}set height(t){this.h=t}get velocity(){return this.vel}set velocity(t){this.vel=t}_resetCentroid(){let t=0,e=0;for(let i of this)t+=i.x,e+=i.y;return this.centroid={x:t/this.length,y:e/this.length},this.centroid}_resetDistancesFromCentroid(){for(let t of this)t.distCentroid={x:t.x-this.centroid.x,y:t.y-this.centroid.y}}_validateCollideParams(t,e){if(e&&"function"!=typeof e)throw new T("Group.collide",1,[e]);if(!t)throw new T("Group.collide",2);if(!t._isGroup&&!t._isSprite)throw new T("Group.collide",0,[t])}_setContactCB(t,i,s,r){if(t._isSprite){let e=function(t,e,s){return i.call(e,e,t,s)};return void t._setContactCB(this,e,s,r)}let o;o=0==s?_._collisions[r]:_._overlappers[r];let a=e.p5play[o],h=a[this._uid]??={};if(h[t._uid]!=i){h[t._uid]=i;for(let e of this){(a[e._uid]??={})[t._uid]=i}if(this._uid!=t._uid&&(h=a[t._uid],h&&h[this._uid])){this._uid!=t._uid&&delete h[this._uid];for(let e of t)h=a[e._uid],h&&h[this._uid]&&(delete h[this._uid],0==Object.keys(h).length&&delete a[e._uid]);0==Object.keys(h).length&&delete a[t._uid]}}}_ensureCollide(t){if(!1!==this._hasOverlap[t._uid]){this._hasOverlap[t._uid]=!1;for(let e of this)if(e._hasOverlap[t._uid]=!1,t._hasOverlap[e._uid]=!1,this._uid==t._uid)for(let i of t)e._hasOverlap[i._uid]=!1,i._hasOverlap[e._uid]=!1}if(!1!==t._hasOverlap[this._uid]&&(t._hasOverlap[this._uid]=!1,t._isGroup))for(let e of t){e._hasOverlap[this._uid]=!1,this._hasOverlap[e._uid]=!1;for(let t of this)e._hasOverlap[t._uid]=!1,t._hasOverlap[e._uid]=!1}}collide(t,e){return this.collides(t,e)}collides(t,e){return this._validateCollideParams(t,e),this._ensureCollide(t),e&&this._setContactCB(t,e,0,0),1==this._collisions[t._uid]||this._collisions[t._uid]<=-3}colliding(t,e){this._validateCollideParams(t,e),this._ensureCollide(t),e&&this._setContactCB(t,e,0,1);let i=this._collisions[t._uid];return i<=-3?1:i>0?i:0}collided(t,e){return this._validateCollideParams(t,e),this._ensureCollide(t),e&&this._setContactCB(t,e,0,2),this._collisions[t._uid]<=-1}_validateOverlapParams(t,e){if(e&&"function"!=typeof e)throw new T("Group.overlap",1,[e]);if(!t)throw new T("Group.overlap",2);if(!t._isGroup&&!t._isSprite)throw new T("Group.overlap",0,[t])}_ensureOverlap(t){if(!this._hasSensors){for(let t of this)t._hasSensors||t.addDefaultSensors();this._hasSensors=!0}if(!t._hasSensors)if(t._isSprite)t.addDefaultSensors();else{for(let e of t)e._hasSensors||e.addDefaultSensors();t._hasSensors=!0}if(1!=this._hasOverlap[t._uid]){this._removeContactsWith(t),this._hasOverlap[t._uid]=!0;for(let e of this)if(e._hasOverlap[t._uid]=!0,t._hasOverlap[e._uid]=!0,this._uid==t._uid)for(let i of t)e._hasOverlap[i._uid]=!0,i._hasOverlap[e._uid]=!0}if(1!=t._hasOverlap[this._uid]&&(t._removeContactsWith(this),t._hasOverlap[this._uid]=!0,t._isGroup))for(let e of t){e._hasOverlap[this._uid]=!0,this._hasOverlap[e._uid]=!0;for(let t of this)e._hasOverlap[t._uid]=!0,t._hasOverlap[e._uid]=!0}}overlap(t,e){return this.overlaps(t,e)}overlaps(t,e){return this._validateOverlapParams(t,e),this._ensureOverlap(t),e&&this._setContactCB(t,e,1,0),1==this._overlappers[t._uid]||this._overlappers[t._uid]<=-3}overlapping(t,e){this._validateOverlapParams(t,e),this._ensureOverlap(t),e&&this._setContactCB(t,e,1,1);let i=this._overlappers[t._uid];return i<=-3?1:i>0?i:0}overlapped(t,e){return this._validateOverlapParams(t,e),this._ensureOverlap(t),e&&this._setContactCB(t,e,1,2),this._overlappers[t._uid]<=-1}_removeContactsWith(t){for(let e of this)e._removeContactsWith(t)}applyForce(){for(let t of this)t.applyForce(...arguments)}applyForceScaled(){for(let t of this)t.applyForceScaled(...arguments)}attractTo(){for(let t of this)t.attractTo(...arguments)}applyTorque(){for(let t of this)t.applyTorque(...arguments)}move(t,e,i){let s=[];for(let r of this)s.push(r.move(t,e,i));return Promise.all(s)}moveTo(t,i,s){if("number"!=typeof t){let r=t;if(r==e.mouse&&!e.mouse.isActive)return;s=i,i=r.y,t=r.x}let r=this._resetCentroid(),o=[];for(let e of this){let a={x:e.x-r.x+t,y:e.y-r.y+i};o.push(e.moveTo(a.x,a.y,s))}return Promise.all(o)}moveTowards(t,i,s){if("number"!=typeof t){let r=t;if(r==e.mouse&&!e.mouse.isActive)return;s=i,i=r.y,t=r.x}if(void 0!==t||void 0!==i){this._resetCentroid();for(let e of this){void 0===e.distCentroid&&this._resetDistancesFromCentroid();let r={x:e.distCentroid.x+t,y:e.distCentroid.y+i};e.moveTowards(r.x,r.y,s)}}}moveAway(t,i,s){if("number"!=typeof t){let r=t;if(r==e.mouse&&!e.mouse.isActive)return;s=i,i=r.y,t=r.x}if(void 0!==t||void 0!==i){this._resetCentroid();for(let e of this){void 0===e.distCentroid&&this._resetDistancesFromCentroid();let r={x:e.distCentroid.x+t,y:e.distCentroid.y+i};e.moveAway(r.x,r.y,s)}}}repelFrom(){for(let t of this)t.repelFrom(...arguments)}size(){return this.length}toString(){return"g"+this.idNum}cull(t,i,s,r,o){if(void 0===s){o=i,t=i=s=r=t}if(isNaN(t)||isNaN(i)||isNaN(s)||isNaN(r))throw new TypeError("The culling boundary must be defined with numbers");if(o&&"function"!=typeof o)throw new TypeError("The callback to group.cull must be a function");let a=e.camera.x-e.canvas.hw/e.camera.zoom,h=e.camera.y-e.canvas.hh/e.camera.zoom,n=-s+a,l=-t+h,d=e.width+r+a,p=e.height+i+h,u=0;for(let t=0;t<this.length;t++){let e=this[t];"chain"!=e.shape&&((e.x<n||e.y<l||e.x>d||e.y>p)&&(u++,o?o(e,u):e.remove(),e.deleted&&t--))}return u}push(...t){return this.splice(this.length,0,...t),this.length}splice(t,i,...s){this.deleted&&(console.warn("Edited group"+this._uid+" that was deleted. Use `group.deleteAll()` to remove all of a group's sprites without deleting the group itself. Restoring the group to p5play's memory."),e.p5play.groups[this._uid]=this,this.deleted=!1),s=s.filter((t=>t instanceof e.Sprite?!t.deleted||(console.warn("Can't add a deleted sprite to a group, skipping:",t),!1):(console.warn("Only sprites can be added to a group, skipping:",t),!1)));let r=super.splice(t,i,...s);if(i){for(let t of r)if(null!=t){for(let e of this.subgroups){let i=e.indexOf(t);i>=0&&e.splice(i,1)}t.groups=t.groups.filter((t=>t._uid!=this._uid))}let t=this;for(let i in _)for(let s in t[i]){if(0==t[i][s])continue;let r;r=s>=1e3?e.p5play.sprites[s]:e.p5play.groups[s];let o=!1;for(let e of t)if(e[i][r._uid]>0){o=!0;break}o||(t[i][r._uid]=-2,r[i][t._uid]=-2)}}if(s.length>0)for(let t of s){let i;for(let s in this._hasOverlap){let r=this._hasOverlap[s];r&&!t._hasSensors&&t.addDefaultSensors(),i=s>=1e3?e.p5play.sprites[s]:e.p5play.groups[s],i&&!i.deleted&&(r?i._ensureOverlap(t):i._ensureCollide(t))}for(let i in _){let s=_[i];for(let i of s){let s=e.p5play[i],r=s[this._uid];if(!r)continue;let o=s[t._uid]??={};for(let t in r)o[t]=r[t]}}}if(this.parent&&s.length){let t=e.p5play.groups[this.parent],i=s.filter((e=>!t.includes(e)));i.length&&t.splice(t.length,0,...i)}for(let t of s)t.groups.some((t=>t._uid===this._uid))||t.groups.push(this);return r}_splice(t,e,...i){return super.splice(t,e,...i)}pop(){return this.splice(this.length-1,1)[0]}shift(){return this.splice(0,1)[0]}unshift(...t){return this.splice(0,0,...t),this.length}remove(t){if(void 0===t)return this.delete();let e;return"number"==typeof t?(e=t,t<0&&(e+=this.length)):e=this.lastIndexOf(t),e<0||e>=this.length?void 0:this.splice(e,1)[0]}delete(){this.deleteAll(),this._isAllSpritesGroup||(this.deleted=!0)}deleteAll(){for(;this.length>0;)this.at(-1).delete()}_step(){this.__step()}update(){for(let t of this)t.autoUpdate&&t.update();this._autoUpdate&&(this._autoUpdate=null)}draw(){let t=[...this];t.sort(((t,e)=>t._layer-e._layer));for(let i of t)!1===i._visible||e.p5play._inPostDraw&&!i.autoDraw||i.draw();this._autoDraw&&(this._autoDraw=null)}postDraw(){for(let t of this)t.postDraw()}},e.Group.prototype.addAni=e.Group.prototype.addAnimation=e.Sprite.prototype.addAnimation=e.Sprite.prototype.addAni,e.Group.prototype.addAnis=e.Group.prototype.addAnimations=e.Sprite.prototype.addAnimations=e.Sprite.prototype.addAnis,e.Group.prototype.__step=e.Sprite.prototype.__step,e.Group.prototype.___step=e.Sprite.prototype.___step,this.World=class extends planck.World{constructor(){super(new i.Vec2(0,0),!0),this.mod={},this.origin={x:0,y:0},this.contacts=[],this.on("begin-contact",this._beginContact),this.on("end-contact",this._endContact);let t=this;this._gravity={get x(){return t.m_gravity.x},set x(i){if((i=Math.round(i||0))!=t.m_gravity.x){t.mod[0]=!0;for(let t of e.allSprites)t.sleeping=!1;t.m_gravity.x=i}},get y(){return t.m_gravity.y},set y(i){if((i=Math.round(i||0))!=t.m_gravity.y){t.mod[0]=!0;for(let t of e.allSprites)t.sleeping=!1;t.m_gravity.y=i}}},this._timeScale=1,this._updateRate=60,this._syncedToFrameRate=!0,this._lastStepTime=0,this._setTimeStep(),this.velocityIterations=8,this.positionIterations=3,this.velocityThreshold=.19,this.physicsTime=0,this.meterSize=60,this.mouseTracking??=!0,this.mouseSprite=null,this.mouseSprites=[],this.autoStep=!0,this.step=this.physicsUpdate,window.Event&&(this.steppedEvent=new window.Event("p5play_worldStepped"))}get gravity(){return this._gravity}set gravity(t){this._gravity.x=t.x,this._gravity.y=t.y}get timeScale(){return this._timeScale}set timeScale(t){if(t<0||t>2)return console.error("world.timeScale must be between 0 and 2");this._timeScale!=t&&(this._timeScale=t,this._setTimeStep())}get updateRate(){return this._updateRate}set updateRate(t){this._updateRate=t,this._syncedToFrameRate=t==e._targetFrameRate,this._setTimeStep()}_setTimeStep(){this._timeStep=1/this._updateRate*this._timeScale}get velocityThreshold(){return i.Settings.velocityThreshold}set velocityThreshold(t){i.Settings.velocityThreshold=t}physicsUpdate(t,i,s){g=!0,f=this._timeScale;for(let t of e.allSprites)t.prevPos.x=t.x,t.prevPos.y=t.y,t.prevRotation=t.rotation;t??=this._timeStep,super.step(t,i||this.velocityIterations,s||this.positionIterations),this.physicsTime+=t;let r=Object.values(e.p5play.sprites),o=Object.values(e.p5play.groups);for(let t of r)t._step();for(let t of o)t._step();for(let t of r)t.___step();for(let t of o)t.___step();if(e.canvas.dispatchEvent&&e.canvas.dispatchEvent(this.steppedEvent),!this._syncedToFrameRate)for(let t of e.allSprites)t._syncWithPhysicsBody();this.autoStep&&(this.autoStep=null)}extrapolationUpdate(t){t??=this._timeStep;for(let t of e.allSprites)t.prevPos.x=t.x,t.prevPos.y=t.y,t.prevRotation=t.rotation;g=!1,f=t/this._timeStep*this._timeScale;let i=Object.values(e.p5play.sprites),s=Object.values(e.p5play.groups);for(let t of i)t._step();for(let t of s)t._step();this.autoStep&&(this.autoStep=null)}get realTime(){return e.millis()/1e3}getSpritesAt(t,e,s,r=!0){"object"==typeof t&&(r=s??!0,s=e,e=t.y,t=t.x);const o=new i.Vec2(t/this.meterSize,e/this.meterSize),a=new i.AABB;a.lowerBound=new i.Vec2(o.x-.001,o.y-.001),a.upperBound=new i.Vec2(o.x+.001,o.y+.001);let h=[];if(this.queryAABB(a,(t=>(t.getShape().testPoint(t.getBody().getTransform(),o)&&h.push(t),!0))),0==h.length)return[];let n=[];for(let t of h){const e=t.m_body.sprite;e._cameraActiveWhenDrawn==r&&(n.find((t=>t._uid==e._uid))||s&&!s.includes(e)||n.push(e))}return n.sort(((t,e)=>-1*(t._layer-e._layer))),n}getSpriteAt(t,e,i){return this.getSpritesAt(t,e,i)[0]}getMouseSprites(){let t=this.getSpritesAt(e.mouse.x,e.mouse.y);if(e.camera._wasOff){let i=this.getSpritesAt(e.mouse.canvasPos.x,e.mouse.canvasPos.y,e.allSprites,!1);i.length&&(t=[...i,...t])}return t}_beginContact(t){let e=t.m_fixtureA,i=t.m_fixtureB,s="_collisions";e.m_isSensor&&(s="_overlappers"),e=e.m_body.sprite,i=i.m_body.sprite,e[s][i._uid]=0,i[s][e._uid]=0;for(let t of i.groups)(!e[s][t._uid]||e[s][t._uid]<0)&&(e[s][t._uid]=0,t[s][e._uid]=0);for(let t of e.groups){(!i[s][t._uid]||i[s][t._uid]<0)&&(i[s][t._uid]=0,t[s][i._uid]=0);for(let e of i.groups)(!t[s][e._uid]||t[s][e._uid]<0)&&(t[s][e._uid]=0,e[s][t._uid]=0)}}_endContact(t){let e=t.m_fixtureA,i=t.m_fixtureB,s="_collisions";e.m_isSensor&&(s="_overlappers"),e=e.m_body.sprite,i=i.m_body.sprite,e[s][i._uid]=0!=e[s][i._uid]?-2:-4,i[s][e._uid]=0!=i[s][e._uid]?-2:-4;for(let t of i.groups){let i=!1;for(let r of t)if(r[s][e._uid]>=0){i=!0;break}i||(t[s][e._uid]=0!=t[s][e._uid]?-2:-4,e[s][t._uid]=0!=e[s][t._uid]?-2:-4)}for(let t of e.groups){let e=!1;for(let r of t)if(r[s][i._uid]>=0){e=!0;break}if(!e){t[s][i._uid]=0!=t[s][i._uid]?-2:-4,i[s][t._uid]=0!=i[s][t._uid]?-2:-4;for(let e of i.groups)t[s][e._uid]=0!=t[s][e._uid]?-2:-4,e[s][t._uid]=0!=e[s][t._uid]?-2:-4}}}_findContact(t,e,i){let s=e[t][i._uid];if(s)return s;for(let r of i.groups)if(s=e[t][r._uid],s)return s;for(let r of e.groups){if(s=r[t][i._uid],s)return s;for(let e of i.groups)if(r._uid==e._uid&&(s=r[t][e._uid],s))return s}return!1}get allowSleeping(){return this.getAllowSleeping()}set allowSleeping(t){this.setAllowSleeping(t)}rayCast(t,e,i){return this.rayCastAll(t,e,i,(()=>!0))[0]}rayCastAll(t,i,s,r){let o,a=e.allSprites.tileSize,n=h(t.x,t.y,a);if("number"==typeof arguments[1])o=h(t.x+s*e.cos(i),t.y+s*e.sin(i),a);else{let t=arguments[1];r??=arguments[2],o=h(t.x,t.y,a)}let l=[],d=1;super.rayCast(n,o,(function(t,e,i,s){let o=t.getBody().sprite,a=r&&r(o);return l.push({sprite:o,fraction:s}),a?(s<d&&(d=s),s):1})),l.sort(((t,e)=>t.fraction-e.fraction));let p=[];for(let t of l)t.fraction<=d&&p.push(t.sprite);return p}},this.Camera=class{constructor(){this._pos=e.createVector.call(e),this.__pos={x:0,y:0,rounded:{}},this.isActive=!1,this.bound={min:{x:0,y:0},max:{x:0,y:0}},this._zoomIdx=-1,this._zoom=1,this._destIdx=0}get pos(){return this._pos}set pos(t){this.x=t.x,this.y=t.y}get position(){return this._pos}set position(t){this.x=t.x,this.y=t.y}_calcBoundsX(t){let i=e.canvas.hw/this._zoom;this.bound.min.x=t-i,this.bound.max.x=t+i}_calcBoundsY(t){let i=e.canvas.hh/this._zoom;this.bound.min.y=t-i,this.bound.max.y=t+i}get x(){return this._pos.x}set x(t){if(void 0===t||isNaN(t))return;this._pos.x=t;let i=-t;e._c2d&&(i+=e.canvas.hw/this._zoom),this.__pos.x=i,e.allSprites.pixelPerfect&&(this.__pos.rounded.x=Math.round(i)),this._calcBoundsX(t)}get y(){return this._pos.y}set y(t){if(void 0===t||isNaN(t))return;this._pos.y=t;let i=-t;e._c2d&&(i+=e.canvas.hh/this._zoom),this.__pos.y=i,e.allSprites.pixelPerfect&&(this.__pos.rounded.y=Math.round(i)),this._calcBoundsY(t)}moveTo(t,i,s){if(void 0===t)return;if(isNaN(t)&&(s=i,i=t.y,t=t.x),s??=1,s<=0)return console.warn("camera.moveTo: speed should be a positive number"),Promise.resolve(!1);let r=i-this.y,o=t-this.x,a=Math.sqrt(r*r+o*o),h=s/a,n=o*h,l=r*h;this._destIdx++;let d=this._destIdx,p=Math.ceil(a/s);return(async()=>{for(let t=0;t<p;t++)if(this.x+=n,this.y+=l,await e.sleep(),d!=this._destIdx)return!1;return this.x=t,this.y=i,!0})()}get zoom(){return this._zoom}set zoom(t){if(void 0===t||isNaN(t))return;this._zoom=t;let i=-this._pos.x;e._c2d&&(i+=e.canvas.hw/t);let s=-this._pos.y;e._c2d&&(s+=e.canvas.hh/t),this.__pos.x=i,this.__pos.y=s,e.allSprites.pixelPerfect&&(this.__pos.rounded.x=Math.round(i),this.__pos.rounded.y=Math.round(s)),this._calcBoundsX(this._pos.x),this._calcBoundsY(this._pos.y)}zoomTo(t,i){if(t==this._zoom)return Promise.resolve(!0);i??=.1;let s=Math.abs(t-this._zoom),r=Math.round(s/i);t<this.zoom&&(i=-i),this._zoomIdx++;let o=this._zoomIdx;return(async()=>{for(let t=0;t<r;t++){if(o!=this._zoomIdx)return!1;this.zoom+=i,await e.sleep()}return this.zoom=t,!0})()}on(){this.isActive||(e.push(),e.scale(this._zoom),e.allSprites.pixelPerfect?(this.__pos.rounded.x??=Math.round(this.__pos.x),this.__pos.rounded.y??=Math.round(this.__pos.y),e.translate(this.__pos.rounded.x,this.__pos.rounded.y)):e.translate(this.__pos.x,this.__pos.y),this.isActive=!0)}off(){this.isActive&&(e.pop(),this.isActive=!1)}},i.Fixture.prototype.shouldCollide=function(t){let e=this,i=t;return!(!e.m_isSensor||!i.m_isSensor)||!e.m_isSensor&&!i.m_isSensor&&(e=e.m_body.sprite,i=i.m_body.sprite,!(e._hasOverlap[i._uid]??i._hasOverlap[e._uid]))},this.Tiles=class{constructor(t,i,s,r,o){"string"==typeof t&&("\n"==t[0]&&(t=t.slice(1)),t=(t=t.replaceAll("\t","  ")).split("\n")),i??=0,s??=0,r??=1,o??=1;let a=new e.Group;for(let h=0;h<t.length;h++)for(let n=0;n<t[h].length;n++){let l,d,p=t[h][n];if(" "==p||"."==p)continue;let u=Object.values(e.p5play.groups);for(d of u)if(l=d.animations[p],l)break;if(l){a.push(new d.Sprite(l,i+n*r,s+h*o));continue}let c,_=!1;for(d of u)if(d.tile==p){_=!0;break}if(_)a.push(new d.Sprite(i+n*r,s+h*o));else{for(c of e.allSprites)if(c.tile==p){_=!0;break}if(!_)throw"Tile not found: "+p;c.x=i+n*r,c.y=s+h*o}}return a}},this.createTiles=function(t,i,s,r,o){return new e.Tiles(t,i,s,r,o)},this.Joint=class{constructor(t,s,r){if(!t?._isSprite||!s?._isSprite)throw new Error("The Joint constructor requires two sprites as input.");if(t.body||t.addDefaultSensors(),s.body||s.addDefaultSensors(),this.spriteA=t,this.spriteB=s,r??="glue",this.type=r,"glue"==r){let e=i.WeldJoint({},t.body,s.body,t.body.getWorldCenter());this._createJoint(e)}let o=this;if("glue"!=r&&"slider"!=r&&"rope"!=r)for(let t of["A","B"]){if("A"==t&&"wheel"==r)continue;const s="_offset"+t;this[s]=e.createVector.call(e);for(let r of["x","y"])Object.defineProperty(this[s],r,{get(){let i=o._j["m_localAnchor"+t][r]/o["sprite"+t].tileSize*e.world.meterSize;return e.p5play.friendlyRounding?u(i):i},set(s){if(o._j["m_localAnchor"+t][r]=s/e.world.meterSize*o["sprite"+t].tileSize,"distance"==o.type||"rope"==o.type)o._j.m_length=i.Vec2.distance(o._j.m_bodyA.getWorldPoint(o._j.m_localAnchorA),o._j.m_bodyB.getWorldPoint(o._j.m_localAnchorB));else if("hinge"==o.type||"wheel"==o.type){let e;e="A"==t?"B":"A",o._j["m_localAnchor"+e][r]=o._j["m_body"+e].getLocalPoint(o._j["m_body"+t].getWorldPoint(o._j["m_localAnchor"+t]))[r]}}})}let a=[];"distance"!=r&&"glue"!=r&&"rope"!=r||a.push("enableMotor","maxPower","motorSpeed","power","speed"),"rope"==r&&a.push("damping","springiness");let h={};for(let t of a)h[t]={value:null,enumerable:!1};Object.defineProperties(this,h),this.visible=!0,this.deleted=!1,this.remove=this.delete,t.joints.push(this),s.joints.push(this)}_createJoint(t){this._j=e.world.createJoint(t)}_display(){this._draw(this.spriteA.x,this.spriteA.y,this.spriteB.x,this.spriteB.y),this.visible=null}_draw(t,i,s,r){r?e.line(t,i,s,r):e.point(t,i)}get draw(){return this._display}set draw(t){this._draw=t}get offsetA(){return this._offsetA}set offsetA(t){this._offsetA.x=t.x,this._offsetA.y=t.y}get offsetB(){return this._offsetB}set offsetB(t){this._offsetB.x=t.x,this._offsetB.y=t.y}get springiness(){return this._springiness}set springiness(t){if(t>0&&(t=t<.1?e.map(t,0,.1,30,4):t<.5?e.map(t,.1,.5,4,2.5):t<.8?e.map(t,.5,.8,2.5,1):t<.9?e.map(t,.8,.9,1,.5):e.map(t,.9,1,.5,.2)),this._springiness=t,"wheel"!=this.type)return this._j.setFrequency(t);this._j.setSpringFrequencyHz(t)}get damping(){return"wheel"!=this.type?this._j.getDampingRatio():this._j.getSpringDampingRatio()}set damping(t){"wheel"==this.type?this._j.setSpringDampingRatio(t):this._j.setDampingRatio(t)}get speed(){return this._j.getJointSpeed()}set speed(t){this._j.isMotorEnabled()||this._j.enableMotor(!0),this._j.setMotorSpeed(t)}get motorSpeed(){return this._j.getMotorSpeed()}get enableMotor(){return this._j.isMotorEnabled()}set enableMotor(t){this._j.enableMotor(t)}get maxPower(){return this._j.getMaxMotorTorque()}set maxPower(t){!this._j.isMotorEnabled()&&t&&this._j.enableMotor(!0),this._j.setMaxMotorTorque(t),t||this._j.enableMotor(!1)}get power(){return this._j.getMotorTorque()}get collideConnected(){return this._j.getCollideConnected()}set collideConnected(t){this._j.m_collideConnected=t}get reactionForce(){return this._j.getReactionForce(e.world._timeStep)}get reactionTorque(){return this._j.getReactionTorque(e.world._timeStep)}delete(){this.deleted||(this.spriteA.joints.splice(this.spriteA.joints.indexOf(this),1),this.spriteB.joints.splice(this.spriteB.joints.indexOf(this),1),e.world.destroyJoint(this._j),this.deleted=!0)}},this.GlueJoint=class extends e.Joint{constructor(t,e){super(...arguments,"glue")}},this.DistanceJoint=class extends e.Joint{constructor(t,e){super(...arguments,"distance");let s=i.DistanceJoint({},t.body,e.body,t.body.getWorldCenter(),e.body.getWorldCenter());this._createJoint(s)}_display(){let t,e;(this.offsetA.x||this.offsetA.y)&&(t=this.spriteA.body.getWorldPoint(this._j.m_localAnchorA),t=n(t.x,t.y,this.spriteA.tileSize)),(this.offsetB.x||this.offsetB.y)&&(e=this.spriteB.body.getWorldPoint(this._j.m_localAnchorB),e=n(e.x,e.y,this.spriteB.tileSize)),this._draw(t?t.x:this.spriteA.x,t?t.y:this.spriteA.y,e?e.x:this.spriteB.x,e?e.y:this.spriteB.y),this.visible=null}},this.WheelJoint=class extends e.Joint{constructor(t,s){super(...arguments,"wheel");let r=i.WheelJoint({maxMotorTorque:1e3,frequencyHz:4,dampingRatio:.7},t.body,s.body,s.body.getWorldCenter(),new i.Vec2(0,1));this._createJoint(r),this._angle=e._angleMode==a?90:1.5707963267948966}_display(){let t,i,s=this.spriteA.x,r=this.spriteA.y;if(this.offsetB.x||this.offsetB.y){let e=this.spriteB.body.getWorldPoint(this._j.m_localAnchorB);e=n(e.x,e.y,this.spriteB.tileSize),t=e.x,i=e.y}else t=this.spriteB.x,i=this.spriteB.y;let o=e.tan(this.spriteA.rotation),a=e.tan(this._angle+this.spriteA.rotation),h=(i-r+o*s-a*t)/(o-a),l=o*(h-s)+r;this._draw(h,l,t,i),this.visible=null}get angle(){return this._angle}set angle(t){t!=this._angle&&(this._angle=t,this._j.m_localXAxisA=new i.Vec2(e.cos(t),e.sin(t)),this._j.m_localXAxisA.normalize(),this._j.m_localYAxisA=i.Vec2.crossNumVec2(1,this._j.m_localXAxisA))}},this.HingeJoint=class extends e.Joint{constructor(t,e){super(...arguments,"hinge");let s=i.RevoluteJoint({},t.body,e.body,t.body.getWorldCenter());this._createJoint(s)}_display(){const t=this.offsetA.x,i=this.offsetA.y,s=this.spriteA.rotation,r=t*e.cos(s)-i*e.sin(s),o=t*e.sin(s)+i*e.cos(s);this._draw(this.spriteA.x+r,this.spriteA.y+o),this.visible=null}get range(){return this.upperLimit-this.lowerLimit}set range(t){t/=2,this.upperLimit=t,this.lowerLimit=-t}get lowerLimit(){let t=this._j.getLowerLimit();return"radians"==e._angleMode?t:e.degrees(t)}set lowerLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),this.spriteA.body.setAwake(!0),this.spriteB.body.setAwake(!0),e._angleMode==a&&(t=e.radians(t)),this._j.m_lowerAngle=t}get upperLimit(){let t=this._j.getUpperLimit();return"radians"==e._angleMode?t:e.degrees(t)}set upperLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),this.spriteA.body.setAwake(!0),this.spriteB.body.setAwake(!0),e._angleMode==a&&(t=e.radians(t)),this._j.m_upperAngle=t}get angle(){let t=this._j.getJointAngle();return"radians"==e._angleMode?t:e.radians(t)}},e.RevoluteJoint=e.HingeJoint,this.SliderJoint=class extends e.Joint{constructor(t,e){super(...arguments,"slider");let s=i.PrismaticJoint({lowerTranslation:-1,upperTranslation:1,enableLimit:!0,maxMotorForce:50,motorSpeed:0,enableMotor:!0},t.body,e.body,t.body.getWorldCenter(),new i.Vec2(1,0));this._createJoint(s),this._angle=0}get angle(){return this._angle}set angle(t){t!=this._angle&&(this._angle=t,this._j.m_localXAxisA=new i.Vec2(e.cos(t),e.sin(t)),this._j.m_localXAxisA.normalize(),this._j.m_localYAxisA=i.Vec2.crossNumVec2(1,this._j.m_localXAxisA))}get range(){return this.upperLimit-this.lowerLimit}set range(t){t/=2,this.upperLimit=t,this.lowerLimit=-t}get lowerLimit(){return this._j.getLowerLimit()/this.spriteA.tileSize*e.world.meterSize}set lowerLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),t=t*this.spriteA.tileSize/e.world.meterSize,this._j.setLimits(t,this._j.getUpperLimit())}get upperLimit(){return this._j.getUpperLimit()/this.spriteA.tileSize*e.world.meterSize}set upperLimit(t){this._j.isLimitEnabled()||this._j.enableLimit(!0),t=t*this.spriteA.tileSize/e.world.meterSize,this._j.setLimits(this._j.getLowerLimit(),t)}},e.PrismaticJoint=e.SliderJoint,this.RopeJoint=class extends e.Joint{constructor(t,e){super(...arguments,"rope");let s=i.RopeJoint({maxLength:1},t.body,e.body,t.body.getWorldCenter());this._createJoint(s),this._j.m_localAnchorB.x=0,this._j.m_localAnchorB.y=0}get maxLength(){return t=this._j.getMaxLength(),i=this.spriteA.tileSize,t/i*e.world.meterSize;var t,i}set maxLength(t){var i,s;this._j.setMaxLength((i=t,s=this.spriteA.tileSize,i*s/e.world.meterSize))}},this.GrabberJoint=class extends this.Joint{constructor(t){super(t,t,"grab"),this._target={x:0,y:0},this.__target=new i.Vec2(0,0);let e=i.MouseJoint({maxForce:1e3,frequencyHz:3,dampingRatio:.9,target:t.body.getPosition()},t.body,t.body);this._createJoint(e)}_draw(){e.line(this.spriteA.x,this.spriteA.y,this._target.x,this._target.y)}get target(){return this._target}set target(t){this._target.x=t.x,this._target.y=t.y,this.__target.x=t.x/e.world.meterSize,this.__target.y=t.y/e.world.meterSize,this._j.setTarget(this.__target)}get maxForce(){return this._j.getMaxForce()}set maxForce(t){this._j.setMaxForce(t)}};class m{constructor(){let t=this;Object.defineProperties(this,{x:{get:()=>t._x,set(e){e!=t._x&&(t._x=e,t._avg=.5*(t._x+t._y))},configurable:!0,enumerable:!0},y:{get:()=>t._y,set(e){e!=t._y&&(t._y=e,t._avg=.5*(t._x+t._y))},configurable:!0,enumerable:!0},_x:{value:1,enumerable:!1,writable:!0},_y:{value:1,enumerable:!1,writable:!0},_avg:{value:1,enumerable:!1,writable:!0}})}valueOf(){return this._avg}}function w(t){return!/^(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*(?:(?:(?:async\s(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*)?function|class)(?:\s|(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*)|(?:[_$\w][\w0-9_$]*\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\()|(?:\[\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*(?:(?:['][^']+['])|(?:["][^"]+["]))\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\]\())/.test(t.toString())}function x(t,e){let i=t,s=e.toLowerCase();if("triangle"==s?i=[i,-120,3]:"square"==s?i=[i,-90,4]:"pentagon"==s?i=[i,-72,5]:"hexagon"==s?i=[i,-60,6]:"septagon"==s?i=[i,-51.4285714286,7]:"octagon"==s?i=[i,-45,8]:"enneagon"==s?i=[i,-40,9]:"decagon"==s?i=[i,-36,10]:"hendecagon"==s?i=[i,-32.7272727273,11]:"dodecagon"==s&&(i=[i,-30,12]),i==t)throw new Error("Invalid, not a regular polygon: "+e);return i}if(e.p5play.palettes=[{a:"aqua",b:"black",c:"crimson",d:"darkviolet",e:"peachpuff",f:"olive",g:"green",h:"hotpink",i:"indigo",j:"navy",k:"khaki",l:"lime",m:"magenta",n:"brown",o:"orange",p:"pink",q:"turquoise",r:"red",s:"skyblue",t:"tan",u:"blue",v:"violet",w:"white",x:"gold",y:"yellow",z:"gray"}],this.colorPal=(t,i)=>{if(t instanceof p5.Color)return t;"number"==typeof i&&(i=e.p5play.palettes[i]),i??=e.p5play.palettes[0];let s=i[t];return s?e.color(s):e.color(0,0,0,0)},this.EmojiImage=function(t,i){let s=1.25*(i*=e.p5play.emojiScale),r=e.createGraphics(s,s,e.P2D);r.textSize(i),r.textAlign(e.CENTER),r.textFont(e.canvas.webgpu?e._g.textFont():e.textFont()),r.text(t,s/2,i);let o=r.drawingContext,a=r._pixelDensity||1,h=r.canvas.width,n=r.canvas.height,l=o.getImageData(0,0,h,n).data,d=h,p=0,u=n,c=0,_=3;for(let t=0;t<n;t++)for(let e=0;e<h;e++)0!==l[_]&&(e<d&&(d=e),e>p&&(p=e),t<u&&(u=t),t>c&&(c=t)),_+=4;return u=Math.floor(u/a),c=Math.floor(c/a),d=Math.floor(d/a),p=Math.floor(p/a),r=r.get(d,u,p-d+1,c-u+1),r.src=t,r},this.spriteArt=(t,i,s)=>{i??=1,"number"==typeof s&&(s=e.p5play.palettes[s]),s??=e.p5play.palettes[0];let r=t;"string"==typeof t&&(r=(t=(t=(t=t.trim()).replace(/\r*\n\t+/g,"\n")).replace(/\s+$/g,"")).split("\n"));let o=0;for(let t of r)t.length>o&&(o=t.length);let a=r.length,h=e.createImage(o*i,a*i);h.loadPixels();for(let t=0;t<r.length;t++)for(let e=0;e<r[t].length;e++)for(let o=0;o<i;o++)for(let a=0;a<i;a++){let n=this.colorPal(r[t][e],s);h.set(e*i+o,t*i+a,n)}return h.updatePixels(),h.w=h.width,h.h=h.height,e.p5play.onImageLoad(h),h},this.createSprite=function(){return new e.Sprite(...arguments)},this.createGroup=function(){return new e.Group(...arguments)},this.loadAnimation=this.loadAni=function(){return new e.Ani(...arguments)},this.parseTextureAtlas=function(t){let e=(t.DOM||(t instanceof Document?t:(new DOMParser).parseFromString(t.text||t,"text/xml"))).querySelectorAll("SubTexture"),i={};for(let t of e){i[t.getAttribute("name").replace(/\.[^/.]+$/,"")]={x:Number(t.getAttribute("x")),y:Number(t.getAttribute("y")),width:Number(t.getAttribute("width")),height:Number(t.getAttribute("height"))}}return i},this.animation=function(t,i=0,s=0,r,o){let a=e._getImageMode?e._getImageMode():e.imageMode();e.imageMode("center"),t.draw(i,s,r,o),e.imageMode(a)},this.delay=t=>new Promise(t?e=>{setTimeout(e,t)}:requestAnimationFrame),this.sleep=t=>t?e.delay(t):new Promise((t=>{if(e.canvas.dispatchEvent){e.canvas.addEventListener("p5play_worldStepped",(function i(){e.canvas.removeEventListener("p5play_worldStepped",i),t()}))}else setTimeout(t,1e3*e.world._timeStep)})),this.play=t=>{if(!t?.play)throw new Error("Tried to play your sound but it wasn't a sound object.");return new Promise((e=>{t.play(),t.onended((()=>e()))}))},window.location){let t=location.hostname;switch(t){case"":case"127.0.0.1":case"localhost":case"p5play.org":case"editor.p5js.org":case"codepen.io":case"codera.app":case"aug4th.com":case"cdpn.io":case"glitch.com":case"replit.com":case"stackblitz.com":case"jsfiddle.net":case"aijs.io":case"preview-aijs.web.app":case"quintos-org.github.io":break;default:if(/^[\d\.]+$/.test(t)||t.endsWith(".lan")||t.endsWith("stackblitz.io")||t.endsWith("glitch.me")||t.endsWith("replit.dev")||t.endsWith("codehs.com")||t.endsWith("openprocessing.org")||location.origin.endsWith("preview.p5js.org"))break;!async function(){if(document.getElementById("made-with-p5play"))return;o||e._incrementPreload();let t=document.createElement("div");t.id="made-with-p5play",t.style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 1000; background-color: black;";let i=document.createElement("img");i.style="position: absolute; top: 50%; left: 50%; width: 80vmin; height: 40vmin; margin-left: -40vmin; margin-top: -20vmin; z-index: 1001; opacity: 1; scale: 1; transition: scale 1.5s, opacity 0.4s ease-in-out;",i.onerror=()=>{i.style.imageRendering="pixelated",i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAABbGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAACiRfZC/S0JhGIWfm4VgNkQNDg13igYr0SCXBjWQIkisQG26Xn+C2sfVCKMtWkPoP8igOWgoIgxaGhqCqCGitqamgpaSL+69hS51lvfhcDgcXujxaEKUeoFypWbEo2E1kUypzhcUFCxpelWEYrEFk39vlxT4uLezt+Nm12u7uRvciV6Wj88XNx88k/wvVyZb1YEvwKcLowaKF4ht1ITJW8CwkUimQGmYnLf5wOS0zSdWZjkeAeUaUPWClgHlFfCmu/x8F5dL6/rPMnO9O1tZWTJ7gBFmKVJFUEKjjkqMwB/5KSsfYQ1BHYMieQrUUAkhrIYsKnNU0JnAi4ofH3785p/tuo+7n/95O972M8y0pJRnHW++BUfT4DrteGNBGOyHq1OhGZplOYCeXA7eDmEgCUM34Fqt5gJ+e707DH1PUr6PgnMP2g0pP/elbDfB8QgXlW8Y/mq9pjC8gwAABSxJREFUeJztnb9y2zAMxulcpnbNntfJ3D5n97xO966Z3aNP9NHgBxAgQVmO8bvLNZZIiCI+gH8kpyl4bk7P3gErOJ/PZ0+zp9NpmZ9CAM54O7+wSgQhAEdWOb+wQgSvzZHAj5+/50x9/WkOeRMZwIkm+medXyAi8M4CL82R4KkIATjQRL8nJJN4XysEsAKv9L8DIYAnJyaBk8CUTDLA51/bbP7jHWSQRZPByADeTDp/tM4ozT4AVHSwO1kEMBMY/dTLFNcMcN5oSgTHYHBi2fPrS4qo98Mh/a+C8/ErdyJYw8cbb/bzH/ncGQY8aOYAnpThZ4XGerZdrn209fxIe6rVQw52Oif4NquAfF+d+Y6NSeej9C9F/714WAHkyP5uoxcSCBKSic5WMhwCciTlcnUaRSmVRlw5x0UiVx6VqW1Ru1zbaHl6TXS9Efae3GmuNzpXYDMA7VT6OxKE9nhPKNy1ZlHbEdL/qPNRdHsy2i5WAIk41yt6emM1Jw5OcL12eg4VR1rWmRCGAVEAGjhncseLQ7SOebZV6t4TxWEBcFHHOayO7PoHUcpy/y5FSP+jWJ06KoKRDAUngZxDUXrVlOsdR0jX8vjsxaqI1dilG0ciWdjgHcN4GqgERdcR1/VayjwgBFDzQG/yJEaASKgSIYBnAgg8BKAARRWKvkcjDwMhgAKIjkcACREJlgOuAu5K7Qgwaz0KeQaOOn9vTCsBwLwApMiZdOBROpnj3u2bdX5aPQfwaOBuDIr1HveYryldl30wBO4RZ4AS1aXCbFr2skezTa5b2+7Z7Z2nNjZKh3Jja3HGHtlAcnwyOj+/HIIFUACd0TizbhzTQU1ddAzYg+WYY5d0TM5dXql6A2VzO7n0jUS6kTtXuseVQ4Im01icXxgfApgOuvy8pevPjD3VuRrhRpu29trG2GI7eWPFkKCJerZdzH2UV8NUAsiqR8pnG5YdJjjNZA+8aYvqIq6dQqNfC9N5YofvDNuO3HbQ/tNG+dwVQOmwS8QAg/kY26lABF17Aqq65DgSlSkzMR2ZpM53hmsve32mvehLIvIcoFyIaUB9vhZB3bBmbJ6cLJkfrb4PRj+FmSAeCsbxiXF+0mSAG5WhDtjSfT32S3TtUb6wsMS6Qkd4TtKQoI62b0FTPkW3EQQ6G908KgcB5aA9BKir4WFf59q4ZNneF0eYZ/4SUxtB4lg88rVoLnqEa7CAOqz9J0Y9Caw/N44FnX0zYQPHRXsI4RqQ0Zk/B1iNUB5RYKohgN4svNG8GiApCpbr2QN2uHN08nmBGSK4ttyLkd1D1TBgxGUV4F1OOk/PSWUTENsRqJ3ovo1M5gHo+4A13/YPRd4sS2c7V/m1795WMJvZlNvIUv1RTtzXw2mqncXbnsSSqCJwIuCua3GetX4zBBj+ntDlBCeCYGNg2Vo7UXIeR6nv9fSPE0EIoAdwfs095xis85NeAC/SyWDSCQLXJ6cT9T2Ajo+MQOhkgWTMBMh55iecPSxDQHBLEwCG7WfJkd13CYS6mvpXrJPAoKURQdILATnSkrKbjTJLugc7piGAQWZEkDS7dMIj5utWulQf2SNIzk8hgD6zIoBQRy36n0U0k/sQgAIogjT/Z9saHO1pV3YhACUuImCcNWRPsGVZ1ocAjEAh9JwmOAsyaG9kPycEMAAUQWIcp3CWt71gB84SP34JJ7Gzm0I1A/a0hGomsTigF6VWZ3pEfQjAAY3jLM7yticRAnAEOW7GUd72ECEAZ2qneTjL294NKaX/gKttC9Kft4MAAAAASUVORK5CYII="};let s=window._p5play_intro_image;""==s||s?.includes("made_with_p5play")?((s.includes("bit.")||s.includes("pixel"))&&(i.style.imageRendering="pixelated"),i.src=s):i.src="https://p5play.org/assets/made_with_p5play.webp",await new Promise((t=>i.onload=t)),t.append(i),document.body.append(t),await e.delay(),i.offsetHeight,i.style.scale=1.2,await e.delay(1100),i.style.opacity=0,await e.delay(400),t.style.display="none",t.remove(),document.getElementById("made-with-p5play")?.remove(),o||e._decrementPreload()}()}}const v=e.createCanvas;this.createCanvas=function(){let t,i,r,o=[...arguments];if("string"==typeof o[0])if(o[0].includes(":")){let e=o[0].split(":"),i=Number(e[0]),s=Number(e[1]),r=window.innerWidth,a=window.innerWidth*(s/i);a>window.innerHeight&&(r=window.innerHeight*(i/s),a=window.innerHeight),o[0]=Math.round(r),o.splice(1,0,Math.round(a)),t="maxed"}else o=[0,0,...o];if(o[0]||(o[0]=window.innerWidth,o[1]=window.innerHeight,t="maxed"),"string"==typeof o[2]){let e=o[2].toLowerCase().split(" ");"pixelated"==e[0]?(i="pixelated",e[1]?(t="centered",r=Number(e[1].slice(1))):t="maxed",o.splice(2,1)):"fullscreen"!=e[0]&&"maxed"!=e[0]||(t="maxed",o.splice(2,1))}let a=v.call(e,...o);e.ctx=e.drawingContext;let h=a.canvas||a;window.canvas=h,a.GL?(h.renderer="webgl",e._webgl=!0):e._webgpu||(e._c2d=!0),h.tabIndex=0,h.w=o[0],h.h=o[1],h.addEventListener&&(h.addEventListener("keydown",(function(t){" "!=t.key&&"/"!=t.key&&"ArrowUp"!=t.key&&"ArrowDown"!=t.key&&"ArrowLeft"!=t.key&&"ArrowRight"!=t.key||t.preventDefault()})),h.addEventListener("mouseover",(()=>{this.mouse.isOnCanvas=!0,this.mouse.isActive=!0})),h.addEventListener("mouseleave",(()=>{this.mouse.isOnCanvas=!1})),h.addEventListener("touchstart",(t=>t.preventDefault())),h.addEventListener("contextmenu",(t=>t.preventDefault()))),h.save??=e.saveCanvas.bind(e),h.resize??=e.resizeCanvas.bind(e),h.hw=.5*h.w,h.hh=.5*h.h,h.mouse={x:e.mouseX,y:e.mouseY},e._c2d?(e.camera.x=e.camera.ogX=h.hw,e.camera.y=e.camera.ogY=h.hh):(e.camera.x=0,e.camera.y=0,e._webgpu&&(e.p5play._renderStats={x:10-h.hw,y:20-h.hh})),p5.disableFriendlyErrors=s,e.displayMode(t,i,r);let n=window.PointerEvent?"pointer":"mouse";return h.addEventListener(n+"down",j),window&&(window.addEventListener(n+"move",P),window.addEventListener(n+"up",O)),a},this.Canvas=class{constructor(t,e,i){this.w,this.width,this.h,this.height,this.hw,this.hh,this.mouse}resize(){}save(){}},e.Canvas=function(){return e.createCanvas(...arguments).canvas};const b=e.resizeCanvas;this.resizeCanvas=(t,i)=>{t??=window.innerWidth,i??=window.innerHeight,b.call(e,t,i);let s=e.canvas;s.w=s.width/e.pixelDensity(),s.h=s.height/e.pixelDensity(),s.hw=.5*s.w,s.hh=.5*s.h,s.maxed&&(s.w/s.h>window.innerWidth/window.innerHeight?(s.style.width="100%!important",s.style.height="auto!important"):(s.style.width="auto!important",s.style.height="100%!important")),e._c2d?(e.camera.x=s.hw,e.camera.y=s.hh):(e.camera.x=0,e.camera.y=0)};const S=e.frameRate;this.frameRate=function(t){let i=S.call(e,t);return t&&e.world._setTimeStep(),i};const A=e.background;this.background=function(){let t=arguments;1==t.length&&1==t[0]?.length?A.call(e,e.colorPal(t[0])):A.call(e,...t)};const C=e.fill;this.fill=function(){let t=arguments;1==t.length&&1==t[0]?.length?C.call(e,e.colorPal(t[0])):C.call(e,...t)};const M=e.stroke;if(this.stroke=function(){let t=arguments;1==t.length&&1==t[0]?.length?M.call(e,e.colorPal(t[0])):M.call(e,...t)},!o){const t=e.loadImage;this.loadImage=this.loadImg=function(){if(e.p5play.disableImages)return e._q5||e._decrementPreload(),{w:16,width:16,h:16,height:16,pixels:[]};let i,s=arguments,r=s[0],o=e.p5play.images[r];if("function"==typeof s[s.length-1]&&(i=s[s.length-1]),o)return o.width<=1&&o.height<=1?i?(o.cbs.push(i),o.calls++):e._q5||e._decrementPreload():(i&&i(),e._q5||e._decrementPreload()),o;return o=t.call(e,r,(t=>{if(t.w||(Object.defineProperty(t,"w",{get:function(){return this.width}}),Object.defineProperty(t,"h",{get:function(){return this.height}})),t.cbs){for(let e of t.cbs)e(t);if(!e._q5)for(let i=1;i<t.calls;i++)e._decrementPreload();t.cbs=[]}e.p5play.onImageLoad(o)})),o.cbs=[],o.calls=1,i&&o.cbs.push(i),o.src=r,e.p5play.images[r]=o,o};const i=e.image;e.image=function(){e.p5play.disableImages||i.call(e,...arguments)}}e.displayMode||"object"!=typeof document||(document.head.insertAdjacentHTML("beforeend","<style>\nhtml, body {\n\tmargin: 0;\n\tpadding: 0;\n}\nbody.hasFrameBorder {\n\tdisplay: block;\n}\n.p5Canvas {\n\toutline: none;\n\t-webkit-touch-callout: none;\n\t-webkit-text-size-adjust: none;\n\t-webkit-user-select: none;\n\toverscroll-behavior: none;\n}\n.p5-pixelated {\n\timage-rendering: pixelated;\n\tfont-smooth: never;\n\t-webkit-font-smoothing: none;\n}\n.p5-centered,\n.p5-maxed {\n  display: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\nmain.p5-centered,\nmain.p5-maxed {\n\theight: 100vh;\n}\nmain {\n\toverscroll-behavior: none;\n}\n</style>"),e._adjustDisplay=t=>{let i=e.canvas,s=i.style;if(s)if("normal"==i.displayMode){if(!t)return;s.width=i.w*i.displayScale+"px",s.height=i.h*i.displayScale+"px"}else{let t=i.parentElement.getBoundingClientRect();i.w/i.h>t.width/t.height?("centered"==i.displayMode?(s.width=i.w*i.displayScale+"px",s.maxWidth="100%"):s.width="100%",s.height="auto",s.maxHeight=""):(s.width="auto",s.maxWidth="","centered"==i.displayMode?(s.height=i.h*i.displayScale+"px",s.maxHeight="100%"):s.height="100%")}},e.MAXED="maxed",e.SMOOTH="smooth",e.PIXELATED="pixelated",e.displayMode=(t="normal",i="smooth",s=1)=>{let r=e.canvas;"string"==typeof s&&(s=parseFloat(s.slice(1))),"fullscreen"==t&&(t="maxed"),"center"==t&&(t="centered"),r.displayMode&&(r.parentElement.classList.remove("p5-"+r.displayMode),r.classList.remove("p5-pixelated")),r.parentElement.classList.add("p5-"+t),"pixelated"==i&&(r.classList.add("p5-pixelated"),e.pixelDensity(1),e.noSmooth&&e.noSmooth(),e.textFont&&e.textFont("monospace")),Object.assign(r,{displayMode:t,renderQuality:i,displayScale:s}),e.ctx&&e.push(),e._adjustDisplay(!0),e.ctx&&e.pop()});let k={generic:["Ah! I found an error","Oh no! Something went wrong","Oof! Something went wrong","Houston, we have a problem","Whoops, having trouble here"],Sprite:{constructor:{base:"Sorry I'm unable to make a new Sprite",0:"What is $0 for? If you're trying to specify the x position of the sprite, please specify the y position as well.",1:"If you're trying to specify points for a chain Sprite, please use an array of position arrays.\n$0",2:"Invalid input parameters: $0"},hw:{0:"I can't change the halfWidth of a Sprite directly, change the sprite's width instead."},hh:{1:"I can't change the halfHeight of a Sprite directly, change the sprite's height instead."},rotate:{0:"Can't use this function on a sprite with a static collider, try changing the sprite's collider type to kinematic.",1:'Can\'t use "$0" for the angle of rotation, it must be a number.'},rotateTo:{},rotateMinTo:{},rotateTowards:{},changeAnimation:'I can\'t find any animation named "$0".',collide:{0:"I can't make that sprite collide with $0. Sprites can only collide with another sprite or a group.",1:"The collision callback has to be a function.",2:"You're trying to check for an collision with a sprite or group that doesn't exist!"},overlap:{0:"I can't make that sprite overlap with $0. Sprites can only overlap with another sprite or a group.",1:"The overlap callback has to be a function.",2:"You're trying to check for an overlap with a sprite or group that doesn't exist!"}},Ani:{constructor:{base:"I tried to make a new Ani but couldn't",1:"The name of the animation must be the first input parameter.",2:"Make sure to set the sprite sheet image before adding animations from it."},frame:"Index $0 out of bounds. That means there is no frame $0 in this animation. It only has $1 frames!"},Group:{constructor:{base:"Hmm awkward! Well it seems I can't make that new Group you wanted"}}};k.Group.collide=k.Sprite.collide,k.Group.overlap=k.Sprite.overlap,k.Sprite.rotateTo[0]=k.Sprite.rotateMinTo[0]=k.Sprite.rotateTowards[0]=k.Sprite.rotate[0];class T extends Error{constructor(t,e,i){super(),"string"!=typeof t&&(i=e,e=t,t=(t=this.stack.match(/\n\s*at ([^\(]*)/)[1]).slice(0,-1)),"number"!=typeof e&&(i=e,e=void 0),"new"==t.slice(0,3)&&(t=t.slice(4));let s=(t=t.split("."))[0];t=t[1]||"constructor";let r=this.stack.match(/\/([^p\/][^5][^\/:]*:[^\/:]+):/);r&&(r=r[1].split(":"),r=" in "+r[0]+" at line "+r[1]),r=" using "+s+"."+t+". ",i=i||[];let o,a=k[s][t];o=a.base?a.base+r:k.generic[Math.floor(Math.random()*k.generic.length)]+r,void 0!==e&&(a=a[e]),a&&(a=a.replace(/\$([0-9]+)/g,((t,e)=>i[e])),o+=a),p5._friendlyError(o,t)}}this.allSprites=new e.Group,this.world=new e.World,this.camera=new e.Camera,this.InputDevice=class{constructor(){this.holdThreshold=12,this._default=0}_ac(t){return t}presses(t){return t??=this._default,void 0===this[t]&&(t=this._ac(t)),1==this[t]||-3==this[t]}pressing(t){return t??=this._default,void 0===this[t]&&(t=this._ac(t)),-3==this[t]?1:this[t]>0?this[t]:0}pressed(t){return this.released(t)}holds(t){return t??=this._default,void 0===this[t]&&(t=this._ac(t)),this[t]==this.holdThreshold}holding(t){return t??=this._default,void 0===this[t]&&(t=this._ac(t)),this[t]>=this.holdThreshold?this[t]:0}held(t){return t??=this._default,void 0===this[t]&&(t=this._ac(t)),-2==this[t]}released(t){return t??=this._default,void 0===this[t]&&(t=this._ac(t)),this[t]<=-1}releases(t){return this.released(t)}},this._Mouse=class extends e.InputDevice{constructor(){super(),this._default="left";let t=this;this._pos=e.createVector.call(e),Object.defineProperty(this._pos,"x",{get:()=>t.x,set(e){t.x=e}}),Object.defineProperty(this._pos,"y",{get:()=>t.y,set(e){t.y=e}}),this.x=0,this.y=0,this.canvasPos={},this.left=0,this.center=0,this.right=0,this.drag={left:0,center:0,right:0},this._dragFrame={left:!1,center:!1,right:!1},this.isOnCanvas=!1,this.isActive=!1,this._visible=!0,this._cursor="default",this._ogX=0,this._ogY=0}_ac(t){return"left"==(t=t.toLowerCase()).slice(0,4)?t="left":"right"==t.slice(0,5)?t="right":"middle"==t.slice(0,6)&&(t="center"),t}_update(){e.mouse.canvasPos.x=e.mouseX,e.mouse.canvasPos.y=e.mouseY,e.camera.x==e.camera.ogX&&e.camera.y==e.camera.ogY&&1==e.camera.zoom?(this.x=e.mouseX,this.y=e.mouseY):e._webgpu?(this.x=e.mouseX/e.camera.zoom+e.camera.x,this.y=e.mouseY/e.camera.zoom+e.camera.y):(this.x=(e.mouseX-e.canvas.hw)/e.camera.zoom+e.camera.x,this.y=(e.mouseY-e.canvas.hh)/e.camera.zoom+e.camera.y)}get pos(){return this._pos}get position(){return this._pos}get cursor(){return e.canvas.style.cursor}set cursor(t){t!=this._cursor&&(e.cursor(t),this._cursor=t)}get visible(){return this._visible}set visible(t){this._visible=t,e.canvas.style.cursor=t?"default":"none"}drags(t){return t??=this._default,1==this.drag[t]}dragging(t){return t??=this._default,this.drag[t]>0?this.drag[t]:0}dragged(t){return t??=this._default,this.drag[t]<=-1}},this.mouse=new e._Mouse,this._SpriteMouse=class extends e._Mouse{constructor(){super(),delete this.canvasPos,this.hover=0}hovers(){return 1==this.hover}hovering(){return this.hover>0?this.hover:0}hovered(){return this.hover<=-1}};let z=0,j=function(t){if(!e._setupDone)return;z++,!e._isQ5&&e.userStartAudio&&e.userStartAudio();let i="left";if(1===t.button?i="center":2===t.button&&(i="right"),e.mouse.isActive=!0,e.mouse[i]++,e.world.mouseSprites.length){let t=e.world.mouseSprite?.mouse;t&&(t[i]=0,t.hover=0,t.drag[i]=0);let s=e.world.mouseSprites[0];e.world.mouseSprite=s,t=s.mouse,t[i]=1,t.hover<=0&&(t.hover=1)}},P=function(t){if(!e._setupDone)return;let i="left";1===t.button?i="center":2===t.button&&(i="right");let s=e.mouse;s[i]>0&&(s._dragFrame[i]=!0)},O=function(t){if(!e._setupDone)return;if(!(z>0))return;z--;let i="left";1===t.button?i="center":2===t.button&&(i="right");let s=e.mouse;s[i]>=s.holdThreshold?s[i]=-2:s[i]>1?s[i]=-1:s[i]=-3,s.drag[i]>0&&(s.drag[i]=-1);let r=e.world.mouseSprite?.mouse;r&&(r.hover>1?(r[i]>=e.mouse.holdThreshold?r[i]=-2:r[i]>1?r[i]=-1:r[i]=-3,r.drag[i]>0&&(r.drag[i]=-1)):(r[i]=0,r.drag[i]=0))};if(this._Touch=class extends e.InputDevice{constructor(t){super(),this.x,this.y,this.id=t.identifier,this._default="duration",this.holdThreshold=e.touches.holdThreshold,this.duration=1,this.drag=0,this._dragFrame=!1,this.canvasPos={},this._update(t)}_update(t){let i=e.canvas;const s=i.getBoundingClientRect(),r=i.scrollWidth/i.w||1,o=i.scrollHeight/i.h||1,a=this.canvasPos.x=(t.clientX-s.left)/r,h=this.canvasPos.y=(t.clientY-s.top)/o;e.camera.x==i.hw&&e.camera.y==i.hh&&1==e.camera.zoom?(this.x=a,this.y=h):(this.x=(a-i.hw)/e.camera.zoom+e.camera.x,this.y=(h-i.hh)/e.camera.zoom+e.camera.y),this.force=t.force}},e.touches=[],e.touches.holdThreshold=12,e._ontouchstart=function(t){if(e._setupDone){e.getAudioContext&&"suspended"==e.getAudioContext()?.state&&e.userStartAudio();for(let i of t.changedTouches)e.touches.push(new e._Touch(i)),1==e.touches.length&&(e.mouseX=e.touches[0].x,e.mouseY=e.touches[0].y,e.mouse._update(),e.world.mouseSprites=e.world.getMouseSprites(),r&&e._onmousedown(t));e.touchStarted&&!e.touchStarted(t)&&t.preventDefault()}},e._ontouchmove=function(t){if(e._setupDone){for(let i of t.changedTouches){let s=e.touches.find((t=>t.id==i.identifier));s._update(i),s._dragFrame=!0,s.id==e.touches[0].id&&(e.mouseX=e.touches[0].x,e.mouseY=e.touches[0].y,e.mouse._update(),r&&e._onmousemove(t))}e.touchMoved&&!e.touchMoved(t)&&t.preventDefault()}},e._ontouchend=function(t){if(e._setupDone){for(let i of t.changedTouches){let s=e.touches.find((t=>t.id==i.identifier));s._update(i),s.duration>=s.holdThreshold?s.duration=-2:s.duration>1?s.duration=-1:s.duration=-3,s.drag>0&&(s.drag=-1),s.id==e.touches[0].id&&(e.mouseX=e.touches[0].x,e.mouseY=e.touches[0].y,e.mouse._update(),r&&e._onmouseup(t))}e.touchEnded&&!e.touchEnded(t)&&t.preventDefault()}},this._Keyboard=class extends e.InputDevice{constructor(){super(),this._default=" ",this.alt=0,this.arrowUp=0,this.arrowDown=0,this.arrowLeft=0,this.arrowRight=0,this.backspace=0,this.capsLock=0,this.control=0,this.enter=0,this.meta=0,this.shift=0,this.tab=0;let t=this._simpleKeyControls={arrowUp:"up",arrowDown:"down",arrowLeft:"left",arrowRight:"right"};t.w=t.W="up",t.s=t.S="down",t.a=t.A="left",t.d=t.D="right",t.i=t.I="up2",t.k=t.K="down2",t.j=t.J="left2",t.l=t.L="right2"}get visible(){return this._inp==document.activeElement}set visible(t){this._inp||(this._inp=Object.assign(document.createElement("input"),{type:"text",style:"position: fixed; height: 0; padding: 0; border: none; opacity: 0.0001; pointer-events: none;"}),document.body.appendChild(this._inp)),this._visible=t,t?this._inp.focus():this._inp.blur()}_ac(t){if(1!=t.length){if(!isNaN(t)){if(38==t)return"arrowUp";if(40==t)return"arrowDown";if(37==t)return"arrowLeft";if(39==t)return"arrowRight";if(t>=10)throw new Error("Use key names with the keyboard input functions, not keyCode numbers!");return t}t=t.replaceAll(/[ _-]/g,"")}if(1!=(t=t.toLowerCase()).length){if("arrowup"==t)return"arrowUp";if("arrowdown"==t)return"arrowDown";if("arrowleft"==t)return"arrowLeft";if("arrowright"==t)return"arrowRight";if("capslock"==t)return"capsLock"}return t}_pre(t){(!this[t]||this[t]<0)&&(this[t]=1)}_rel(t){this[t]>=this.holdThreshold?this[t]=-2:this[t]>1?this[t]=-1:this[t]=-3}get cmd(){return this.meta}get command(){return this.meta}get ctrl(){return this.control}get space(){return this[" "]}get spacebar(){return this[" "]}get opt(){return this.alt}get option(){return this.alt}get win(){return this.meta}get windows(){return this.meta}},this.kb=new e._Keyboard,this.keyboard=e.kb,"object"==typeof navigator&&navigator.keyboard){const t=navigator.keyboard;window==window.top?t.getLayoutMap().then((t=>{"w"!=t.get("KeyW")&&(e.p5play.standardizeKeyboard=!0)})):e.p5play.standardizeKeyboard=!0}else e.p5play.standardizeKeyboard=!0;function D(t){let e=t.code;return 4==e.length&&"Key"==e.slice(0,3)?e[3].toLowerCase():t.key}let F=function(t){let e=t.key;if(this.p5play.standardizeKeyboard&&(e=D(t)),e.length>1)e=e[0].toLowerCase()+e.slice(1);else{let t=e.toLowerCase(),i=e.toUpperCase();t!=i&&(e!=i?this.kb._pre(i):this.kb._pre(t))}this.kb._pre(e);let i=this.kb._simpleKeyControls[e];i&&this.kb._pre(i)},I=function(t){let e=t.key;if(this.p5play.standardizeKeyboard&&(e=D(t)),e.length>1)e=e[0].toLowerCase()+e.slice(1);else{let t=e.toLowerCase(),i=e.toUpperCase();t!=i&&(e!=i?this.kb._rel(i):this.kb._rel(t))}this.kb._rel(e);let i=this.kb._simpleKeyControls[e];if(i&&this.kb._rel(i),t.shiftKey){let t=e.toLowerCase();this.kb[t]>0&&this.kb._rel(t)}};window&&(window.addEventListener("keydown",F.bind(this)),window.addEventListener("keyup",I.bind(this))),this.Contro=class extends e.InputDevice{constructor(t){super(),this._default="a",this.connected=!0,this.a=0,this.b=0,this.x=0,this.y=0,this.l=0,this.r=0,this.lt=0,this.rt=0,this.select=0,this.start=0,this.lsb=0,this.rsb=0,this.up=0,this.down=0,this.left=0,this.right=0,this.leftStick={x:0,y:0},this.rightStick={x:0,y:0},this.leftTrigger=0,this.rightTrigger=0,this.buttonMapping={a:0,b:1,x:2,y:3,l:4,r:5,lt:6,rt:7,select:8,start:9,lsb:10,rsb:11,up:12,down:13,left:14,right:15},this.axeMapping={leftStick:{x:0,y:1},rightStick:{x:2,y:3},leftTrigger:4,rightTrigger:5},this.isMock=!1,"string"!=typeof t?(this.gamepad=t,this.id=t.id):(this.gamepad={},this.id=t,this.isMock=!0),this._axeTriggers=this.gamepad.axes&&void 0!==this.gamepad.axes[this.axeMapping.leftTrigger],this.hasAnalogTriggers=this._axeTriggers||void 0,this.id.includes("GuliKit")&&(this.buttonMapping.a=1,this.buttonMapping.b=0,this.buttonMapping.x=3,this.buttonMapping.y=2)}_ac(t){return"lb"==(t=t.toLowerCase())?t="l":"rb"==t?t="r":"leftstickbutton"==t?t="lsb":"rightstickbutton"==t&&(t="rsb"),t}_update(){if(this.isMock)return;if(this.gamepad=navigator.getGamepads()[this.gamepad.index],!this.gamepad?.connected)return;let t=this.gamepad;for(let e in this.buttonMapping){let i=this.buttonMapping[e],s=t.buttons[i];s&&(s.pressed?this[e]++:this[e]=this[e]>0?-1:0)}return this.leftStick.x=t.axes[this.axeMapping.leftStick.x],this.leftStick.y=t.axes[this.axeMapping.leftStick.y],this.rightStick.x=t.axes[this.axeMapping.rightStick.x],this.rightStick.y=t.axes[this.axeMapping.rightStick.y],this._axeTriggers?(this.leftTrigger=t.axes[this.axeMapping.leftTrigger],this.rightTrigger=t.axes[this.axeMapping.rightTrigger]):(this.leftTrigger=t.buttons[this.buttonMapping.lt].value,this.rightTrigger=t.buttons[this.buttonMapping.rt].value,void 0===this.hasAnalogTriggers&&(this.leftTrigger||this.rightTrigger)&&(this.hasAnalogTriggers=!Number.isInteger(this.leftTrigger)||!Number.isInteger(this.rightTrigger))),!0}_reset(){for(let t in this.buttonMapping)this[t]=0;this.leftStick.x=0,this.leftStick.y=0,this.rightStick.x=0,this.rightStick.y=0,this.leftTrigger=0,this.rightTrigger=0}get cross(){return this.a}get circle(){return this.b}get square(){return this.x}get triangle(){return this.y}get ls(){return this.leftStick}get rs(){return this.rightStick}get lb(){return this.l}get rb(){return this.r}get l1(){return this.l}get r1(){return this.r}get zl(){return this.lt}get zr(){return this.rt}get l2(){return this.leftTrigger}get r2(){return this.rightTrigger}get leftStickButton(){return this.lsb}get rightStickButton(){return this.rsb}get l3(){return this.lsb}get r3(){return this.rsb}},this._Contros=class extends Array{constructor(){if(super(),window&&(window.addEventListener("gamepadconnected",(t=>{this._onConnect(t.gamepad)})),window.addEventListener("gamepaddisconnected",(t=>{this._onDisconnect(t.gamepad)}))),"object"!=typeof navigator||!navigator.getGamepads)return;let t=navigator.getGamepads();for(let e of t)e&&this._onConnect(e)}swap(t,i){let s=this[t];this[t]=this[i],this[i]=s,0!=t&&0!=i||(e.contro=this[0],!e._q5&&e._isGlobal&&(window.contro=this[0]))}remove(t){this[t]=null}onConnect(t){return!0}onDisconnect(t){return!1}_onConnect(t){if(t){for(let e=0;e<this.length;e++)if(t.index==this[e].gamepad?.index)return this[e].connected=!0,void y("contros["+e+"] reconnected: "+t.id);if(y(t),this.onConnect(t)){let i=new e.Contro(t),s=0;for(let t=0;t<=this.length;t++)if(!this[t]){s=t;break}this[s]=i,y("contros["+s+"] connected: "+t.id),0==s&&(e.contro=i,e._isGlobal&&(window.contro=i))}}}_onDisconnect(t){if(t)for(let e=0;e<this.length;e++)if(this[e].gamepad?.index===t.index)return this[e].connected=!1,y("contros["+e+"] disconnected: "+t.id),void(this.onDisconnect(t)?this.remove(e):this[e]._reset())}_update(){for(let t of this)t.connected&&t._update()}},this.contros=new e._Contros,this.controllers=e.contros,this.contro=new e.Contro("mock0"),this.getFPS??=()=>e.p5play._fps,e.renderStats=()=>{let t=e.p5play._renderStats;if(t.fontSize||(1==e.allSprites.tileSize||e.allSprites.tileSize>16?t.fontSize=16:t.fontSize=10,t.gap=1.25*t.fontSize),!e.p5play._fpsAvg||e.frameCount%20==0){let t=0,i=e.p5play._fpsArr.length;for(let s=0;s<i;s++)t+=e.p5play._fpsArr[s];t=Math.round(t/i);let s,r=Math.min(...e.p5play._fpsArr);e.p5play._fpsAvg=t,e.p5play._fpsMin=r,e.p5play._fpsMax=Math.max(...e.p5play._fpsArr),e.p5play._fpsArr=[],s=r>55?e.color(30,255,30):r>25?e.color(255,100,30):e.color(255,30,30),e.p5play._statsColor=s}e.p5play._fpsArr.push(e.getFPS()),e.push(),e.fill(0,0,0,128),e.rect(t.x-5,t.y-t.fontSize,8.5*t.fontSize,4*t.gap+5),e.fill(e.p5play._statsColor),e.textAlign("left"),e.textSize(t.fontSize),t.font&&e.textFont(t.font);let i=t.x,s=t.y;e.text("sprites: "+e.p5play.spritesDrawn,i,s),e.text("fps avg: "+e.p5play._fpsAvg,i,s+t.gap),e.text("fps min: "+e.p5play._fpsMin,i,s+2*t.gap),e.text("fps max: "+e.p5play._fpsMax,i,s+3*t.gap),e.pop()}},p5playAfterSetup=function(){const t=this;t._isGlobal&&window.update&&(t.update=window.update,t._q5||(window.draw=()=>{})),t._isGlobal&&window.drawFrame&&(t.drawFrame=window.drawFrame),this.update??=()=>{},this.drawFrame??=()=>{},t._setupDone=!0},p5playPreDraw=function(){const t=this;t._q5||(t.p5play._preDrawFrameTime=performance.now()),t.p5play.spritesDrawn=0,t.mouse._update(),t.contros._update(),t.update(),t.allSprites._autoUpdate&&t.allSprites.update(),t.allSprites._autoUpdate??=!0},p5playPostDraw=function(){const t=this;t.allSprites.autoCull&&t.allSprites.cull(1e4),t.world.autoStep&&t.world.timeScale>0&&t.world.physicsUpdate(),t.world.autoStep??=!0,t.drawFrame(),t.p5play._inPostDraw=!0,t.allSprites._autoDraw&&(t.camera.on(),t.allSprites.draw()),t.allSprites._autoDraw??=!0,t.camera.off(),t.allSprites.postDraw(),t.p5play.renderStats&&t.renderStats();for(let e in t.kb)"holdThreshold"!=e&&(t.kb[e]<0?t.kb[e]=0:t.kb[e]>0&&t.kb[e]++);for(let e=0;e<t.touches.length;e++){let i=t.touches[e];i.duration++,i._dragFrame?(i.drag++,i._dragFrame=!1):i.drag<0&&(i.drag=0),i.duration<=0&&(t.touches.splice(e,1),e--)}let e=t.mouse,i=t.world.mouseSprite?.mouse;for(let t of["left","center","right"])e[t]<0?e[t]=0:e[t]>0&&e[t]++,i?.hover&&(i[t]=e[t]),e._dragFrame[t]?(e.drag[t]++,i&&(i.drag[t]=e.drag[t]),e._dragFrame[t]=!1):e.drag[t]<0&&(e.drag[t]=0,i&&(i.drag[t]=0));if(t.world.mouseTracking&&t.mouse.isActive){let s=t.world.getMouseSprites();for(let t=0;t<s.length;t++){let e=s[t];0==t?e.mouse.hover++:e.mouse.hover>0?e.mouse.hover=-1:e.mouse.hover<0&&(e.mouse.hover=0)}e.left<=0&&e.center<=0&&e.right<=0&&(t.world.mouseSprite=null);let r=t.world.mouseSprite,o=e.drag.left>0||e.drag.center>0||e.drag.right>0;for(let e of t.world.mouseSprites)if(!s.includes(e)){let i=e.mouse;i.hover>0&&(i.hover=-1,i.left=i.center=i.right=0),o||e!=r||(t.world.mouseSprite=r=null)}r&&(s.includes(r)||s.push(r),i.x=r.x-e.x,i.y=r.y-e.y),t.world.mouseSprites=s}t._q5||(t.p5play._postDrawFrameTime=performance.now(),t.p5play._fps=Math.round(1e3/(t.p5play._postDrawFrameTime-t.p5play._preDrawFrameTime))||1),t.p5play._inPostDraw=!1},recommendation='For the best experience with p5play, use q5.js v3:\n\n<script src="https://q5js.org/q5.js"><\/script>\n\nOr use p5.js v1.11.4 (tested for quality assurance):\n\n<script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/p5.js"><\/script>\n<script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/addons/p5.sound.min.js"><\/script>\n';if(null==p5.prototype?.registerMethod)console.error(`p5play's support for p5.js v${p5.VERSION} is limited and experimental.\n\n`+recommendation),p5.registerAddon(((t,e,i)=>{let s={loadImage:()=>new t.Image(1,1),loadModel:()=>new t.Geometry,loadJSON:()=>{},loadStrings:()=>[],loadFont:e=>new t.Font(e,new FontFace("default","default.woff"))};t.isPreloadSupported=()=>!0;let r=[],o={};for(let t in s){let i=e[t];o[t]=i,e[t]=function(...e){if(!this._isInPreload)return i.apply(this,e);let o=s[t](this),a=i.apply(this,e).then((t=>{for(let e in t)o[e]=t[e]}));return r.push(a),o}}delete e.code,i.presetup=async function(){const t=this;if(t.createCanvas.call(t,100,100),p5playInit.call(t),t._isGlobal){let e=["p5play","DYN","DYNAMIC","STA","STATIC","KIN","KINEMATIC","Sprite","Ani","Anis","Group","World","world","createCanvas","Canvas","canvas","MAXED","SMOOTH","PIXELATED","displayMode","Camera","camera","Tiles","Joint","GlueJoint","DistanceJoint","WheelJoint","HingeJoint","SliderJoint","RopeJoint","GrabberJoint","kb","keyboard","mouse","touches","allSprites","camera","contro","contros","controllers","spriteArt","EmojiImage","getFPS"];for(let i of e)window[i]=t[i]}window.preload&&(t._isInPreload=!0,window.preload(),t._isInPreload=!1,await Promise.all(r))},i.postsetup=p5playAfterSetup,i.predraw=p5playPreDraw,i.postdraw=p5playPostDraw}));else{function isVersionInRange(t,e,i){if(!t)return!1;[t,e,i]=[t,e,i].map((t=>t.split(".").map(Number)));for(let s=0;s<3;s++){if(t[s]<e[s])return!1;if(t[s]>i[s])return!1;if(t[s]>e[s]&&t[s]<i[s])return!0}return t[0]===e[0]&&t[1]===e[1]&&t[2]>=e[2]||t[0]===i[0]&&t[1]===i[1]&&t[2]<=i[2]||t[0]===e[0]&&t[1]>e[1]&&t[1]<i[1]}"undefined"!=typeof Q5||isVersionInRange(p5.VERSION,"1.10.0","1.11.4")||console.error(`p5play does not support p5.js v${p5.VERSION}.\n\n`+recommendation),p5.prototype.registerMethod("init",p5playInit),p5.prototype.registerMethod("afterSetup",p5playAfterSetup),p5.prototype.registerMethod("pre",p5playPreDraw),p5.prototype.registerMethod("post",p5playPostDraw)}
